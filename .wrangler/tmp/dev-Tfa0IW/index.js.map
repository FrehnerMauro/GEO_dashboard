{
  "version": 3,
  "sources": ["../bundle-doaM6S/strip-cf-connecting-ip-header.js", "wrangler-modules-watch:wrangler:modules-watch", "../../../node_modules/wrangler/templates/modules-watch-stub.js", "../../../src/config.ts", "../../../src/ingestion/sitemap.ts", "../../../src/llm_execution/index.ts", "../../../src/persistence/db.ts", "../../../src/persistence/index.ts", "../../../src/analysis/brand_mention.ts", "../../../src/analysis/competitor.ts", "../../../src/analysis/sentiment.ts", "../../../src/analysis/index.ts", "../bundle-doaM6S/middleware-loader.entry.ts", "../bundle-doaM6S/middleware-insertion-facade.js", "../../../src/index.ts", "../../../src/api/routes.ts", "../../../src/engine_workflow.ts", "../../../src/ingestion/index.ts", "../../../src/ingestion/crawler.ts", "../../../src/ingestion/scraper.ts", "../../../src/categorization/index.ts", "../../../src/prompt_generation/index.ts", "../../../src/engine.ts", "../../../node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts", "../../../node_modules/wrangler/templates/middleware/middleware-miniflare3-json-error.ts", "../../../node_modules/wrangler/templates/middleware/common.ts"],
  "sourceRoot": "/Users/maurofrehner/Desktop/GitHub/GEO_dashboard/.wrangler/tmp/dev-Tfa0IW",
  "sourcesContent": ["function stripCfConnectingIPHeader(input, init) {\n\tconst request = new Request(input, init);\n\trequest.headers.delete(\"CF-Connecting-IP\");\n\treturn request;\n}\n\nglobalThis.fetch = new Proxy(globalThis.fetch, {\n\tapply(target, thisArg, argArray) {\n\t\treturn Reflect.apply(target, thisArg, [\n\t\t\tstripCfConnectingIPHeader.apply(null, argArray),\n\t\t]);\n\t},\n});\n", "", "// `esbuild` doesn't support returning `watch*` options from `onStart()`\n// plugin callbacks. Instead, we define an empty virtual module that is\n// imported by this injected file. Importing the module registers watchers.\nimport \"wrangler:modules-watch\";\n", "/**\n * Configuration management for the GEO platform\n */\n\nexport interface Config {\n  openai: {\n    apiKey: string;\n    model: string;\n    responsesApiUrl: string;\n  };\n  crawling: {\n    maxPages: number;\n    maxDepth: number;\n    timeout: number;\n    userAgent: string;\n  };\n  analysis: {\n    reRunSchedule: \"daily\" | \"weekly\";\n    brandFuzzyThreshold: number;\n    sentimentConfidenceThreshold: number;\n  };\n  categories: {\n    minConfidence: number;\n    maxCategories: number;\n  };\n  prompts: {\n    questionsPerCategory: number;\n    minIntentScore: number;\n  };\n}\n\nexport function getConfig(env: Record<string, any>): Config {\n  return {\n    openai: {\n      apiKey: env.OPENAI_API_KEY || \"\",\n      model: env.OPENAI_MODEL || \"gpt-4o\", // Use gpt-4o by default, set OPENAI_MODEL=gpt-5 in .dev.vars if available\n      responsesApiUrl: \"https://api.openai.com/v1/responses\",\n    },\n    crawling: {\n      maxPages: parseInt(env.MAX_PAGES || \"50\"),\n      maxDepth: parseInt(env.MAX_DEPTH || \"3\"),\n      timeout: parseInt(env.CRAWL_TIMEOUT || \"30000\"),\n      userAgent: env.USER_AGENT || \"GEO-Platform/1.0\",\n    },\n    analysis: {\n      reRunSchedule: (env.RE_RUN_SCHEDULE as \"daily\" | \"weekly\") || \"weekly\",\n      brandFuzzyThreshold: parseFloat(env.BRAND_FUZZY_THRESHOLD || \"0.7\"),\n      sentimentConfidenceThreshold: parseFloat(\n        env.SENTIMENT_CONFIDENCE_THRESHOLD || \"0.6\"\n      ),\n    },\n    categories: {\n      minConfidence: parseFloat(env.MIN_CATEGORY_CONFIDENCE || \"0.5\"),\n      maxCategories: parseInt(env.MAX_CATEGORIES || \"10\"),\n    },\n    prompts: {\n      questionsPerCategory: parseInt(env.QUESTIONS_PER_CATEGORY || \"5\"),\n      minIntentScore: parseFloat(env.MIN_INTENT_SCORE || \"0.7\"),\n    },\n  };\n}\n\n", "/**\n * Sitemap.xml parser and crawler\n */\n\nexport interface SitemapUrl {\n  loc: string;\n  lastmod?: string;\n  changefreq?: string;\n  priority?: string;\n}\n\nexport class SitemapParser {\n  async findAndParseSitemap(baseUrl: string): Promise<{ urls: string[]; foundSitemap: boolean }> {\n    const sitemapUrls = [\n      `${baseUrl}/sitemap.xml`,\n      `${baseUrl}/sitemap_index.xml`,\n      `${baseUrl}/sitemaps/sitemap.xml`,\n    ];\n\n    for (const sitemapUrl of sitemapUrls) {\n      try {\n        const response = await fetch(sitemapUrl, {\n          headers: {\n            \"User-Agent\": \"GEO-Platform/1.0\",\n          },\n          signal: AbortSignal.timeout(10000) // 10 second timeout\n        });\n\n        if (response.ok) {\n          const xml = await response.text();\n          const urls = this.parseSitemap(xml);\n          if (urls.length > 0) {\n            return { urls, foundSitemap: true };\n          }\n        }\n      } catch (error) {\n        // Try next sitemap URL\n        continue;\n      }\n    }\n\n    // If no sitemap found, crawl homepage and extract internal links\n    console.log(\"\u26A0\uFE0F Keine Sitemap gefunden. Crawle Startseite und extrahiere interne Links...\");\n    const urls = await this.crawlHomepageForLinks(baseUrl);\n    return { urls, foundSitemap: false };\n  }\n\n  private async crawlHomepageForLinks(baseUrl: string): Promise<string[]> {\n    const urls: string[] = [];\n    const baseUrlObj = new URL(baseUrl);\n    const visited = new Set<string>();\n    \n    try {\n      // Fetch homepage\n      const response = await fetch(baseUrl, {\n        headers: {\n          \"User-Agent\": \"GEO-Platform/1.0\",\n        },\n        signal: AbortSignal.timeout(10000) // 10 second timeout\n      });\n\n      if (!response.ok) {\n        console.error(\"Failed to fetch homepage:\", response.status);\n        return [baseUrl]; // Return at least the homepage\n      }\n\n      const html = await response.text();\n      urls.push(baseUrl); // Add homepage\n      visited.add(baseUrl);\n\n      // Extract all links from homepage\n      const linkRegex = /<a\\s+[^>]*href=[\"']([^\"']+)[\"'][^>]*>/gi;\n      let match;\n      const foundLinks = new Set<string>();\n\n      while ((match = linkRegex.exec(html)) !== null) {\n        const href = match[1].trim();\n        if (!href || href.startsWith('#') || href.startsWith('javascript:') || href.startsWith('mailto:')) {\n          continue;\n        }\n\n        try {\n          // Resolve relative URLs\n          const absoluteUrl = new URL(href, baseUrl).href;\n          const urlObj = new URL(absoluteUrl);\n\n          // Only include internal links (same domain)\n          if (urlObj.hostname === baseUrlObj.hostname || urlObj.hostname === `www.${baseUrlObj.hostname}` || baseUrlObj.hostname === `www.${urlObj.hostname}`) {\n            // Normalize URL (remove fragment, trailing slash)\n            const normalizedUrl = urlObj.origin + urlObj.pathname + (urlObj.search || '');\n            if (!visited.has(normalizedUrl) && !normalizedUrl.endsWith('.pdf') && !normalizedUrl.endsWith('.jpg') && !normalizedUrl.endsWith('.png') && !normalizedUrl.endsWith('.gif') && !normalizedUrl.endsWith('.zip')) {\n              foundLinks.add(normalizedUrl);\n            }\n          }\n        } catch (e) {\n          // Invalid URL, skip\n          continue;\n        }\n      }\n\n      // Convert to array and limit to reasonable number\n      const linkArray = Array.from(foundLinks);\n      const maxLinks = 50; // Limit to prevent too many URLs\n      urls.push(...linkArray.slice(0, maxLinks));\n\n      console.log(`\u2705 ${urls.length} URLs von Startseite extrahiert (${foundLinks.size} interne Links gefunden)`);\n      \n      return urls;\n    } catch (error) {\n      console.error(\"Error crawling homepage:\", error);\n      // Return at least the homepage\n      return [baseUrl];\n    }\n  }\n\n  private parseSitemap(xml: string): string[] {\n    const urls: string[] = [];\n\n    // Parse sitemap.xml format\n    const urlRegex = /<loc>(.*?)<\\/loc>/gi;\n    let match;\n    while ((match = urlRegex.exec(xml)) !== null) {\n      const url = match[1].trim();\n      if (url) {\n        urls.push(url);\n      }\n    }\n\n    // Also check for sitemap index\n    const sitemapIndexRegex = /<sitemap><loc>(.*?)<\\/loc><\\/sitemap>/gi;\n    while ((match = sitemapIndexRegex.exec(xml)) !== null) {\n      const sitemapUrl = match[1].trim();\n      // Could recursively fetch, but for now just note it\n      console.log(\"Found sitemap index:\", sitemapUrl);\n    }\n\n    return urls;\n  }\n\n  async parseSitemapFromUrl(sitemapUrl: string): Promise<string[]> {\n    try {\n      const response = await fetch(sitemapUrl, {\n        headers: {\n          \"User-Agent\": \"GEO-Platform/1.0\",\n        },\n        signal: AbortSignal.timeout(10000) // 10 second timeout\n      });\n\n      if (!response.ok) {\n        return [];\n      }\n\n      const xml = await response.text();\n      return this.parseSitemap(xml);\n    } catch (error) {\n      console.error(\"Error parsing sitemap:\", error);\n      return [];\n    }\n  }\n}\n\n", "/**\n * LLM execution module\n * Executes prompts against GPT-5 with Web Search enabled\n */\n\nimport type { Prompt, LLMResponse, WebSearchCitation } from \"../types.js\";\nimport type { Config } from \"../config.js\";\n\nexport class LLMExecutor {\n  constructor(private config: Config) {}\n\n  async executePrompt(prompt: Prompt): Promise<LLMResponse> {\n    const response = await this.callResponsesAPI(prompt.question);\n\n    return {\n      promptId: prompt.id,\n      outputText: response.outputText,\n      citations: response.citations,\n      timestamp: new Date().toISOString(),\n      model: this.config.openai.model,\n    };\n  }\n\n  async executePrompts(prompts: Prompt[]): Promise<LLMResponse[]> {\n    const responses: LLMResponse[] = [];\n\n    // Execute prompts sequentially to avoid rate limits\n    for (const prompt of prompts) {\n      try {\n        const response = await this.executePrompt(prompt);\n        responses.push(response);\n      } catch (error) {\n        console.error(`Failed to execute prompt ${prompt.id}:`, error);\n        // Continue with other prompts even if one fails\n      }\n    }\n\n    return responses;\n  }\n\n  private async callResponsesAPI(question: string): Promise<{\n    outputText: string;\n    citations: WebSearchCitation[];\n  }> {\n    // According to OpenAI Responses API documentation:\n    // https://platform.openai.com/docs/guides/tools-web-search\n    // The endpoint is: POST https://api.openai.com/v1/responses\n    // Format: { model, tools: [{ type: \"web_search\" }], input }\n    const url = \"https://api.openai.com/v1/responses\";\n    \n    if (!this.config.openai.apiKey) {\n      throw new Error(\"OpenAI API key is not configured\");\n    }\n\n    const requestBody = {\n      model: this.config.openai.model,\n      tools: [\n        {\n          type: \"web_search\",\n        },\n      ],\n      input: question,\n    };\n\n    console.log('\uD83D\uDCE4 Sending request to OpenAI Responses API:');\n    console.log('  URL:', url);\n    console.log('  Model:', this.config.openai.model);\n    console.log('  API Key present:', !!this.config.openai.apiKey);\n    console.log('  API Key length:', this.config.openai.apiKey?.length || 0);\n    console.log('  Request body:', JSON.stringify(requestBody, null, 2));\n\n    let response: Response;\n    try {\n      response = await fetch(url, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Authorization: `Bearer ${this.config.openai.apiKey}`,\n        },\n        body: JSON.stringify(requestBody),\n      });\n    } catch (fetchError) {\n      console.error('\u274C Fetch error:', fetchError);\n      throw new Error(`Failed to connect to OpenAI API: ${fetchError instanceof Error ? fetchError.message : String(fetchError)}`);\n    }\n\n    console.log('\uD83D\uDCE5 Response status:', response.status, response.statusText);\n    console.log('\uD83D\uDCE5 Response headers:', Object.fromEntries(response.headers.entries()));\n\n    if (!response.ok) {\n      let errorText = '';\n      try {\n        errorText = await response.text();\n        console.error('\u274C API Error Response Text:', errorText);\n      } catch (e) {\n        errorText = 'Could not read error response';\n        console.error('\u274C Could not read error response:', e);\n      }\n      console.error('\u274C API Error Response Status:', response.status);\n      console.error('\u274C API Error Response Status Text:', response.statusText);\n      \n      // Try to parse error as JSON\n      let errorJson: any = null;\n      try {\n        errorJson = JSON.parse(errorText);\n        console.error('\u274C API Error JSON:', JSON.stringify(errorJson, null, 2));\n      } catch (e) {\n        // Not JSON, that's okay\n      }\n      \n      const errorMessage = errorJson?.error?.message || errorJson?.error || errorText || response.statusText;\n      throw new Error(\n        `OpenAI API error: ${response.status} ${response.statusText} - ${errorMessage.substring(0, 500)}`\n      );\n    }\n\n    let data;\n    try {\n      data = await response.json();\n      console.log('\uD83D\uDD0D Raw API response type:', Array.isArray(data) ? 'array' : typeof data);\n      try {\n        console.log('\uD83D\uDD0D Raw API response:', JSON.stringify(data, null, 2));\n      } catch (e) {\n        console.error('\u274C Failed to stringify response:', e);\n      }\n    } catch (jsonError) {\n      const responseText = await response.text();\n      console.error('\u274C Failed to parse JSON response:', jsonError);\n      console.error('\u274C Response text:', responseText);\n      throw new Error(`Failed to parse API response: ${jsonError instanceof Error ? jsonError.message : String(jsonError)}. Response: ${responseText.substring(0, 500)}`);\n    }\n\n    // According to OpenAI docs, response is an array:\n    // [\n    //   { type: \"web_search_call\", id: \"...\", status: \"completed\" },\n    //   { id: \"...\", type: \"message\", status: \"completed\", role: \"assistant\", content: [...] }\n    // ]\n    // The response object also has output_text directly available\n    let outputText: string;\n    let citations: WebSearchCitation[];\n    try {\n      outputText = this.extractOutputText(data);\n      citations = this.extractCitations(data);\n    } catch (extractError) {\n      throw extractError;\n    }\n\n    console.log('\uD83D\uDCDD Extracted outputText length:', outputText.length);\n    console.log('\uD83D\uDCDD Extracted outputText preview:', outputText.substring(0, 200));\n    console.log('\uD83D\uDCDA Extracted citations count:', citations.length);\n    if (citations.length > 0) {\n      console.log('\uD83D\uDCDA Extracted citations:', JSON.stringify(citations, null, 2));\n    } else {\n      console.warn('\u26A0\uFE0F No citations extracted! Raw data structure:', JSON.stringify(data, null, 2).substring(0, 1000));\n    }\n\n    if (!outputText || outputText.trim().length === 0) {\n      console.error('\u274C ERROR: Empty outputText extracted!');\n      console.error('\u274C Full raw data:', JSON.stringify(data, null, 2));\n      throw new Error('Keine Antwort von GPT-5 erhalten. Die API hat eine leere Antwort zur\u00FCckgegeben.');\n    }\n\n    return {\n      outputText,\n      citations,\n    };\n  }\n\n  private extractOutputText(data: any): string {\n    console.log('\uD83D\uDD0D extractOutputText - Input data type:', Array.isArray(data) ? 'array' : typeof data);\n    \n    // According to OpenAI docs, the response can be:\n    // 1. An array: [{ type: \"web_search_call\" }, { type: \"message\", content: [...] }]\n    // 2. An object with 'output' field: { output: [{ type: \"message\", content: [...] }] }\n    // The text is in: output[0].content[0].text where content[0].type === \"output_text\"\n    \n    // Check if data has an 'output' field that is an array (actual API response format)\n    if (data && typeof data === 'object' && Array.isArray((data as any).output)) {\n      const outputArray = (data as any).output;\n      // Find the message object with type \"message\" and status \"completed\"\n      const messageObj = outputArray.find(\n        (item: any) => item.type === \"message\" && item.status === \"completed\"\n      );\n      \n      if (messageObj?.content && Array.isArray(messageObj.content)) {\n        // Find the output_text item in content array\n        const outputTextItem = messageObj.content.find(\n          (item: any) => item.type === \"output_text\"\n        );\n        \n        if (outputTextItem?.text) {\n          return outputTextItem.text;\n        }\n      }\n    }\n    \n    // Check if data has a 'data' field that is an array (wrapped response)\n    if (data && typeof data === 'object' && Array.isArray((data as any).data)) {\n      // Recursively call with the unwrapped array\n      return this.extractOutputText((data as any).data);\n    }\n    \n    // First, try direct output_text (if using SDK, response.output_text is available)\n    if (data && typeof data === 'object' && 'output_text' in data) {\n      console.log('\u2705 Found output_text directly on response object');\n      return (data as any).output_text;\n    }\n    \n    // If data is an array (raw API response - old format)\n    if (Array.isArray(data)) {\n      console.log('\uD83D\uDD0D Data is array, length:', data.length);\n      \n      // Find the message object with type \"message\" and status \"completed\"\n      // According to docs: second element is usually the message\n      const messageObj = data.find(\n        (item: any) => item.type === \"message\" && item.status === \"completed\"\n      );\n      \n      console.log('\uD83D\uDD0D Found messageObj:', messageObj ? 'yes' : 'no');\n      \n      if (messageObj?.content && Array.isArray(messageObj.content)) {\n        console.log('\uD83D\uDD0D messageObj.content is array, length:', messageObj.content.length);\n        \n        // Find the output_text item in content array\n        // According to docs: content: [{ type: \"output_text\", text: \"...\", annotations: [...] }]\n        const outputTextItem = messageObj.content.find(\n          (item: any) => item.type === \"output_text\"\n        );\n        \n        console.log('\uD83D\uDD0D Found outputTextItem:', outputTextItem ? 'yes' : 'no');\n        \n        if (outputTextItem?.text) {\n          console.log('\u2705 Extracted text from outputTextItem.text, length:', outputTextItem.text.length);\n          return outputTextItem.text;\n        } else if (outputTextItem) {\n          console.warn('\u26A0\uFE0F outputTextItem found but no text property. Keys:', Object.keys(outputTextItem));\n        }\n      }\n    }\n\n    // Fallback: try nested paths\n    if (data?.message?.output_text) {\n      console.log('\u2705 Using fallback: data.message.output_text');\n      return data.message.output_text;\n    }\n\n    if (data?.outputText) {\n      console.log('\u2705 Using fallback: data.outputText');\n      return data.outputText;\n    }\n\n    console.error('\u274C No output text found in data structure');\n    console.error('\u274C Data structure:', JSON.stringify(data, null, 2));\n    return \"\";\n  }\n\n  private extractCitations(data: any): WebSearchCitation[] {\n    const citations: WebSearchCitation[] = [];\n\n    // According to OpenAI docs, citations are in:\n    // 1. data.output[0].content[0].annotations[] (actual API format)\n    // 2. data[1].content[0].annotations[] (old array format)\n    \n    // Check if data has an 'output' field that is an array (actual API response format)\n    if (data && typeof data === 'object' && Array.isArray((data as any).output)) {\n      const outputArray = (data as any).output;\n      // Find the message object with type \"message\" and status \"completed\"\n      const messageObj = outputArray.find(\n        (item: any) => item.type === \"message\" && item.status === \"completed\"\n      );\n      \n      if (messageObj?.content && Array.isArray(messageObj.content)) {\n        // Find the output_text item in content array\n        const outputTextItem = messageObj.content.find(\n          (item: any) => item.type === \"output_text\"\n        );\n        \n        // Extract citations from annotations array\n        // According to docs: annotations: [{ type: \"url_citation\", url: \"...\", title: \"...\", ... }]\n        if (outputTextItem?.annotations && Array.isArray(outputTextItem.annotations)) {\n          for (const annotation of outputTextItem.annotations) {\n            if (annotation.type === \"url_citation\" && annotation.url) {\n              citations.push({\n                url: annotation.url,\n                title: annotation.title || annotation.url,\n                snippet: annotation.snippet || \"\",\n              });\n            }\n          }\n        }\n      }\n    }\n    \n    // If data is an array (raw API response - old format)\n    if (Array.isArray(data)) {\n      // Find the message object with type \"message\" and status \"completed\"\n      const messageObj = data.find(\n        (item: any) => item.type === \"message\" && item.status === \"completed\"\n      );\n      \n      if (messageObj?.content && Array.isArray(messageObj.content)) {\n        // Find the output_text item in content array\n        const outputTextItem = messageObj.content.find(\n          (item: any) => item.type === \"output_text\"\n        );\n        \n        // Extract citations from annotations array\n        // According to docs: annotations: [{ type: \"url_citation\", url: \"...\", title: \"...\", ... }]\n        if (outputTextItem?.annotations && Array.isArray(outputTextItem.annotations)) {\n          for (const annotation of outputTextItem.annotations) {\n            if (annotation.type === \"url_citation\" && annotation.url) {\n              citations.push({\n                url: annotation.url,\n                title: annotation.title || annotation.url,\n                snippet: annotation.snippet || \"\",\n              });\n            }\n          }\n        }\n      }\n    }\n\n    // Fallback: try nested paths (for backward compatibility)\n    if (data?.message?.content && Array.isArray(data.message.content)) {\n      for (const item of data.message.content) {\n        if (item.annotations && Array.isArray(item.annotations)) {\n          for (const annotation of item.annotations) {\n            if (annotation.type === \"url_citation\" && annotation.url) {\n              citations.push({\n                url: annotation.url,\n                title: annotation.title || annotation.url,\n                snippet: annotation.snippet || \"\",\n              });\n            }\n          }\n        }\n      }\n    }\n\n    // Deduplicate by URL\n    const uniqueCitations = new Map<string, WebSearchCitation>();\n    for (const citation of citations) {\n      if (citation.url && !uniqueCitations.has(citation.url)) {\n        uniqueCitations.set(citation.url, citation);\n      }\n    }\n\n    return Array.from(uniqueCitations.values());\n  }\n}\n\n", "/**\n * Database persistence layer for D1\n */\n\nimport type {\n  UserInput,\n  Category,\n  Prompt,\n  LLMResponse,\n  PromptAnalysis,\n  CategoryMetrics,\n  CompetitiveAnalysis,\n  TimeSeriesData,\n  AnalysisResult,\n  Company,\n  CompanyPrompt,\n  ScheduledRun,\n} from \"../types.js\";\n\nexport interface D1Database {\n  prepare(query: string): D1PreparedStatement;\n  batch(statements: D1PreparedStatement[]): Promise<D1Result[]>;\n  exec(query: string): Promise<D1ExecResult>;\n}\n\nexport interface D1PreparedStatement {\n  bind(...values: any[]): D1PreparedStatement;\n  first<T = any>(colName?: string): Promise<T | null>;\n  run(): Promise<D1Result>;\n  all<T = any>(): Promise<D1Result<T>>;\n}\n\nexport interface D1Result<T = any> {\n  success: boolean;\n  meta: {\n    changes: number;\n    last_row_id: number;\n    duration: number;\n  };\n  results?: T[];\n}\n\nexport interface D1ExecResult {\n  count: number;\n  duration: number;\n}\n\nexport class Database {\n  public db: D1Database;\n  constructor(db?: D1Database) {\n    // No-op: create a mock db object if none provided\n    this.db = db || {\n      prepare: () => ({\n        bind: () => ({ first: async () => null, run: async () => ({ success: true }), all: async () => ({ success: true, results: [] }) }),\n        first: async () => null,\n        run: async () => ({ success: true }),\n        all: async () => ({ success: true, results: [] })\n      } as any),\n      batch: async () => [],\n      exec: async () => ({ count: 0, duration: 0 })\n    } as D1Database;\n  }\n\n  async saveAnalysisRun(\n    runId: string,\n    userInput: UserInput,\n    status: string = \"pending\"\n  ): Promise<void> {\n    const now = new Date().toISOString();\n    try {\n      await this.db\n        .prepare(\n          `INSERT INTO analysis_runs (id, website_url, country, region, language, status, created_at, updated_at)\n           VALUES (?, ?, ?, ?, ?, ?, ?, ?)`\n        )\n        .bind(\n          runId,\n          userInput.websiteUrl,\n          userInput.country,\n          userInput.region || null,\n          userInput.language,\n          status,\n          now,\n          now\n        )\n        .run();\n    } catch (error: any) {\n      if (error.message?.includes(\"no such table: analysis_runs\")) {\n        throw new Error(\n          \"Database tables not found. Please run the database setup first: POST /api/setup/database\"\n        );\n      }\n      throw error;\n    }\n  }\n\n  async updateAnalysisStatus(\n    runId: string,\n    status: string,\n    progress?: { step: string; progress: number; message?: string }\n  ): Promise<void> {\n    const progressJson = progress ? JSON.stringify(progress) : null;\n    await this.db\n      .prepare(\n        `UPDATE analysis_runs SET status = ?, progress = ?, updated_at = ? WHERE id = ?`\n      )\n      .bind(status, progressJson, new Date().toISOString(), runId)\n      .run();\n  }\n\n  async getAnalysisStatus(runId: string): Promise<{\n    status: string;\n    progress: { step: string; progress: number; message?: string } | null;\n    error?: string;\n    step?: string;\n  } | null> {\n    const run = await this.db\n      .prepare(\"SELECT status, progress, error_message, step FROM analysis_runs WHERE id = ?\")\n      .bind(runId)\n      .first<{\n        status: string;\n        progress: string | null;\n        error_message: string | null;\n        step: string | null;\n      }>();\n\n    if (!run) return null;\n\n    return {\n      status: run.status || \"pending\",\n      progress: run.progress ? JSON.parse(run.progress) : null,\n      error: run.error_message || undefined,\n      step: run.step || \"sitemap\",\n    };\n  }\n\n  async saveCategories(\n    runId: string,\n    categories: Category[]\n  ): Promise<void> {\n    if (categories.length === 0) {\n      return; // Skip empty batches\n    }\n\n    const statements = categories.map((cat) =>\n      this.db\n        .prepare(\n          `INSERT INTO categories (id, analysis_run_id, name, description, confidence, source_pages, created_at)\n           VALUES (?, ?, ?, ?, ?, ?, ?)`\n        )\n        .bind(\n          cat.id,\n          runId,\n          cat.name,\n          cat.description,\n          cat.confidence,\n          JSON.stringify(cat.sourcePages),\n          new Date().toISOString()\n        )\n    );\n\n    await this.db.batch(statements);\n  }\n\n  async savePrompts(runId: string, prompts: Prompt[]): Promise<void> {\n    if (prompts.length === 0) {\n      return; // Skip empty batches\n    }\n\n    const statements = prompts.map((prompt) =>\n      this.db\n        .prepare(\n          `INSERT OR REPLACE INTO prompts (id, analysis_run_id, category_id, question, language, country, region, intent, created_at)\n           VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)`\n        )\n        .bind(\n          prompt.id,\n          runId,\n          prompt.categoryId,\n          prompt.question,\n          prompt.language,\n          prompt.country || null,\n          prompt.region || null,\n          prompt.intent,\n          prompt.createdAt\n        )\n    );\n\n    await this.db.batch(statements);\n  }\n\n  async saveLLMResponses(responses: LLMResponse[]): Promise<void> {\n    if (responses.length === 0) {\n      return; // Skip empty batches\n    }\n\n    const responseStatements = responses.map((response) => {\n      const responseId = `resp_${response.promptId}_${Date.now()}`;\n      return {\n        response: this.db\n          .prepare(\n            `INSERT INTO llm_responses (id, prompt_id, output_text, model, timestamp)\n             VALUES (?, ?, ?, ?, ?)`\n          )\n          .bind(\n            responseId,\n            response.promptId,\n            response.outputText,\n            response.model,\n            response.timestamp\n          ),\n        citations: response.citations.map((citation) => {\n          const citationId = `cite_${responseId}_${Date.now()}_${Math.random()}`;\n          return this.db\n            .prepare(\n              `INSERT INTO citations (id, llm_response_id, url, title, snippet)\n               VALUES (?, ?, ?, ?, ?)`\n            )\n            .bind(\n              citationId,\n              responseId,\n              citation.url,\n              citation.title || null,\n              citation.snippet || null\n            );\n        }),\n      };\n    });\n\n    const allStatements: D1PreparedStatement[] = [];\n    for (const { response, citations } of responseStatements) {\n      allStatements.push(response);\n      allStatements.push(...citations);\n    }\n\n    if (allStatements.length > 0) {\n      await this.db.batch(allStatements);\n    }\n  }\n\n  async savePromptAnalyses(analyses: PromptAnalysis[]): Promise<void> {\n    if (analyses.length === 0) {\n      return; // Skip empty batches\n    }\n\n    const statements = analyses.map((analysis) => {\n      const analysisId = `analysis_${analysis.promptId}_${Date.now()}`;\n      return {\n        analysis: this.db\n          .prepare(\n            `INSERT INTO prompt_analyses \n             (id, prompt_id, brand_mentions_exact, brand_mentions_fuzzy, brand_mentions_contexts,\n              citation_count, citation_urls, sentiment_tone, sentiment_confidence, sentiment_keywords, timestamp)\n             VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`\n          )\n          .bind(\n            analysisId,\n            analysis.promptId,\n            analysis.brandMentions.exact,\n            analysis.brandMentions.fuzzy,\n            JSON.stringify(analysis.brandMentions.contexts),\n            analysis.citationCount,\n            JSON.stringify(analysis.citationUrls),\n            analysis.sentiment.tone,\n            analysis.sentiment.confidence,\n            JSON.stringify(analysis.sentiment.keywords),\n            analysis.timestamp\n          ),\n        competitors: analysis.competitors.map((competitor) => {\n          const competitorId = `comp_${analysisId}_${Date.now()}_${Math.random()}`;\n          return this.db\n            .prepare(\n              `INSERT INTO competitor_mentions \n               (id, prompt_analysis_id, competitor_name, mention_count, contexts, citation_urls)\n               VALUES (?, ?, ?, ?, ?, ?)`\n            )\n            .bind(\n              competitorId,\n              analysisId,\n              competitor.name,\n              competitor.count,\n              JSON.stringify(competitor.contexts),\n              JSON.stringify(competitor.citations)\n            );\n        }),\n      };\n    });\n\n    const allStatements: D1PreparedStatement[] = [];\n    for (const { analysis, competitors } of statements) {\n      allStatements.push(analysis);\n      allStatements.push(...competitors);\n    }\n\n    if (allStatements.length > 0) {\n      await this.db.batch(allStatements);\n    }\n  }\n\n  async saveCategoryMetrics(\n    runId: string,\n    metrics: CategoryMetrics[]\n  ): Promise<void> {\n    if (metrics.length === 0) {\n      return; // Skip empty batches\n    }\n\n    const statements = metrics.map((metric) => {\n      const metricId = `metric_${metric.categoryId}_${Date.now()}`;\n      return this.db\n        .prepare(\n          `INSERT INTO category_metrics \n           (id, analysis_run_id, category_id, visibility_score, citation_rate, \n            brand_mention_rate, competitor_mention_rate, timestamp)\n           VALUES (?, ?, ?, ?, ?, ?, ?, ?)`\n        )\n        .bind(\n          metricId,\n          runId,\n          metric.categoryId,\n          metric.visibilityScore,\n          metric.citationRate,\n          metric.brandMentionRate,\n          metric.competitorMentionRate,\n          metric.timestamp\n        );\n    });\n\n    await this.db.batch(statements);\n  }\n\n  async saveCompetitiveAnalysis(\n    runId: string,\n    analysis: CompetitiveAnalysis\n  ): Promise<void> {\n    const analysisId = `comp_analysis_${runId}_${Date.now()}`;\n    await this.db\n      .prepare(\n        `INSERT INTO competitive_analyses \n         (id, analysis_run_id, brand_share, competitor_shares, white_space_topics, \n          dominated_prompts, missing_brand_prompts, timestamp)\n         VALUES (?, ?, ?, ?, ?, ?, ?, ?)`\n      )\n      .bind(\n        analysisId,\n        runId,\n        analysis.brandShare,\n        JSON.stringify(analysis.competitorShares),\n        JSON.stringify(analysis.whiteSpaceTopics),\n        JSON.stringify(analysis.dominatedPrompts),\n        JSON.stringify(analysis.missingBrandPrompts),\n        analysis.timestamp\n      )\n      .run();\n  }\n\n  async saveTimeSeriesData(\n    runId: string,\n    data: TimeSeriesData\n  ): Promise<void> {\n    const dataId = `ts_${runId}_${Date.now()}`;\n    await this.db\n      .prepare(\n        `INSERT INTO time_series \n         (id, analysis_run_id, timestamp, visibility_score, citation_count, \n          brand_mention_count, competitor_mention_count)\n         VALUES (?, ?, ?, ?, ?, ?, ?)`\n      )\n      .bind(\n        dataId,\n        runId,\n        data.timestamp,\n        data.visibilityScore,\n        data.citationCount,\n        data.brandMentionCount,\n        data.competitorMentionCount\n      )\n      .run();\n  }\n\n  async getAnalysisRun(runId: string): Promise<AnalysisResult | null> {\n    // This would reconstruct the full analysis result from the database\n    // For brevity, implementing a simplified version\n    const run = await this.db\n      .prepare(\"SELECT * FROM analysis_runs WHERE id = ?\")\n      .bind(runId)\n      .first<{\n        id: string;\n        website_url: string;\n        country: string;\n        region: string | null;\n        language: string;\n        created_at: string;\n        updated_at: string;\n      }>();\n\n    if (!run) return null;\n\n    // Fetch related data (simplified - would need full joins in production)\n    return {\n      websiteUrl: run.website_url,\n      country: run.country,\n      language: run.language,\n      categories: [],\n      prompts: [],\n      analyses: [],\n      categoryMetrics: [],\n      competitiveAnalysis: {\n        brandShare: 0,\n        competitorShares: {},\n        whiteSpaceTopics: [],\n        dominatedPrompts: [],\n        missingBrandPrompts: [],\n        timestamp: run.updated_at,\n      },\n      timeSeries: [],\n      createdAt: run.created_at,\n      updatedAt: run.updated_at,\n    };\n  }\n\n  async getLatestAnalysisRun(\n    websiteUrl: string\n  ): Promise<string | null> {\n    const run = await this.db\n      .prepare(\n        \"SELECT id FROM analysis_runs WHERE website_url = ? ORDER BY created_at DESC LIMIT 1\"\n      )\n      .bind(websiteUrl)\n      .first<{ id: string }>();\n\n    return run?.id || null;\n  }\n\n  // Company Management\n  async createCompany(company: Omit<Company, \"id\" | \"createdAt\" | \"updatedAt\">): Promise<string> {\n    const id = `company_${Date.now()}_${Math.random().toString(36).substring(2, 9)}`;\n    const now = new Date().toISOString();\n    await this.db\n      .prepare(\n        `INSERT INTO companies (id, name, website_url, country, language, region, description, is_active, created_at, updated_at)\n         VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`\n      )\n      .bind(\n        id,\n        company.name,\n        company.websiteUrl,\n        company.country,\n        company.language,\n        company.region || null,\n        company.description || null,\n        company.isActive ? 1 : 0,\n        now,\n        now\n      )\n      .run();\n    return id;\n  }\n\n  async getCompany(companyId: string): Promise<Company | null> {\n    const company = await this.db\n      .prepare(\"SELECT * FROM companies WHERE id = ?\")\n      .bind(companyId)\n      .first<{\n        id: string;\n        name: string;\n        website_url: string;\n        country: string;\n        language: string;\n        region: string | null;\n        description: string | null;\n        is_active: number;\n        created_at: string;\n        updated_at: string;\n      }>();\n    \n    if (!company) return null;\n    \n    return {\n      id: company.id,\n      name: company.name,\n      websiteUrl: company.website_url,\n      country: company.country,\n      language: company.language,\n      region: company.region || undefined,\n      description: company.description || undefined,\n      isActive: company.is_active === 1,\n      createdAt: company.created_at,\n      updatedAt: company.updated_at,\n    };\n  }\n\n  async getAllCompanies(): Promise<Company[]> {\n    const companies = await this.db\n      .prepare(\"SELECT * FROM companies WHERE is_active = 1 ORDER BY created_at DESC\")\n      .all<{\n        id: string;\n        name: string;\n        website_url: string;\n        country: string;\n        language: string;\n        region: string | null;\n        description: string | null;\n        is_active: number;\n        created_at: string;\n        updated_at: string;\n      }>();\n    \n    return (companies.results || []).map(c => ({\n      id: c.id,\n      name: c.name,\n      websiteUrl: c.website_url,\n      country: c.country,\n      language: c.language,\n      region: c.region || undefined,\n      description: c.description || undefined,\n      isActive: c.is_active === 1,\n      createdAt: c.created_at,\n      updatedAt: c.updated_at,\n    }));\n  }\n\n  async updateCompany(companyId: string, updates: Partial<Company>): Promise<void> {\n    const fields: string[] = [];\n    const values: any[] = [];\n    \n    if (updates.name !== undefined) {\n      fields.push(\"name = ?\");\n      values.push(updates.name);\n    }\n    if (updates.websiteUrl !== undefined) {\n      fields.push(\"website_url = ?\");\n      values.push(updates.websiteUrl);\n    }\n    if (updates.country !== undefined) {\n      fields.push(\"country = ?\");\n      values.push(updates.country);\n    }\n    if (updates.language !== undefined) {\n      fields.push(\"language = ?\");\n      values.push(updates.language);\n    }\n    if (updates.region !== undefined) {\n      fields.push(\"region = ?\");\n      values.push(updates.region || null);\n    }\n    if (updates.description !== undefined) {\n      fields.push(\"description = ?\");\n      values.push(updates.description || null);\n    }\n    if (updates.isActive !== undefined) {\n      fields.push(\"is_active = ?\");\n      values.push(updates.isActive ? 1 : 0);\n    }\n    \n    fields.push(\"updated_at = ?\");\n    values.push(new Date().toISOString());\n    values.push(companyId);\n    \n    await this.db\n      .prepare(`UPDATE companies SET ${fields.join(\", \")} WHERE id = ?`)\n      .bind(...values)\n      .run();\n  }\n\n  // Company Prompts (saved questions for re-use)\n  async saveCompanyPrompt(prompt: Omit<CompanyPrompt, \"id\" | \"createdAt\" | \"updatedAt\">): Promise<string> {\n    const id = `prompt_${Date.now()}_${Math.random().toString(36).substring(2, 9)}`;\n    const now = new Date().toISOString();\n    await this.db\n      .prepare(\n        `INSERT INTO company_prompts (id, company_id, question, category_id, category_name, language, country, region, is_active, created_at, updated_at)\n         VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`\n      )\n      .bind(\n        id,\n        prompt.companyId,\n        prompt.question,\n        prompt.categoryId || null,\n        prompt.categoryName || null,\n        prompt.language,\n        prompt.country || null,\n        prompt.region || null,\n        prompt.isActive ? 1 : 0,\n        now,\n        now\n      )\n      .run();\n    return id;\n  }\n\n  async getCompanyPrompts(companyId: string, activeOnly: boolean = true): Promise<CompanyPrompt[]> {\n    const query = activeOnly\n      ? \"SELECT * FROM company_prompts WHERE company_id = ? AND is_active = 1 ORDER BY created_at DESC\"\n      : \"SELECT * FROM company_prompts WHERE company_id = ? ORDER BY created_at DESC\";\n    \n    const prompts = await this.db\n      .prepare(query)\n      .bind(companyId)\n      .all<{\n        id: string;\n        company_id: string;\n        question: string;\n        category_id: string | null;\n        category_name: string | null;\n        language: string;\n        country: string | null;\n        region: string | null;\n        is_active: number;\n        created_at: string;\n        updated_at: string;\n      }>();\n    \n    return (prompts.results || []).map(p => ({\n      id: p.id,\n      companyId: p.company_id,\n      question: p.question,\n      categoryId: p.category_id || undefined,\n      categoryName: p.category_name || undefined,\n      language: p.language,\n      country: p.country || undefined,\n      region: p.region || undefined,\n      isActive: p.is_active === 1,\n      createdAt: p.created_at,\n      updatedAt: p.updated_at,\n    }));\n  }\n\n  async getCompanyAnalysisRuns(companyId: string, limit: number = 50): Promise<any[]> {\n    const runs = await this.db\n      .prepare(\n        `SELECT id, website_url, country, language, status, created_at, updated_at \n         FROM analysis_runs \n         WHERE company_id = ? \n         ORDER BY created_at DESC \n         LIMIT ?`\n      )\n      .bind(companyId, limit)\n      .all<{\n        id: string;\n        website_url: string;\n        country: string;\n        language: string;\n        status: string;\n        created_at: string;\n        updated_at: string;\n      }>();\n    \n    return (runs.results || []).map(r => ({\n      id: r.id,\n      websiteUrl: r.website_url,\n      country: r.country,\n      language: r.language,\n      status: r.status,\n      createdAt: r.created_at,\n      updatedAt: r.updated_at,\n    }));\n  }\n\n  async getAllAnalysisRuns(limit: number = 100): Promise<any[]> {\n    try {\n    const runs = await this.db\n      .prepare(\n        `SELECT id, website_url, country, language, region, status, created_at, updated_at, company_id\n         FROM analysis_runs \n         ORDER BY created_at DESC \n         LIMIT ?`\n      )\n      .bind(limit)\n      .all<{\n        id: string;\n        website_url: string;\n        country: string;\n        language: string;\n        region: string | null;\n        status: string;\n        created_at: string;\n        updated_at: string;\n        company_id: string | null;\n      }>();\n    \n      // Ensure we always return an array\n      if (!runs || !runs.results) {\n        return [];\n      }\n      \n      return runs.results.map(r => ({\n      id: r.id,\n      websiteUrl: r.website_url,\n      country: r.country,\n      language: r.language,\n      region: r.region || undefined,\n        status: r.status || \"pending\",\n      createdAt: r.created_at,\n      updatedAt: r.updated_at,\n      companyId: r.company_id || undefined,\n    }));\n    } catch (error) {\n      console.error(\"Error in getAllAnalysisRuns:\", error);\n      return []; // Always return an array, even on error\n    }\n  }\n\n  async getCompanyTimeSeries(companyId: string, days: number = 30): Promise<TimeSeriesData[]> {\n    const cutoffDate = new Date();\n    cutoffDate.setDate(cutoffDate.getDate() - days);\n    \n    const timeSeries = await this.db\n      .prepare(\n        `SELECT ts.timestamp, ts.visibility_score, ts.citation_count, \n                ts.brand_mention_count, ts.competitor_mention_count\n         FROM time_series ts\n         JOIN analysis_runs ar ON ts.analysis_run_id = ar.id\n         WHERE ar.company_id = ? AND ts.timestamp >= ?\n         ORDER BY ts.timestamp ASC`\n      )\n      .bind(companyId, cutoffDate.toISOString())\n      .all<{\n        timestamp: string;\n        visibility_score: number;\n        citation_count: number;\n        brand_mention_count: number;\n        competitor_mention_count: number;\n      }>();\n    \n    return (timeSeries.results || []).map(ts => ({\n      timestamp: ts.timestamp,\n      visibilityScore: ts.visibility_score,\n      citationCount: ts.citation_count,\n      brandMentionCount: ts.brand_mention_count,\n      competitorMentionCount: ts.competitor_mention_count,\n    }));\n  }\n\n  // Scheduled Runs\n  async createScheduledRun(schedule: Omit<ScheduledRun, \"id\" | \"createdAt\" | \"updatedAt\">): Promise<string> {\n    const id = `schedule_${Date.now()}_${Math.random().toString(36).substring(2, 9)}`;\n    const now = new Date().toISOString();\n    await this.db\n      .prepare(\n        `INSERT INTO scheduled_runs (id, company_id, schedule_type, next_run_at, last_run_at, is_active, created_at, updated_at)\n         VALUES (?, ?, ?, ?, ?, ?, ?, ?)`\n      )\n      .bind(\n        id,\n        schedule.companyId,\n        schedule.scheduleType,\n        schedule.nextRunAt,\n        schedule.lastRunAt || null,\n        schedule.isActive ? 1 : 0,\n        now,\n        now\n      )\n      .run();\n    return id;\n  }\n\n  async getScheduledRuns(companyId?: string, activeOnly: boolean = true): Promise<ScheduledRun[]> {\n    let query = \"SELECT * FROM scheduled_runs\";\n    const conditions: string[] = [];\n    const values: any[] = [];\n    \n    if (companyId) {\n      conditions.push(\"company_id = ?\");\n      values.push(companyId);\n    }\n    if (activeOnly) {\n      conditions.push(\"is_active = 1\");\n    }\n    \n    if (conditions.length > 0) {\n      query += \" WHERE \" + conditions.join(\" AND \");\n    }\n    \n    query += \" ORDER BY next_run_at ASC\";\n    \n    const schedules = await this.db\n      .prepare(query)\n      .bind(...values)\n      .all<{\n        id: string;\n        company_id: string;\n        schedule_type: string;\n        next_run_at: string;\n        last_run_at: string | null;\n        is_active: number;\n        created_at: string;\n        updated_at: string;\n      }>();\n    \n    return (schedules.results || []).map(s => ({\n      id: s.id,\n      companyId: s.company_id,\n      scheduleType: s.schedule_type as \"daily\" | \"weekly\" | \"monthly\",\n      nextRunAt: s.next_run_at,\n      lastRunAt: s.last_run_at || undefined,\n      isActive: s.is_active === 1,\n      createdAt: s.created_at,\n      updatedAt: s.updated_at,\n    }));\n  }\n\n  async updateScheduledRun(scheduleId: string, updates: Partial<ScheduledRun>): Promise<void> {\n    const fields: string[] = [];\n    const values: any[] = [];\n    \n    if (updates.scheduleType !== undefined) {\n      fields.push(\"schedule_type = ?\");\n      values.push(updates.scheduleType);\n    }\n    if (updates.nextRunAt !== undefined) {\n      fields.push(\"next_run_at = ?\");\n      values.push(updates.nextRunAt);\n    }\n    if (updates.lastRunAt !== undefined) {\n      fields.push(\"last_run_at = ?\");\n      values.push(updates.lastRunAt || null);\n    }\n    if (updates.isActive !== undefined) {\n      fields.push(\"is_active = ?\");\n      values.push(updates.isActive ? 1 : 0);\n    }\n    \n    fields.push(\"updated_at = ?\");\n    values.push(new Date().toISOString());\n    values.push(scheduleId);\n    \n    await this.db\n      .prepare(`UPDATE scheduled_runs SET ${fields.join(\", \")} WHERE id = ?`)\n      .bind(...values)\n      .run();\n  }\n\n  async getScheduledRunsDue(): Promise<ScheduledRun[]> {\n    const now = new Date().toISOString();\n    const schedules = await this.db\n      .prepare(\n        `SELECT * FROM scheduled_runs \n         WHERE is_active = 1 AND next_run_at <= ? \n         ORDER BY next_run_at ASC`\n      )\n      .bind(now)\n      .all<{\n        id: string;\n        company_id: string;\n        schedule_type: string;\n        next_run_at: string;\n        last_run_at: string | null;\n        is_active: number;\n        created_at: string;\n        updated_at: string;\n      }>();\n    \n    return (schedules.results || []).map(s => ({\n      id: s.id,\n      companyId: s.company_id,\n      scheduleType: s.schedule_type as \"daily\" | \"weekly\" | \"monthly\",\n      nextRunAt: s.next_run_at,\n      lastRunAt: s.last_run_at || undefined,\n      isActive: s.is_active === 1,\n      createdAt: s.created_at,\n      updatedAt: s.updated_at,\n    }));\n  }\n}\n\n", "/**\n * Persistence module entry point\n */\n\nexport { Database } from \"./db.js\";\nexport type {\n  D1Database,\n  D1PreparedStatement,\n  D1Result,\n  D1ExecResult,\n} from \"./db.js\";\n\n\n\n\n\n\n\n", "/**\n * Brand mention detection module\n */\n\nimport type { LLMResponse, BrandMention } from \"../types.js\";\n\nexport class BrandMentionDetector {\n  constructor(\n    private brandName: string,\n    private fuzzyThreshold: number = 0.7\n  ) {}\n\n  detectMentions(response: LLMResponse): BrandMention {\n    const text = response.outputText.toLowerCase();\n    const brandLower = this.brandName.toLowerCase();\n    const brandInUrl = brandLower.replace(/\\s+/g, \"\"); // Remove spaces for URL matching\n\n    // Exact mentions in main text\n    const exactMatches = this.countExactMatches(text, brandLower);\n\n    // Check for brand name in markdown links like [frehnertec.ch](url)\n    // This counts as an additional mention if the link text contains the brand\n    const markdownLinkPattern = new RegExp(`\\\\[([^\\\\]]*${this.escapeRegex(brandInUrl)}[^\\\\]]*)\\\\]`, \"gi\");\n    const markdownMatches = response.outputText.match(markdownLinkPattern);\n    const markdownMentions = markdownMatches ? markdownMatches.length : 0;\n\n    // Combine: text mentions + markdown link mentions (if not already counted in text)\n    // Markdown links are usually separate from text mentions\n    const totalExact = exactMatches + markdownMentions;\n\n    // Fuzzy mentions (similarity-based)\n    const fuzzyMatches = this.countFuzzyMatches(text, brandLower);\n\n    // Extract contexts (including from markdown links)\n    const contexts = this.extractContexts(response.outputText, brandLower);\n\n    return {\n      exact: totalExact,\n      fuzzy: fuzzyMatches,\n      contexts,\n    };\n  }\n\n  private countExactMatches(text: string, brandLower: string): number {\n    // Handle multi-word brand names\n    const brandWords = brandLower.split(/\\s+/);\n    \n    if (brandWords.length === 1) {\n      // Single word: use word boundaries\n      const regex = new RegExp(`\\\\b${this.escapeRegex(brandLower)}\\\\b`, \"gi\");\n      const matches = text.match(regex);\n      return matches ? matches.length : 0;\n    } else {\n      // Multi-word: match the phrase as a whole\n      const phraseRegex = new RegExp(`\\\\b${this.escapeRegex(brandLower)}\\\\b`, \"gi\");\n      const phraseMatches = text.match(phraseRegex);\n      const phraseCount = phraseMatches ? phraseMatches.length : 0;\n      \n      // Also check if all words appear together (in order)\n      const wordsPattern = brandWords.map(w => this.escapeRegex(w)).join(\"\\\\s+\");\n      const wordsRegex = new RegExp(`\\\\b${wordsPattern}\\\\b`, \"gi\");\n      const wordsMatches = text.match(wordsRegex);\n      const wordsCount = wordsMatches ? wordsMatches.length : 0;\n      \n      // Return the maximum (to avoid double counting)\n      return Math.max(phraseCount, wordsCount);\n    }\n  }\n\n  private countFuzzyMatches(text: string, brandLower: string): number {\n    const brandWords = brandLower.split(/\\s+/);\n    let fuzzyCount = 0;\n    const foundPositions = new Set<number>(); // Track positions to avoid double counting\n\n    if (brandWords.length === 1) {\n      // Single word brand: check individual words and similar phrases\n      const words = text.split(/\\s+/);\n      \n      for (let i = 0; i < words.length; i++) {\n        const word = words[i].replace(/[^\\w]/g, \"\"); // Remove punctuation\n        if (word.length === 0) continue;\n        \n        const similarity = this.calculateSimilarity(word, brandLower);\n        if (similarity >= this.fuzzyThreshold && similarity < 1.0) {\n          if (!foundPositions.has(i)) {\n            fuzzyCount++;\n            foundPositions.add(i);\n          }\n        }\n      }\n      \n      // Also check for split versions (e.g., \"Acme Corp\" vs \"AcmeCorp\")\n      const brandWithoutSpaces = brandLower.replace(/\\s+/g, \"\");\n      for (let i = 0; i < words.length; i++) {\n        const word = words[i].replace(/[^\\w]/g, \"\");\n        if (word.length === 0) continue;\n        \n        const similarity = this.calculateSimilarity(word, brandWithoutSpaces);\n        if (similarity >= this.fuzzyThreshold && similarity < 1.0) {\n          if (!foundPositions.has(i)) {\n            fuzzyCount++;\n            foundPositions.add(i);\n          }\n        }\n      }\n    } else {\n      // Multi-word brand: check for similar phrases\n      // Check if words appear together but with variations\n      const textWords = text.split(/\\s+/).map(w => w.replace(/[^\\w]/g, \"\"));\n      \n      // Sliding window approach for multi-word matching\n      for (let i = 0; i <= textWords.length - brandWords.length; i++) {\n        const window = textWords.slice(i, i + brandWords.length);\n        const phrase = window.join(\" \");\n        const originalPhrase = text.split(/\\s+/).slice(i, i + brandWords.length).join(\" \");\n        \n        // Check similarity of the phrase\n        const similarity = this.calculateSimilarity(phrase, brandLower);\n        if (similarity >= this.fuzzyThreshold && similarity < 1.0) {\n          // Check if we haven't already counted this position\n          const startPos = text.indexOf(originalPhrase);\n          if (startPos !== -1 && !foundPositions.has(startPos)) {\n            fuzzyCount++;\n            foundPositions.add(startPos);\n          }\n        }\n        \n        // Also check without spaces (e.g., \"AcmeCorp\" vs \"Acme Corp\")\n        const phraseNoSpaces = phrase.replace(/\\s+/g, \"\");\n        const brandNoSpaces = brandLower.replace(/\\s+/g, \"\");\n        const similarityNoSpaces = this.calculateSimilarity(phraseNoSpaces, brandNoSpaces);\n        if (similarityNoSpaces >= this.fuzzyThreshold && similarityNoSpaces < 1.0) {\n          const startPos = text.indexOf(originalPhrase);\n          if (startPos !== -1 && !foundPositions.has(startPos)) {\n            fuzzyCount++;\n            foundPositions.add(startPos);\n          }\n        }\n      }\n    }\n\n    return fuzzyCount;\n  }\n\n  private calculateSimilarity(str1: string, str2: string): number {\n    // Simple Levenshtein-based similarity\n    const longer = str1.length > str2.length ? str1 : str2;\n    const shorter = str1.length > str2.length ? str2 : str1;\n\n    if (longer.length === 0) return 1.0;\n\n    const distance = this.levenshteinDistance(longer, shorter);\n    return (longer.length - distance) / longer.length;\n  }\n\n  private levenshteinDistance(str1: string, str2: string): number {\n    const matrix: number[][] = [];\n\n    for (let i = 0; i <= str2.length; i++) {\n      matrix[i] = [i];\n    }\n\n    for (let j = 0; j <= str1.length; j++) {\n      matrix[0][j] = j;\n    }\n\n    for (let i = 1; i <= str2.length; i++) {\n      for (let j = 1; j <= str1.length; j++) {\n        if (str2.charAt(i - 1) === str1.charAt(j - 1)) {\n          matrix[i][j] = matrix[i - 1][j - 1];\n        } else {\n          matrix[i][j] = Math.min(\n            matrix[i - 1][j - 1] + 1,\n            matrix[i][j - 1] + 1,\n            matrix[i - 1][j] + 1\n          );\n        }\n      }\n    }\n\n    return matrix[str2.length][str1.length];\n  }\n\n  private extractContexts(text: string, brandLower: string): string[] {\n    const contexts: string[] = [];\n    const brandWords = brandLower.split(/\\s+/);\n    const brandInUrl = brandLower.replace(/\\s+/g, \"\");\n    \n    // Split by sentence boundaries, but keep the delimiters\n    const sentences = text.split(/([.!?]+)/);\n    const sentenceList: string[] = [];\n    \n    // Reconstruct sentences with their punctuation\n    for (let i = 0; i < sentences.length; i += 2) {\n      if (sentences[i]) {\n        const sentence = sentences[i] + (sentences[i + 1] || \"\");\n        sentenceList.push(sentence);\n      }\n    }\n    \n    // Also check for contexts around exact and fuzzy matches\n    const allMatches: Array<{ start: number; end: number }> = [];\n    \n    // Find exact matches\n    const exactRegex = new RegExp(`\\\\b${this.escapeRegex(brandLower)}\\\\b`, \"gi\");\n    let match;\n    while ((match = exactRegex.exec(text)) !== null) {\n      allMatches.push({ start: match.index, end: match.index + match[0].length });\n    }\n    \n    // Find markdown links\n    const markdownLinkPattern = new RegExp(`\\\\[([^\\\\]]*${this.escapeRegex(brandInUrl)}[^\\\\]]*)\\\\]`, \"gi\");\n    while ((match = markdownLinkPattern.exec(text)) !== null) {\n      allMatches.push({ start: match.index, end: match.index + match[0].length });\n    }\n    \n    // Find fuzzy matches (check for similar phrases)\n    const textLower = text.toLowerCase();\n    const words = textLower.split(/\\s+/);\n    \n    if (brandWords.length === 1) {\n      // Single word: check individual words\n      let currentPos = 0;\n      for (const word of words) {\n        const cleanWord = word.replace(/[^\\w]/g, \"\");\n        if (cleanWord.length > 0) {\n          const similarity = this.calculateSimilarity(cleanWord, brandLower);\n          if (similarity >= this.fuzzyThreshold && similarity < 1.0) {\n            const wordIndex = textLower.indexOf(word, currentPos);\n            if (wordIndex !== -1) {\n              allMatches.push({ start: wordIndex, end: wordIndex + word.length });\n              currentPos = wordIndex + word.length;\n            }\n          }\n        }\n      }\n    } else {\n      // Multi-word: check for similar phrases\n      for (let i = 0; i <= words.length - brandWords.length; i++) {\n        const window = words.slice(i, i + brandWords.length);\n        const phrase = window.join(\" \");\n        const similarity = this.calculateSimilarity(phrase, brandLower);\n        if (similarity >= this.fuzzyThreshold && similarity < 1.0) {\n          const phraseIndex = textLower.indexOf(phrase);\n          if (phraseIndex !== -1) {\n            allMatches.push({ start: phraseIndex, end: phraseIndex + phrase.length });\n          }\n        }\n      }\n    }\n    \n    // Extract contexts around matches\n    for (const match of allMatches) {\n      const start = Math.max(0, match.start - 100); // 100 chars before\n      const end = Math.min(text.length, match.end + 100); // 100 chars after\n      const context = text.substring(start, end).trim();\n      \n      // Clean up context (remove partial words at start/end if needed)\n      const cleanContext = context.replace(/^[^\\w\\s]+/, \"\").replace(/[^\\w\\s]+$/, \"\");\n      \n      if (cleanContext && !contexts.includes(cleanContext)) {\n        contexts.push(cleanContext);\n      }\n    }\n    \n    // Also check sentences that contain the brand\n    for (const sentence of sentenceList) {\n      const sentenceLower = sentence.toLowerCase();\n      if (sentenceLower.includes(brandLower) || sentenceLower.includes(brandInUrl)) {\n        const trimmed = sentence.trim();\n        if (trimmed && !contexts.includes(trimmed)) {\n          contexts.push(trimmed);\n        }\n      }\n    }\n\n    return contexts.slice(0, 5); // Limit to 5 contexts\n  }\n\n  private escapeRegex(str: string): string {\n    return str.replace(/[.*+?^${}()|[\\]\\\\]/g, \"\\\\$&\");\n  }\n}\n\n\n\n\n\n\n\n", "/**\n * Competitor detection module\n */\n\nimport type { LLMResponse, CompetitorMention } from \"../types.js\";\n\nexport class CompetitorDetector {\n  constructor(private brandName: string) {}\n\n  detectCompetitors(\n    response: LLMResponse,\n    knownCompetitors?: string[]\n  ): CompetitorMention[] {\n    const text = response.outputText;\n    const competitors: Map<string, CompetitorMention> = new Map();\n\n    // Extract potential competitor names\n    const potentialCompetitors = this.extractPotentialCompetitors(\n      text,\n      knownCompetitors\n    );\n\n    for (const competitor of potentialCompetitors) {\n      if (competitor.toLowerCase() === this.brandName.toLowerCase()) {\n        continue; // Skip the brand itself\n      }\n\n      const count = this.countMentions(text, competitor);\n      if (count > 0) {\n        const contexts = this.extractContexts(text, competitor);\n        const citations = this.extractRelevantCitations(\n          response.citations,\n          competitor\n        );\n\n        competitors.set(competitor, {\n          name: competitor,\n          count,\n          contexts,\n          citations: citations.map((c) => c.url),\n        });\n      }\n    }\n\n    return Array.from(competitors.values()).sort(\n      (a, b) => b.count - a.count\n    );\n  }\n\n  private extractPotentialCompetitors(\n    text: string,\n    knownCompetitors?: string[]\n  ): string[] {\n    const competitors = new Set<string>();\n\n    // Add known competitors\n    if (knownCompetitors) {\n      for (const comp of knownCompetitors) {\n        competitors.add(comp);\n      }\n    }\n\n    // Common words that should NOT be considered competitors\n    const commonWords = new Set([\n      'this', 'that', 'these', 'those', 'the', 'a', 'an', 'and', 'or', 'but',\n      'is', 'are', 'was', 'were', 'be', 'been', 'being', 'have', 'has', 'had',\n      'do', 'does', 'did', 'will', 'would', 'should', 'could', 'may', 'might',\n      'can', 'must', 'shall', 'should', 'will', 'would', 'get', 'got', 'go',\n      'come', 'see', 'know', 'think', 'take', 'give', 'make', 'find', 'say',\n      'tell', 'ask', 'work', 'try', 'use', 'want', 'need', 'feel', 'become',\n      'leave', 'put', 'mean', 'keep', 'let', 'begin', 'seem', 'help', 'show',\n      'hear', 'play', 'run', 'move', 'like', 'live', 'believe', 'bring', 'happen',\n      'write', 'sit', 'stand', 'lose', 'pay', 'meet', 'include', 'continue',\n      'set', 'learn', 'change', 'lead', 'understand', 'watch', 'follow', 'stop',\n      'create', 'speak', 'read', 'spend', 'grow', 'open', 'walk', 'win', 'offer',\n      'remember', 'love', 'consider', 'appear', 'buy', 'wait', 'serve', 'die',\n      'send', 'build', 'stay', 'fall', 'cut', 'reach', 'kill', 'raise', 'pass',\n      'sell', 'decide', 'return', 'explain', 'develop', 'carry', 'break', 'receive',\n      'agree', 'support', 'hit', 'produce', 'eat', 'cover', 'catch', 'draw',\n      'choose', 'cause', 'provide', 'happen', 'focus', 'routine', 'values',\n      'staying', 'define', 'divide', 'establish', 'consistency', 'track',\n      'progress', 'seeing', 'celebrate', 'positive', 'believing', 'accountability',\n      'share', 'being', 'eliminate', 'distractions', 'identify', 'reflect',\n      'adjust', 'regularly', 'practice', 'patience', 'connect', 'habits', 'align',\n      'clear', 'goals', 'break', 'down', 'create', 'use', 'reminders', 'keep',\n      'reward', 'yourself', 'stay', 'share', 'being', 'eliminate', 'identify',\n      'reflect', 'adjust', 'regularly', 'practice', 'understand', 'connect', 'align'\n    ]);\n\n    // Extract from comparison phrases (more specific patterns)\n    const comparisonPatterns = [\n      /(?:compared to|vs\\.?|versus|alternative to|instead of|rather than)\\s+([A-Z][a-zA-Z0-9]+(?:\\s+[A-Z][a-zA-Z0-9]+)+)(?:[.,;]|\\s+is|\\s+are|$)/gi,\n      /([A-Z][a-zA-Z0-9]+(?:\\s+[A-Z][a-zA-Z0-9]+)+)\\s+(?:is|are)\\s+(?:a|an|another)\\s+(?:good|popular|better|alternative|leading|major)\\s+(?:option|choice|solution|company|service|platform|tool)/gi,\n      /(?:competitors?|alternatives?|similar|other)\\s+(?:include|are|like)\\s+([A-Z][a-zA-Z0-9]+(?:\\s+[A-Z][a-zA-Z0-9]+)+)/gi,\n    ];\n\n    for (const pattern of comparisonPatterns) {\n      let match;\n      while ((match = pattern.exec(text)) !== null) {\n        const name = match[1].trim();\n        // Only add if it's at least 2 words and not a common word\n        const words = name.split(/\\s+/);\n        if (words.length >= 2 && name.length >= 4 && name.length < 50) {\n          const firstWord = words[0].toLowerCase();\n          if (!commonWords.has(firstWord) && !commonWords.has(name.toLowerCase())) {\n            competitors.add(name);\n          }\n        }\n      }\n    }\n\n    // Extract company-like names (must be at least 2 words, start with capital)\n    // Look for patterns like \"Company Name\", \"Brand Inc\", \"Service LLC\", etc.\n    const companyPatterns = [\n      /\\b([A-Z][a-z]+(?:\\s+[A-Z][a-z]+)+)\\s+(?:Inc|LLC|Ltd|Corp|Corporation|Company|Co|Group|Solutions|Services|Technologies|Tech|Systems|Software|Digital|Media|Consulting|Partners|Associates|Enterprises|Industries|International|Global|Worldwide)\\b/gi,\n      /\\b([A-Z][a-z]+(?:\\s+[A-Z][a-z]+){1,3})\\s+(?:is|are|offers|provides|delivers|creates|develops|designs|builds|sells|manufactures)\\s+(?:a|an|the)\\s+[a-z]+/gi,\n    ];\n\n    for (const pattern of companyPatterns) {\n      let match;\n      while ((match = pattern.exec(text)) !== null) {\n        const name = match[1].trim();\n        const words = name.split(/\\s+/);\n        if (words.length >= 2 && name.length >= 4 && name.length < 50) {\n          const firstWord = words[0].toLowerCase();\n          if (!commonWords.has(firstWord)) {\n            competitors.add(name);\n          }\n        }\n      }\n    }\n\n    return Array.from(competitors);\n  }\n\n  private countMentions(text: string, competitor: string): number {\n    const regex = new RegExp(\n      `\\\\b${this.escapeRegex(competitor)}\\\\b`,\n      \"gi\"\n    );\n    const matches = text.match(regex);\n    return matches ? matches.length : 0;\n  }\n\n  private extractContexts(text: string, competitor: string): string[] {\n    const contexts: string[] = [];\n    const sentences = text.split(/[.!?]+/);\n\n    for (const sentence of sentences) {\n      if (new RegExp(`\\\\b${this.escapeRegex(competitor)}\\\\b`, \"i\").test(sentence)) {\n        contexts.push(sentence.trim());\n      }\n    }\n\n    return contexts.slice(0, 3); // Limit to 3 contexts\n  }\n\n  private extractRelevantCitations(\n    citations: LLMResponse[\"citations\"],\n    competitor: string\n  ): LLMResponse[\"citations\"] {\n    return citations.filter((citation) => {\n      const text = `${citation.title || \"\"} ${citation.snippet || \"\"}`.toLowerCase();\n      return text.includes(competitor.toLowerCase());\n    });\n  }\n\n  private escapeRegex(str: string): string {\n    return str.replace(/[.*+?^${}()|[\\]\\\\]/g, \"\\\\$&\");\n  }\n}\n\n", "/**\n * Sentiment analysis module\n */\n\nimport type { LLMResponse, SentimentAnalysis } from \"../types.js\";\n\nexport class SentimentAnalyzer {\n  private readonly positiveKeywords = [\n    \"excellent\",\n    \"great\",\n    \"best\",\n    \"top\",\n    \"leading\",\n    \"outstanding\",\n    \"superior\",\n    \"recommended\",\n    \"popular\",\n    \"trusted\",\n    \"reliable\",\n    \"innovative\",\n    \"effective\",\n    \"efficient\",\n    \"powerful\",\n    \"comprehensive\",\n    \"advanced\",\n    \"professional\",\n    \"quality\",\n    \"expert\",\n  ];\n\n  private readonly negativeKeywords = [\n    \"poor\",\n    \"bad\",\n    \"worst\",\n    \"limited\",\n    \"lacks\",\n    \"missing\",\n    \"inadequate\",\n    \"insufficient\",\n    \"problematic\",\n    \"difficult\",\n    \"complex\",\n    \"expensive\",\n    \"overpriced\",\n    \"slow\",\n    \"unreliable\",\n    \"outdated\",\n    \"inferior\",\n    \"weak\",\n    \"flawed\",\n    \"disappointing\",\n  ];\n\n  analyzeSentiment(response: LLMResponse): SentimentAnalysis {\n    const text = response.outputText.toLowerCase();\n    const words = text.split(/\\s+/);\n\n    let positiveScore = 0;\n    let negativeScore = 0;\n    const foundKeywords: string[] = [];\n\n    for (const word of words) {\n      const cleanWord = word.replace(/[.,!?;:]/g, \"\");\n\n      if (this.positiveKeywords.includes(cleanWord)) {\n        positiveScore++;\n        if (!foundKeywords.includes(cleanWord)) {\n          foundKeywords.push(cleanWord);\n        }\n      }\n\n      if (this.negativeKeywords.includes(cleanWord)) {\n        negativeScore++;\n        if (!foundKeywords.includes(cleanWord)) {\n          foundKeywords.push(cleanWord);\n        }\n      }\n    }\n\n    // Determine tone\n    let tone: SentimentAnalysis[\"tone\"];\n    const totalScore = positiveScore + negativeScore;\n\n    if (totalScore === 0) {\n      tone = \"neutral\";\n    } else if (positiveScore > negativeScore * 2) {\n      tone = \"positive\";\n    } else if (negativeScore > positiveScore * 2) {\n      tone = \"negative\";\n    } else {\n      tone = \"mixed\";\n    }\n\n    // Calculate confidence based on keyword density\n    const confidence = Math.min(\n      totalScore / Math.max(words.length / 100, 1),\n      1.0\n    );\n\n    return {\n      tone,\n      confidence: Math.max(confidence, 0.1), // Minimum confidence\n      keywords: foundKeywords.slice(0, 10),\n    };\n  }\n}\n\n\n\n\n\n\n\n", "/**\n * Analysis module entry point\n */\n\nimport type {\n  Prompt,\n  LLMResponse,\n  PromptAnalysis,\n  CategoryMetrics,\n  CompetitiveAnalysis,\n  BrandCitation,\n} from \"../types.js\";\nimport { BrandMentionDetector } from \"./brand_mention.js\";\nimport { CompetitorDetector } from \"./competitor.js\";\nimport { SentimentAnalyzer } from \"./sentiment.js\";\n\nexport class AnalysisEngine {\n  private brandMentionDetector: BrandMentionDetector;\n  private competitorDetector: CompetitorDetector;\n  private sentimentAnalyzer: SentimentAnalyzer;\n  private brandName: string;\n\n  constructor(\n    brandName: string,\n    fuzzyThreshold: number = 0.7,\n    knownCompetitors?: string[]\n  ) {\n    this.brandName = brandName;\n    this.brandMentionDetector = new BrandMentionDetector(\n      brandName,\n      fuzzyThreshold\n    );\n    this.competitorDetector = new CompetitorDetector(brandName);\n    this.sentimentAnalyzer = new SentimentAnalyzer();\n  }\n\n  analyzeResponses(\n    prompts: Prompt[],\n    responses: LLMResponse[]\n  ): PromptAnalysis[] {\n    const analyses: PromptAnalysis[] = [];\n\n    for (const prompt of prompts) {\n      const response = responses.find((r) => r.promptId === prompt.id);\n      if (!response) continue;\n\n      const analysis = this.analyzeSingleResponse(prompt, response);\n      analyses.push(analysis);\n    }\n\n    return analyses;\n  }\n\n  private analyzeSingleResponse(\n    prompt: Prompt,\n    response: LLMResponse\n  ): PromptAnalysis {\n    const brandMentions = this.brandMentionDetector.detectMentions(response);\n    const competitors = this.competitorDetector.detectCompetitors(response);\n    const sentiment = this.sentimentAnalyzer.analyzeSentiment(response);\n    \n    // Find citations where the brand is mentioned\n    const brandCitations = this.findBrandCitations(response);\n    \n    // Calculate structured answers\n    const isMentioned = brandMentions.exact > 0 || brandMentions.fuzzy > 0;\n    const mentionCount = brandMentions.exact + brandMentions.fuzzy;\n    const isCited = brandCitations.length > 0;\n    \n    // Citation details (where and what)\n    const citationDetails = brandCitations.map(c => ({\n      url: c.url,\n      title: c.title,\n      snippet: c.snippet,\n    }));\n    \n    // Competitor details (which companies and where)\n    const competitorDetails = competitors.map(c => ({\n      name: c.name,\n      count: c.count,\n      locations: c.citations, // URLs where competitor is mentioned\n    }));\n\n    return {\n      promptId: prompt.id,\n      brandMentions,\n      citationCount: response.citations.length,\n      citationUrls: response.citations.map((c) => c.url),\n      brandCitations,\n      competitors,\n      sentiment,\n      timestamp: response.timestamp,\n      // Structured answers\n      isMentioned,\n      mentionCount,\n      isCited,\n      citationDetails,\n      competitorDetails,\n    };\n  }\n  \n  private findBrandCitations(response: LLMResponse): BrandCitation[] {\n    const brandLower = this.brandName.toLowerCase();\n    const brandInUrl = brandLower.replace(/\\s+/g, \"\"); // Remove spaces for URL matching\n    const brandCitations: BrandCitation[] = [];\n    \n    for (const citation of response.citations) {\n      const citationText = `${citation.title || \"\"} ${citation.snippet || \"\"}`.toLowerCase();\n      const urlLower = citation.url.toLowerCase();\n      \n      // Check if brand is mentioned in citation title, snippet, or URL\n      const mentionedInText = citationText.includes(brandLower);\n      const mentionedInUrl = urlLower.includes(brandInUrl);\n      \n      if (mentionedInText || mentionedInUrl) {\n        // Extract context where brand is mentioned\n        let context = \"\";\n        if (mentionedInText) {\n          context = this.extractBrandContextFromCitation(citation, brandLower);\n        } else if (mentionedInUrl) {\n          // Find context in the main text where this URL is referenced\n          context = this.findUrlContextInText(response.outputText, citation.url);\n        }\n        \n        brandCitations.push({\n          url: citation.url,\n          title: citation.title,\n          snippet: citation.snippet,\n          context,\n        });\n      }\n    }\n    \n    return brandCitations;\n  }\n  \n  private findUrlContextInText(text: string, url: string): string {\n    // Find markdown links or plain URLs in text\n    // Pattern: [text](url) or just url\n    const urlPattern = url.replace(/[.*+?^${}()|[\\]\\\\]/g, \"\\\\$&\");\n    const markdownPattern = new RegExp(`\\\\[([^\\\\]]+)\\\\]\\\\(${urlPattern}\\\\)`, \"i\");\n    const match = text.match(markdownPattern);\n    \n    if (match && match[1]) {\n      return match[1]; // Return the link text\n    }\n    \n    // Try to find sentence containing the URL\n    const sentences = text.split(/[.!?]+/);\n    for (const sentence of sentences) {\n      if (sentence.includes(url)) {\n        return sentence.trim();\n      }\n    }\n    \n    return \"\";\n  }\n  \n  private extractBrandContextFromCitation(\n    citation: { title?: string; snippet?: string },\n    brandLower: string\n  ): string | undefined {\n    const text = `${citation.title || \"\"} ${citation.snippet || \"\"}`;\n    const sentences = text.split(/[.!?]+/);\n    \n    for (const sentence of sentences) {\n      if (sentence.toLowerCase().includes(brandLower)) {\n        return sentence.trim();\n      }\n    }\n    \n    return undefined;\n  }\n\n  calculateCategoryMetrics(\n    categoryId: string,\n    prompts: Prompt[],\n    analyses: PromptAnalysis[]\n  ): CategoryMetrics {\n    const categoryPrompts = prompts.filter((p) => p.categoryId === categoryId);\n    const categoryAnalyses = analyses.filter((a) =>\n      categoryPrompts.some((p) => p.id === a.promptId)\n    );\n\n    if (categoryAnalyses.length === 0) {\n      return {\n        categoryId,\n        visibilityScore: 0,\n        citationRate: 0,\n        brandMentionRate: 0,\n        competitorMentionRate: 0,\n        timestamp: new Date().toISOString(),\n      };\n    }\n\n    const totalPrompts = categoryPrompts.length;\n    const promptsWithBrandMentions = categoryAnalyses.filter(\n      (a) => a.brandMentions.exact > 0 || a.brandMentions.fuzzy > 0\n    ).length;\n    const promptsWithCompetitors = categoryAnalyses.filter(\n      (a) => a.competitors.length > 0\n    ).length;\n    const totalCitations = categoryAnalyses.reduce(\n      (sum, a) => sum + a.citationCount,\n      0\n    );\n\n    const visibilityScore = this.calculateVisibilityScore(categoryAnalyses);\n    const citationRate = totalCitations / totalPrompts;\n    const brandMentionRate = promptsWithBrandMentions / totalPrompts;\n    const competitorMentionRate = promptsWithCompetitors / totalPrompts;\n\n    return {\n      categoryId,\n      visibilityScore,\n      citationRate,\n      brandMentionRate,\n      competitorMentionRate,\n      timestamp: new Date().toISOString(),\n    };\n  }\n\n  private calculateVisibilityScore(analyses: PromptAnalysis[]): number {\n    // Visibility score based on:\n    // - Brand mentions (weighted)\n    // - Citation count\n    // - Sentiment (positive boosts score)\n\n    let score = 0;\n\n    for (const analysis of analyses) {\n      // Brand mentions contribute to score\n      score += analysis.brandMentions.exact * 10;\n      score += analysis.brandMentions.fuzzy * 5;\n\n      // Citations contribute\n      score += analysis.citationCount * 2;\n\n      // Positive sentiment boosts\n      if (analysis.sentiment.tone === \"positive\") {\n        score += 5;\n      } else if (analysis.sentiment.tone === \"negative\") {\n        score -= 5;\n      }\n    }\n\n    // Normalize to 0-100\n    const maxPossibleScore = analyses.length * 50; // Rough estimate\n    return Math.min(Math.max((score / maxPossibleScore) * 100, 0), 100);\n  }\n\n  performCompetitiveAnalysis(\n    analyses: PromptAnalysis[],\n    prompts: Prompt[]\n  ): CompetitiveAnalysis {\n    const totalMentions = analyses.reduce(\n      (sum, a) => sum + a.brandMentions.exact + a.brandMentions.fuzzy,\n      0\n    );\n\n    const competitorMentions = new Map<string, number>();\n    for (const analysis of analyses) {\n      for (const competitor of analysis.competitors) {\n        competitorMentions.set(\n          competitor.name,\n          (competitorMentions.get(competitor.name) || 0) + competitor.count\n        );\n      }\n    }\n\n    const totalCompetitorMentions = Array.from(\n      competitorMentions.values()\n    ).reduce((sum, count) => sum + count, 0);\n\n    const totalAllMentions = totalMentions + totalCompetitorMentions;\n\n    // Calculate shares\n    const brandShare =\n      totalAllMentions > 0 ? (totalMentions / totalAllMentions) * 100 : 0;\n\n    const competitorShares: Record<string, number> = {};\n    for (const [name, count] of competitorMentions.entries()) {\n      competitorShares[name] =\n        totalAllMentions > 0 ? (count / totalAllMentions) * 100 : 0;\n    }\n\n    // Identify white space topics (prompts with no brand or competitor mentions)\n    const whiteSpaceTopics = prompts\n      .filter((p) => {\n        const analysis = analyses.find((a) => a.promptId === p.id);\n        if (!analysis) return true;\n        return (\n          analysis.brandMentions.exact === 0 &&\n          analysis.brandMentions.fuzzy === 0 &&\n          analysis.competitors.length === 0\n        );\n      })\n      .map((p) => p.question);\n\n    // Identify dominated prompts (competitors mentioned more than brand)\n    const dominatedPrompts = prompts\n      .filter((p) => {\n        const analysis = analyses.find((a) => a.promptId === p.id);\n        if (!analysis) return false;\n        const brandCount =\n          analysis.brandMentions.exact + analysis.brandMentions.fuzzy;\n        const competitorCount = analysis.competitors.reduce(\n          (sum, c) => sum + c.count,\n          0\n        );\n        return competitorCount > brandCount && brandCount === 0;\n      })\n      .map((p) => p.id);\n\n    // Identify missing brand prompts\n    const missingBrandPrompts = prompts\n      .filter((p) => {\n        const analysis = analyses.find((a) => a.promptId === p.id);\n        if (!analysis) return true;\n        return (\n          analysis.brandMentions.exact === 0 &&\n          analysis.brandMentions.fuzzy === 0\n        );\n      })\n      .map((p) => p.id);\n\n    return {\n      brandShare,\n      competitorShares,\n      whiteSpaceTopics,\n      dominatedPrompts,\n      missingBrandPrompts,\n      timestamp: new Date().toISOString(),\n    };\n  }\n}\n\nexport { BrandMentionDetector } from \"./brand_mention.js\";\nexport { CompetitorDetector } from \"./competitor.js\";\nexport { SentimentAnalyzer } from \"./sentiment.js\";\n\n\n", "// This loads all middlewares exposed on the middleware object and then starts\n// the invocation chain. The big idea is that we can add these to the middleware\n// export dynamically through wrangler, or we can potentially let users directly\n// add them as a sort of \"plugin\" system.\n\nimport ENTRY, { __INTERNAL_WRANGLER_MIDDLEWARE__ } from \"/Users/maurofrehner/Desktop/GitHub/GEO_dashboard/.wrangler/tmp/bundle-doaM6S/middleware-insertion-facade.js\";\nimport { __facade_invoke__, __facade_register__, Dispatcher } from \"/Users/maurofrehner/Desktop/GitHub/GEO_dashboard/node_modules/wrangler/templates/middleware/common.ts\";\nimport type { WorkerEntrypointConstructor } from \"/Users/maurofrehner/Desktop/GitHub/GEO_dashboard/.wrangler/tmp/bundle-doaM6S/middleware-insertion-facade.js\";\n\n// Preserve all the exports from the worker\nexport * from \"/Users/maurofrehner/Desktop/GitHub/GEO_dashboard/.wrangler/tmp/bundle-doaM6S/middleware-insertion-facade.js\";\n\nclass __Facade_ScheduledController__ implements ScheduledController {\n\treadonly #noRetry: ScheduledController[\"noRetry\"];\n\n\tconstructor(\n\t\treadonly scheduledTime: number,\n\t\treadonly cron: string,\n\t\tnoRetry: ScheduledController[\"noRetry\"]\n\t) {\n\t\tthis.#noRetry = noRetry;\n\t}\n\n\tnoRetry() {\n\t\tif (!(this instanceof __Facade_ScheduledController__)) {\n\t\t\tthrow new TypeError(\"Illegal invocation\");\n\t\t}\n\t\t// Need to call native method immediately in case uncaught error thrown\n\t\tthis.#noRetry();\n\t}\n}\n\nfunction wrapExportedHandler(worker: ExportedHandler): ExportedHandler {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn worker;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\tconst fetchDispatcher: ExportedHandlerFetchHandler = function (\n\t\trequest,\n\t\tenv,\n\t\tctx\n\t) {\n\t\tif (worker.fetch === undefined) {\n\t\t\tthrow new Error(\"Handler does not export a fetch() function.\");\n\t\t}\n\t\treturn worker.fetch(request, env, ctx);\n\t};\n\n\treturn {\n\t\t...worker,\n\t\tfetch(request, env, ctx) {\n\t\t\tconst dispatcher: Dispatcher = function (type, init) {\n\t\t\t\tif (type === \"scheduled\" && worker.scheduled !== undefined) {\n\t\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\t\tDate.now(),\n\t\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t\t() => {}\n\t\t\t\t\t);\n\t\t\t\t\treturn worker.scheduled(controller, env, ctx);\n\t\t\t\t}\n\t\t\t};\n\t\t\treturn __facade_invoke__(request, env, ctx, dispatcher, fetchDispatcher);\n\t\t},\n\t};\n}\n\nfunction wrapWorkerEntrypoint(\n\tklass: WorkerEntrypointConstructor\n): WorkerEntrypointConstructor {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn klass;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\t// `extend`ing `klass` here so other RPC methods remain callable\n\treturn class extends klass {\n\t\t#fetchDispatcher: ExportedHandlerFetchHandler<Record<string, unknown>> = (\n\t\t\trequest,\n\t\t\tenv,\n\t\t\tctx\n\t\t) => {\n\t\t\tthis.env = env;\n\t\t\tthis.ctx = ctx;\n\t\t\tif (super.fetch === undefined) {\n\t\t\t\tthrow new Error(\"Entrypoint class does not define a fetch() function.\");\n\t\t\t}\n\t\t\treturn super.fetch(request);\n\t\t};\n\n\t\t#dispatcher: Dispatcher = (type, init) => {\n\t\t\tif (type === \"scheduled\" && super.scheduled !== undefined) {\n\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\tDate.now(),\n\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t() => {}\n\t\t\t\t);\n\t\t\t\treturn super.scheduled(controller);\n\t\t\t}\n\t\t};\n\n\t\tfetch(request: Request<unknown, IncomingRequestCfProperties>) {\n\t\t\treturn __facade_invoke__(\n\t\t\t\trequest,\n\t\t\t\tthis.env,\n\t\t\t\tthis.ctx,\n\t\t\t\tthis.#dispatcher,\n\t\t\t\tthis.#fetchDispatcher\n\t\t\t);\n\t\t}\n\t};\n}\n\nlet WRAPPED_ENTRY: ExportedHandler | WorkerEntrypointConstructor | undefined;\nif (typeof ENTRY === \"object\") {\n\tWRAPPED_ENTRY = wrapExportedHandler(ENTRY);\n} else if (typeof ENTRY === \"function\") {\n\tWRAPPED_ENTRY = wrapWorkerEntrypoint(ENTRY);\n}\nexport default WRAPPED_ENTRY;\n", "\t\t\t\timport worker, * as OTHER_EXPORTS from \"/Users/maurofrehner/Desktop/GitHub/GEO_dashboard/src/index.ts\";\n\t\t\t\timport * as __MIDDLEWARE_0__ from \"/Users/maurofrehner/Desktop/GitHub/GEO_dashboard/node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts\";\nimport * as __MIDDLEWARE_1__ from \"/Users/maurofrehner/Desktop/GitHub/GEO_dashboard/node_modules/wrangler/templates/middleware/middleware-miniflare3-json-error.ts\";\n\n\t\t\t\texport * from \"/Users/maurofrehner/Desktop/GitHub/GEO_dashboard/src/index.ts\";\n\n\t\t\t\texport const __INTERNAL_WRANGLER_MIDDLEWARE__ = [\n\t\t\t\t\t\n\t\t\t\t\t__MIDDLEWARE_0__.default,__MIDDLEWARE_1__.default\n\t\t\t\t]\n\t\t\t\texport default worker;", "/**\n * Cloudflare Workers entry point\n */\n\nimport { APIRoutes } from \"./api/routes.js\";\nimport { GEOEngine } from \"./engine.js\";\nimport type { Env } from \"./api/routes.js\";\n\nexport default {\n  async fetch(request: Request, env: Env, ctx: ExecutionContext): Promise<Response> {\n    const engine = new GEOEngine(env);\n    const routes = new APIRoutes(engine);\n    \n    // For async analysis, use waitUntil to allow background processing\n    const response = await routes.handleRequest(request, env);\n    \n    return response;\n  },\n};\n\n", "/**\n * API routes for the GEO platform\n */\n\nimport type { UserInput, AnalysisResult, Prompt, LLMResponse } from \"../types.js\";\nimport { GEOEngine } from \"../engine.js\";\nimport { WorkflowEngine } from \"../engine_workflow.js\";\nimport { Database } from \"../persistence/db.js\";\n\nexport interface Env {\n  geo_db: D1Database;\n  OPENAI_API_KEY: string;\n  [key: string]: any;\n}\n\nexport class APIRoutes {\n  private workflowEngine: WorkflowEngine;\n\n  constructor(private engine: GEOEngine) {\n    // WorkflowEngine will be initialized per request with env\n  }\n\n  async handleRequest(request: Request, env: Env): Promise<Response> {\n    const url = new URL(request.url);\n    const path = url.pathname;\n\n    // CORS headers\n    const corsHeaders = {\n      \"Access-Control-Allow-Origin\": \"*\",\n      \"Access-Control-Allow-Methods\": \"GET, POST, OPTIONS\",\n      \"Access-Control-Allow-Headers\": \"Content-Type\",\n    };\n\n    if (request.method === \"OPTIONS\") {\n      return new Response(null, { headers: corsHeaders });\n    }\n\n    try {\n      // Initialize workflow engine\n      if (!this.workflowEngine) {\n        this.workflowEngine = new WorkflowEngine(env);\n      }\n\n      // POST /api/workflow/step1 - Find sitemap\n      if (path === \"/api/workflow/step1\" && request.method === \"POST\") {\n        return await this.handleStep1(request, env, corsHeaders);\n      }\n\n      // POST /api/workflow/step2 - Fetch content\n      if (path === \"/api/workflow/step2\" && request.method === \"POST\") {\n        return await this.handleStep2(request, env, corsHeaders);\n      }\n\n      // POST /api/workflow/step3 - Generate categories\n      if (path === \"/api/workflow/step3\" && request.method === \"POST\") {\n        return await this.handleStep3(request, env, corsHeaders);\n      }\n\n      // PUT /api/workflow/:runId/categories - Save selected categories\n      if (\n        path.includes(\"/categories\") &&\n        path.startsWith(\"/api/workflow/\") &&\n        request.method === \"PUT\"\n      ) {\n        const runId = path.split(\"/\")[3];\n        if (runId) {\n          return await this.handleSaveCategories(runId, request, env, corsHeaders);\n        }\n      }\n\n      // POST /api/workflow/step4 - Generate prompts\n      if (path === \"/api/workflow/step4\" && request.method === \"POST\") {\n        return await this.handleStep4(request, env, corsHeaders);\n      }\n\n      // PUT /api/workflow/:runId/prompts - Save edited prompts\n      if (\n        path.includes(\"/prompts\") &&\n        path.startsWith(\"/api/workflow/\") &&\n        request.method === \"PUT\"\n      ) {\n        const runId = path.split(\"/\")[3];\n        if (runId) {\n          return await this.handleSavePrompts(runId, request, env, corsHeaders);\n        }\n      }\n\n      // POST /api/workflow/fetchUrl - Fetch single URL (for live updates)\n      if (path === \"/api/workflow/fetchUrl\" && request.method === \"POST\") {\n        return await this.handleFetchUrl(request, env, corsHeaders);\n      }\n\n      // POST /api/workflow/executePrompt - Execute single prompt (for live updates)\n      if (path === \"/api/workflow/executePrompt\" && request.method === \"POST\") {\n        return await this.handleExecutePrompt(request, env, corsHeaders);\n      }\n\n      // POST /api/chat - Chat with GPT-5 Web Search\n      if (path === \"/api/chat\" && request.method === \"POST\") {\n        return await this.handleChat(request, env, corsHeaders);\n      }\n\n      // POST /api/test/analyze - Test analysis with manual input\n      if (path === \"/api/test/analyze\" && request.method === \"POST\") {\n        return await this.handleTestAnalyze(request, env, corsHeaders);\n      }\n\n      // POST /api/workflow/generateSummary - Generate summary/fazit\n      if (path === \"/api/workflow/generateSummary\" && request.method === \"POST\") {\n        return await this.handleGenerateSummary(request, env, corsHeaders);\n      }\n\n      // POST /api/workflow/step5 - Execute prompts\n      if (path === \"/api/workflow/step5\" && request.method === \"POST\") {\n        return await this.handleStep5(request, env, corsHeaders);\n      }\n\n      // POST /api/scheduler/execute - Execute scheduled run with saved prompts\n      if (path === \"/api/scheduler/execute\" && request.method === \"POST\") {\n        return await this.handleExecuteScheduledRun(request, env, corsHeaders);\n      }\n\n      // POST /api/analyze - Start new analysis (legacy)\n      if (path === \"/api/analyze\" && request.method === \"POST\") {\n        return await this.handleAnalyze(request, env, corsHeaders);\n      }\n\n      // GET /api/analyses - Get all analysis runs\n      if (path === \"/api/analyses\" && request.method === \"GET\") {\n        return await this.handleGetAllAnalyses(request, env, corsHeaders);\n      }\n\n      // DELETE /api/analysis/:runId - Delete analysis\n      if (path.startsWith(\"/api/analysis/\") && request.method === \"DELETE\") {\n        const runId = path.split(\"/\").pop();\n        if (runId && runId !== \"analyses\") {\n          return await this.handleDeleteAnalysis(runId, env, corsHeaders);\n        }\n      }\n\n      // PUT /api/analysis/:runId/pause - Pause analysis\n      if (path.startsWith(\"/api/analysis/\") && path.endsWith(\"/pause\") && request.method === \"PUT\") {\n        const runId = path.split(\"/\")[3];\n        if (runId) {\n          return await this.handlePauseAnalysis(runId, env, corsHeaders);\n        }\n      }\n\n      // GET /api/analysis/:runId - Get analysis results\n      if (path.startsWith(\"/api/analysis/\") && request.method === \"GET\") {\n        const runId = path.split(\"/\").pop();\n        if (runId && runId !== \"analyses\") {\n          // Check if it's the insights endpoint\n          if (path.includes(\"/insights\")) {\n            const pathParts = path.split(\"/\");\n            const actualRunId = pathParts[pathParts.length - 2]; // runId is before \"insights\"\n            if (actualRunId && actualRunId !== \"analyses\") {\n            return await this.handleGetAnalysisInsights(actualRunId, env, corsHeaders);\n            }\n          }\n          return await this.handleGetAnalysis(runId, env, corsHeaders);\n        }\n      }\n\n      // GET /api/analysis/:runId/status - Get analysis status\n      if (\n        path.includes(\"/status\") &&\n        path.startsWith(\"/api/analysis/\") &&\n        !path.includes(\"/metrics\") &&\n        request.method === \"GET\"\n      ) {\n        const runId = path.split(\"/\")[3];\n        if (runId) {\n          return await this.handleGetStatus(runId, env, corsHeaders);\n        }\n      }\n\n      // GET /api/analysis/:runId/metrics - Get category metrics\n      if (\n        path.includes(\"/metrics\") &&\n        path.startsWith(\"/api/analysis/\") &&\n        request.method === \"GET\"\n      ) {\n        const runId = path.split(\"/\")[3];\n        if (runId) {\n          return await this.handleGetMetrics(runId, env, corsHeaders);\n        }\n      }\n\n      // GET /api/health - Health check\n      if (path === \"/api/health\" && request.method === \"GET\") {\n        return new Response(\n          JSON.stringify({ status: \"ok\", timestamp: new Date().toISOString() }),\n          {\n            headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n          }\n        );\n      }\n\n      // POST /api/ai-readiness/analyze - Start AI Readiness analysis\n      if (path === \"/api/ai-readiness/analyze\" && request.method === \"POST\") {\n        return await this.handleAIReadinessAnalyze(request, env, corsHeaders);\n      }\n\n      // GET /api/ai-readiness/status/:runId - Get AI Readiness status\n      if (path.startsWith(\"/api/ai-readiness/status/\") && request.method === \"GET\") {\n        const runId = path.split(\"/\").pop();\n        if (runId) {\n          return await this.handleAIReadinessStatus(runId, env, corsHeaders);\n        }\n      }\n\n      // POST /api/ai-readiness/analyze - Start AI Readiness analysis\n      if (path === \"/api/ai-readiness/analyze\" && request.method === \"POST\") {\n        return await this.handleAIReadinessAnalyze(request, env, corsHeaders);\n      }\n\n      // GET /api/ai-readiness/status/:runId - Get AI Readiness status\n      if (path.startsWith(\"/api/ai-readiness/status/\") && request.method === \"GET\") {\n        const runId = path.split(\"/\").pop();\n        if (runId) {\n          return await this.handleAIReadinessStatus(runId, env, corsHeaders);\n        }\n      }\n\n      // POST /api/setup/database - Setup database (run migrations)\n      if (path === \"/api/setup/database\" && request.method === \"POST\") {\n        return await this.handleSetupDatabase(request, env, corsHeaders);\n      }\n\n      // Company Management Endpoints\n      // GET /api/companies - Get all companies\n      if (path === \"/api/companies\" && request.method === \"GET\") {\n        const db = new Database(env.geo_db);\n        const companies = await db.getAllCompanies();\n        return new Response(JSON.stringify(companies), {\n          headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n        });\n      }\n\n      // POST /api/companies - Create new company\n      if (path === \"/api/companies\" && request.method === \"POST\") {\n        const body = await request.json();\n        const db = new Database(env.geo_db);\n        const companyId = await db.createCompany({\n          name: body.name,\n          websiteUrl: body.websiteUrl,\n          country: body.country,\n          language: body.language,\n          region: body.region,\n          description: body.description,\n          isActive: true,\n        });\n        const company = await db.getCompany(companyId);\n        return new Response(JSON.stringify(company), {\n          headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n        });\n      }\n\n      // GET /api/companies/:id - Get company\n      if (path.startsWith(\"/api/companies/\") && request.method === \"GET\") {\n        const companyId = path.split(\"/\")[3];\n        const db = new Database(env.geo_db);\n        const company = await db.getCompany(companyId);\n        if (!company) {\n          return new Response(JSON.stringify({ error: \"Company not found\" }), {\n            status: 404,\n            headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n          });\n        }\n        return new Response(JSON.stringify(company), {\n          headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n        });\n      }\n\n      // GET /api/companies/:id/prompts - Get company prompts\n      if (path.includes(\"/prompts\") && path.startsWith(\"/api/companies/\") && request.method === \"GET\") {\n        const companyId = path.split(\"/\")[3];\n        const db = new Database(env.geo_db);\n        const prompts = await db.getCompanyPrompts(companyId);\n        return new Response(JSON.stringify(prompts), {\n          headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n        });\n      }\n\n      // GET /api/companies/:id/runs - Get company analysis runs\n      if (path.includes(\"/runs\") && path.startsWith(\"/api/companies/\") && request.method === \"GET\") {\n        const companyId = path.split(\"/\")[3];\n        const url = new URL(request.url);\n        const detailed = url.searchParams.get(\"detailed\") === \"true\";\n        \n        const db = new Database(env.geo_db);\n        \n        if (detailed) {\n          // Return detailed analysis data for all runs (for historical comparison)\n          return await this.handleGetCompanyAnalysisRunsDetailed(companyId, env, corsHeaders);\n        } else {\n          // Return just the run metadata\n          const runs = await db.getCompanyAnalysisRuns(companyId);\n          return new Response(JSON.stringify(runs), {\n            headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n          });\n        }\n      }\n\n      // GET /api/companies/:id/timeseries - Get company time series data\n      if (path.includes(\"/timeseries\") && path.startsWith(\"/api/companies/\") && request.method === \"GET\") {\n        const companyId = path.split(\"/\")[3];\n        const url = new URL(request.url);\n        const days = parseInt(url.searchParams.get(\"days\") || \"30\");\n        const db = new Database(env.geo_db);\n        const timeSeries = await db.getCompanyTimeSeries(companyId, days);\n        return new Response(JSON.stringify(timeSeries), {\n          headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n        });\n      }\n\n      // Scheduled Runs Endpoints\n      // GET /api/schedules - Get all scheduled runs (optionally filtered by company)\n      if (path === \"/api/schedules\" && request.method === \"GET\") {\n        const url = new URL(request.url);\n        const companyId = url.searchParams.get(\"companyId\") || undefined;\n        const db = new Database(env.geo_db);\n        const schedules = await db.getScheduledRuns(companyId, true);\n        return new Response(JSON.stringify(schedules), {\n          headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n        });\n      }\n\n      // POST /api/schedules - Create new scheduled run\n      if (path === \"/api/schedules\" && request.method === \"POST\") {\n        const body = await request.json() as any;\n        const db = new Database(env.geo_db);\n        \n        // Calculate next run time based on schedule type\n        const now = new Date();\n        let nextRunAt = new Date(now);\n        if (body.scheduleType === \"daily\") {\n          nextRunAt.setDate(nextRunAt.getDate() + 1);\n        } else if (body.scheduleType === \"weekly\") {\n          nextRunAt.setDate(nextRunAt.getDate() + 7);\n        } else if (body.scheduleType === \"monthly\") {\n          nextRunAt.setMonth(nextRunAt.getMonth() + 1);\n        }\n        \n        const scheduleId = await db.createScheduledRun({\n          companyId: body.companyId,\n          scheduleType: body.scheduleType,\n          nextRunAt: nextRunAt.toISOString(),\n          isActive: true,\n        });\n        \n        const schedule = await db.getScheduledRuns(undefined, false);\n        const created = schedule.find(s => s.id === scheduleId);\n        return new Response(JSON.stringify(created), {\n          headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n        });\n      }\n\n      // PUT /api/schedules/:id - Update scheduled run\n      if (path.startsWith(\"/api/schedules/\") && request.method === \"PUT\") {\n        const scheduleId = path.split(\"/\")[3];\n        const body = await request.json() as any;\n        const db = new Database(env.geo_db);\n        \n        // Recalculate next run time if schedule type changed\n        if (body.scheduleType) {\n          const now = new Date();\n          let nextRunAt = new Date(now);\n          if (body.scheduleType === \"daily\") {\n            nextRunAt.setDate(nextRunAt.getDate() + 1);\n          } else if (body.scheduleType === \"weekly\") {\n            nextRunAt.setDate(nextRunAt.getDate() + 7);\n          } else if (body.scheduleType === \"monthly\") {\n            nextRunAt.setMonth(nextRunAt.getMonth() + 1);\n          }\n          body.nextRunAt = nextRunAt.toISOString();\n        }\n        \n        await db.updateScheduledRun(scheduleId, body);\n        const schedules = await db.getScheduledRuns(undefined, false);\n        const updated = schedules.find(s => s.id === scheduleId);\n        return new Response(JSON.stringify(updated), {\n          headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n        });\n      }\n\n      // GET / - Root endpoint with HTML landing page\n      if (path === \"/\" && request.method === \"GET\") {\n        const html = `<!DOCTYPE html>\n<html lang=\"de\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>GEO Platform</title>\n  <link rel=\"preconnect\" href=\"https://fonts.googleapis.com\">\n  <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\" crossorigin>\n  <link href=\"https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap\" rel=\"stylesheet\">\n  <link rel=\"icon\" href=\"data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>\uD83C\uDF10</text></svg>\">\n  <style>\n    * { margin: 0; padding: 0; box-sizing: border-box; }\n    :root {\n      --primary: #2563eb;\n      --primary-hover: #1d4ed8;\n      --accent: #0ea5e9;\n      --text: #0f172a;\n      --text-light: #64748b;\n      --border: #e2e8f0;\n      --bg: #ffffff;\n      --bg-secondary: #f8fafc;\n      --bg-hover: #f1f5f9;\n      --success: #059669;\n      --warning: #d97706;\n      --error: #dc2626;\n      --sidebar-width: 240px;\n    }\n    body {\n      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      background: var(--bg-secondary);\n      color: var(--text);\n      line-height: 1.5;\n      -webkit-font-smoothing: antialiased;\n    }\n    .app-container {\n      display: flex;\n      min-height: 100vh;\n    }\n    .sidebar {\n      width: var(--sidebar-width);\n      background: var(--bg);\n      border-right: 1px solid var(--border);\n      position: fixed;\n      height: 100vh;\n      left: 0;\n      top: 0;\n      z-index: 1000;\n      overflow-y: auto;\n    }\n    .sidebar-header {\n      padding: 24px 20px;\n      border-bottom: 1px solid var(--border);\n    }\n    .sidebar-header h1 {\n      font-family: 'Space Grotesk', sans-serif;\n      font-size: 20px;\n      font-weight: 700;\n      color: var(--text);\n      letter-spacing: -0.5px;\n      margin-bottom: 4px;\n    }\n    .sidebar-header p {\n      font-size: 11px;\n      color: var(--text-light);\n      text-transform: uppercase;\n      letter-spacing: 1.2px;\n      font-weight: 500;\n    }\n    .sidebar-nav {\n      padding: 12px 0;\n    }\n    .nav-item {\n      padding: 10px 20px;\n      color: var(--text-light);\n      cursor: pointer;\n      transition: all 0.15s;\n      display: flex;\n      align-items: center;\n      gap: 10px;\n      font-size: 14px;\n      font-weight: 500;\n    }\n    .nav-item:hover {\n      background: var(--bg-hover);\n      color: var(--text);\n    }\n    .nav-item.active {\n      background: var(--bg-hover);\n      color: var(--primary);\n      border-left: 3px solid var(--primary);\n      padding-left: 17px;\n    }\n    .nav-item-icon {\n      width: 18px;\n      font-size: 16px;\n    }\n    .main-content {\n      margin-left: var(--sidebar-width);\n      flex: 1;\n      min-height: 100vh;\n    }\n    .top-header {\n      background: var(--bg);\n      border-bottom: 1px solid var(--border);\n      padding: 18px 32px;\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      position: sticky;\n      top: 0;\n      z-index: 100;\n    }\n    .top-header h2 {\n      font-size: 20px;\n      font-weight: 600;\n      color: var(--text);\n      letter-spacing: -0.3px;\n    }\n    .content-area {\n      padding: 32px;\n      max-width: 1200px;\n    }\n    .card {\n      background: var(--bg);\n      border-radius: 8px;\n      border: 1px solid var(--border);\n      overflow: hidden;\n    }\n    .card-header {\n      padding: 18px 24px;\n      border-bottom: 1px solid var(--border);\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n    }\n    .card-header h3 {\n      font-size: 16px;\n      font-weight: 600;\n      color: var(--text);\n      letter-spacing: -0.2px;\n    }\n    .card-body {\n      padding: 24px;\n    }\n    .form-grid {\n      display: grid;\n      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));\n      gap: 20px;\n      margin-bottom: 24px;\n    }\n    .form-group {\n      display: flex;\n      flex-direction: column;\n    }\n    .form-group label {\n      font-size: 12px;\n      font-weight: 600;\n      color: var(--text);\n      margin-bottom: 6px;\n      letter-spacing: 0.3px;\n    }\n    .form-group input,\n    .form-group select {\n      padding: 10px 14px;\n      border: 1px solid var(--border);\n      border-radius: 6px;\n      font-size: 14px;\n      transition: all 0.15s;\n      background: var(--bg);\n      color: var(--text);\n      font-family: inherit;\n    }\n    .form-group input:focus,\n    .form-group select:focus {\n      outline: none;\n      border-color: var(--primary);\n      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.08);\n    }\n    .btn {\n      padding: 10px 20px;\n      border: none;\n      border-radius: 6px;\n      font-size: 14px;\n      font-weight: 600;\n      cursor: pointer;\n      transition: all 0.15s;\n      display: inline-flex;\n      align-items: center;\n      gap: 8px;\n      text-decoration: none;\n      font-family: inherit;\n    }\n    .btn-primary {\n      background: var(--primary);\n      color: white;\n    }\n    .btn-primary:hover:not(:disabled) {\n      background: var(--primary-hover);\n    }\n    .btn-primary:disabled {\n      opacity: 0.5;\n      cursor: not-allowed;\n    }\n    .btn-block {\n      width: 100%;\n      justify-content: center;\n    }\n    /* Progress */\n    .progress-container {\n      background: var(--gray-100);\n      border-radius: 12px;\n      padding: 24px;\n      margin: 24px 0;\n    }\n    .progress-bar {\n      width: 100%;\n      height: 8px;\n      background: var(--gray-200);\n      border-radius: 4px;\n      overflow: hidden;\n      margin: 16px 0;\n    }\n    .progress-fill {\n      height: 100%;\n      background: linear-gradient(90deg, #2563eb 0%, #0ea5e9 100%);\n      transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);\n      border-radius: 4px;\n      position: relative;\n      overflow: hidden;\n    }\n    .progress-fill::after {\n      content: '';\n      position: absolute;\n      top: 0;\n      left: -100%;\n      width: 100%;\n      height: 100%;\n      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);\n      animation: shimmer 2s infinite;\n    }\n    @keyframes shimmer {\n      0% { left: -100%; }\n      100% { left: 100%; }\n    }\n    .progress-text {\n      text-align: center;\n      font-size: 14px;\n      font-weight: 600;\n      color: var(--gray-700);\n      margin-top: 12px;\n    }\n    /* Status Messages */\n    .status-card {\n      background: white;\n      border-radius: 12px;\n      padding: 20px;\n      border: 1px solid var(--gray-200);\n      margin: 20px 0;\n    }\n    .status-title {\n      font-weight: 600;\n      color: var(--gray-900);\n      margin-bottom: 8px;\n      font-size: 15px;\n    }\n    .status-details {\n      color: var(--gray-600);\n      font-size: 14px;\n    }\n    /* Results */\n    .results-container {\n      margin-top: 32px;\n    }\n    .data-table {\n      width: 100%;\n      border-collapse: collapse;\n      margin-top: 16px;\n    }\n    .data-table th {\n      text-align: left;\n      padding: 12px 16px;\n      background: var(--gray-50);\n      font-size: 12px;\n      font-weight: 600;\n      color: var(--gray-700);\n      text-transform: uppercase;\n      letter-spacing: 0.5px;\n      border-bottom: 2px solid var(--gray-200);\n    }\n    .data-table td {\n      padding: 12px 16px;\n      border-bottom: 1px solid var(--gray-200);\n      font-size: 14px;\n      color: var(--gray-700);\n    }\n    .data-table tr:hover {\n      background: var(--gray-50);\n    }\n    /* Badges */\n    .badge {\n      display: inline-block;\n      padding: 4px 12px;\n      border-radius: 12px;\n      font-size: 12px;\n      font-weight: 600;\n    }\n    .badge-success { background: rgba(16, 185, 129, 0.1); color: var(--success); }\n    .badge-warning { background: rgba(245, 158, 11, 0.1); color: var(--warning); }\n    .badge-danger { background: rgba(239, 68, 68, 0.1); color: var(--danger); }\n    .badge-primary { background: rgba(99, 102, 241, 0.1); color: var(--primary); }\n    /* Loading */\n    .loading {\n      display: none;\n    }\n    .loading.show {\n      display: block;\n    }\n    /* Responsive */\n    @media (max-width: 768px) {\n      .sidebar {\n        transform: translateX(-100%);\n        transition: transform 0.3s;\n      }\n      .main-content {\n        margin-left: 0;\n      }\n      .form-grid {\n        grid-template-columns: 1fr;\n      }\n      .metrics-grid {\n        grid-template-columns: 1fr;\n      }\n    }\n  </style>\n  <script>\n    // GLOBAL FUNCTIONS - available immediately (before DOMContentLoaded)\n    // These must be defined before any HTML tries to call them\n    (function() {\n      window.showDashboard = function(event) {\n        if (event) event.preventDefault();\n        const analysesSection = document.getElementById('analysesSection');\n        const analysisDetailSection = document.getElementById('analysisDetailSection');\n        const aiReadinessSection = document.getElementById('aiReadinessSection');\n        const analysisSection = document.querySelector('.content-area > .card');\n        if (analysesSection) analysesSection.style.display = 'none';\n        if (analysisDetailSection) analysisDetailSection.style.display = 'none';\n        if (aiReadinessSection) aiReadinessSection.style.display = 'none';\n        if (analysisSection) analysisSection.style.display = 'block';\n        // Update navigation\n        const navItems = document.querySelectorAll('.nav-item');\n        navItems.forEach(item => item.classList.remove('active'));\n        if (event && event.target) {\n          event.target.closest('.nav-item')?.classList.add('active');\n        } else {\n          const dashboardNav = document.querySelector('.nav-item');\n          if (dashboardNav) dashboardNav.classList.add('active');\n        }\n        if (window.showDashboardFull) {\n          window.showDashboardFull(event);\n        }\n      };\n      \n      window.showAnalyses = function(event) {\n        if (event) event.preventDefault();\n        const analysesSection = document.getElementById('analysesSection');\n        const analysisDetailSection = document.getElementById('analysisDetailSection');\n        const aiReadinessSection = document.getElementById('aiReadinessSection');\n        const analysisSection = document.querySelector('.content-area > .card');\n        if (analysesSection) analysesSection.style.display = 'block';\n        if (analysisDetailSection) analysisDetailSection.style.display = 'none';\n        if (aiReadinessSection) aiReadinessSection.style.display = 'none';\n        if (analysisSection) analysisSection.style.display = 'none';\n        // Update navigation\n        const navItems = document.querySelectorAll('.nav-item');\n        navItems.forEach(item => item.classList.remove('active'));\n        if (event && event.target) {\n          event.target.closest('.nav-item')?.classList.add('active');\n        }\n        if (window.loadAnalyses) {\n          window.loadAnalyses();\n        } else if (window.showAnalysesFull) {\n          window.showAnalysesFull(event);\n        }\n      };\n      \n      window.showAIReadiness = function(event) {\n        if (event) event.preventDefault();\n        const analysesSection = document.getElementById('analysesSection');\n        const analysisDetailSection = document.getElementById('analysisDetailSection');\n        const aiReadinessSection = document.getElementById('aiReadinessSection');\n        const analysisSection = document.querySelector('.content-area > .card');\n        if (analysesSection) analysesSection.style.display = 'none';\n        if (analysisDetailSection) analysisDetailSection.style.display = 'none';\n        if (aiReadinessSection) aiReadinessSection.style.display = 'block';\n        if (analysisSection) analysisSection.style.display = 'none';\n        // Update navigation\n        const navItems = document.querySelectorAll('.nav-item');\n        navItems.forEach(item => item.classList.remove('active'));\n        if (event && event.target) {\n          event.target.closest('.nav-item')?.classList.add('active');\n        }\n        if (window.showAIReadinessFull) {\n          window.showAIReadinessFull(event);\n        }\n      };\n      \n      window.startAIReadiness = async function() {\n        // Direct implementation - no need to wait for DOMContentLoaded\n        const urlInput = document.getElementById('aiReadinessUrl');\n        const url = urlInput?.value?.trim();\n        \n        if (!url) {\n          alert('Bitte geben Sie eine URL ein.');\n          return;\n        }\n        \n        // Auto-add https:// if missing\n        let websiteUrl = url;\n        const urlPattern = new RegExp('^https?:\\\\/\\\\/', 'i');\n        if (!urlPattern.test(websiteUrl)) {\n          websiteUrl = 'https://' + websiteUrl;\n        }\n        \n        // Validate URL\n        try {\n          new URL(websiteUrl);\n        } catch (e) {\n          alert('Ung\u00FCltige URL. Bitte geben Sie eine g\u00FCltige URL ein.');\n          return;\n        }\n        \n        // Update input field with normalized URL\n        if (urlInput) {\n          urlInput.value = websiteUrl;\n        }\n        \n        const loadingEl = document.getElementById('aiReadinessLoading');\n        const resultsEl = document.getElementById('aiReadinessResults');\n        const statusEl = document.getElementById('aiReadinessStatus');\n        const statusDetailsEl = document.getElementById('aiReadinessStatusDetails');\n        const progressEl = document.getElementById('aiReadinessProgress');\n        const progressTextEl = document.getElementById('aiReadinessProgressText');\n        const resultsContentEl = document.getElementById('aiReadinessResultsContent');\n        const startBtn = document.getElementById('startAIReadinessBtn');\n        \n        if (loadingEl) {\n          loadingEl.style.display = 'block';\n          loadingEl.classList.add('show');\n        }\n        if (resultsEl) resultsEl.style.display = 'none';\n        if (statusEl) statusEl.textContent = 'Vorbereitung...';\n        if (statusDetailsEl) statusDetailsEl.textContent = 'Starte AI Readiness Check...';\n        if (progressEl) progressEl.style.width = '0%';\n        if (progressTextEl) progressTextEl.textContent = '0%';\n        if (startBtn) {\n          startBtn.disabled = true;\n          startBtn.textContent = 'L\u00E4uft...';\n        }\n        \n        try {\n          // Step 1: Start analysis\n          if (statusEl) statusEl.textContent = 'Schritt 1: Starte Analyse...';\n          if (statusDetailsEl) statusDetailsEl.textContent = 'Hole robots.txt und Sitemap...';\n          if (progressEl) progressEl.style.width = '10%';\n          if (progressTextEl) progressTextEl.textContent = '10%';\n          \n          const step1Response = await fetch('/api/ai-readiness/analyze', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({ websiteUrl })\n          });\n          \n          if (!step1Response.ok) {\n            throw new Error('Fehler beim Starten der Analyse');\n          }\n          \n          const step1Data = await step1Response.json();\n          const runId = step1Data.runId;\n          \n          // Step 2: Poll for status updates with live progress\n          let attempts = 0;\n          const maxAttempts = 120; // 10 minutes max (2 second intervals)\n          let lastMessage = '';\n          let pollingStopped = false;\n          \n          // Centralized error handler\n          const handlePollingError = function(error) {\n            pollingStopped = true;\n            console.error('Error in AI Readiness polling:', error);\n            if (statusEl) statusEl.textContent = '\u274C Fehler';\n            if (statusDetailsEl) statusDetailsEl.textContent = error instanceof Error ? error.message : 'Unbekannter Fehler';\n            if (startBtn) {\n              startBtn.disabled = false;\n              startBtn.textContent = 'AI Readiness Check starten';\n            }\n            if (loadingEl) {\n              setTimeout(() => {\n                if (loadingEl) {\n                  loadingEl.style.display = 'none';\n                  loadingEl.classList.remove('show');\n                }\n              }, 2000);\n            }\n            alert('Fehler beim AI Readiness Check: ' + (error instanceof Error ? error.message : 'Unbekannter Fehler'));\n          };\n          \n          const pollStatus = async function() {\n            if (pollingStopped) {\n              return;\n            }\n            \n            attempts++;\n            \n            try {\n              const statusResponse = await fetch('/api/ai-readiness/status/' + runId);\n              if (statusResponse.ok) {\n                const statusData = await statusResponse.json();\n                \n                // Update UI with live status\n                if (statusData.message && statusData.message !== lastMessage) {\n                  lastMessage = statusData.message;\n                  if (statusDetailsEl) {\n                    statusDetailsEl.textContent = statusData.message;\n                  }\n                  \n                  // Update progress based on message content\n                  if (statusData.message.includes('robots.txt')) {\n                    if (progressEl) progressEl.style.width = '20%';\n                    if (progressTextEl) progressTextEl.textContent = '20%';\n                    if (statusEl) statusEl.textContent = 'Schritt 1: robots.txt und Sitemap';\n                  } else if (statusData.message.includes('Sitemap gefunden')) {\n                    if (progressEl) progressEl.style.width = '30%';\n                    if (progressTextEl) progressTextEl.textContent = '30%';\n                    if (statusEl) statusEl.textContent = 'Schritt 2: Sitemap gefunden';\n                  } else if (statusData.message.includes('Hole Seiten-Inhalte')) {\n                    const progressMatch = new RegExp('(\\\\\\\\d+)/(\\\\\\\\d+)');\n                    const match = statusData.message.match(progressMatch);\n                    if (match) {\n                      const current = parseInt(match[1]);\n                      const total = parseInt(match[2]);\n                      const percent = 30 + Math.floor((current / total) * 50); // 30% to 80%\n                      if (progressEl) progressEl.style.width = percent + '%';\n                      if (progressTextEl) progressTextEl.textContent = percent + '%';\n                      if (statusEl) statusEl.textContent = 'Schritt 3: Seiten-Inhalte holen';\n                    }\n                  } else if (statusData.message.includes('Generiere AI Readiness')) {\n                    if (progressEl) progressEl.style.width = '85%';\n                    if (progressTextEl) progressTextEl.textContent = '85%';\n                    if (statusEl) statusEl.textContent = 'Schritt 4: GPT-Analyse';\n                  }\n                }\n                \n                if (statusData.status === 'completed') {\n                  // Analysis complete\n                  pollingStopped = true;\n                  if (statusEl) statusEl.textContent = '\u2705 Analyse abgeschlossen';\n                  if (statusDetailsEl) statusDetailsEl.textContent = 'AI Readiness Check erfolgreich durchgef\u00FChrt';\n                  if (progressEl) progressEl.style.width = '100%';\n                  if (progressTextEl) progressTextEl.textContent = '100%';\n                  \n                  if (resultsContentEl && statusData.recommendations) {\n                    resultsContentEl.innerHTML = \n                      '<div style=\"white-space: pre-wrap; font-size: 14px; line-height: 1.7; color: #374151;\">' +\n                      statusData.recommendations.replace(/</g, '&lt;').replace(/>/g, '&gt;') +\n                      '</div>';\n                  }\n                  \n                  if (resultsEl) resultsEl.style.display = 'block';\n                  if (startBtn) {\n                    startBtn.disabled = false;\n                    startBtn.textContent = 'AI Readiness Check starten';\n                  }\n                  \n                  // Hide loading after a delay\n                  setTimeout(() => {\n                    if (loadingEl) {\n                      loadingEl.style.display = 'none';\n                      loadingEl.classList.remove('show');\n                    }\n                  }, 2000);\n                  \n                  return; // Stop polling\n                } else if (statusData.status === 'error') {\n                  // Critical error - stop polling and handle\n                  handlePollingError(new Error(statusData.error || 'Fehler bei der Analyse'));\n                  return;\n                }\n              }\n              \n              // Check timeout before continuing\n              if (attempts >= maxAttempts) {\n                handlePollingError(new Error('Timeout: Die Analyse hat zu lange gedauert.'));\n                return;\n              }\n              \n              // Continue polling every 2 seconds for faster updates\n              // All errors in scheduled calls are handled by the catch block\n              setTimeout(() => {\n                pollStatus().catch(handlePollingError);\n              }, 2000);\n              \n            } catch (error) {\n              // Check if this is a critical error that should stop polling\n              const isCriticalError = error instanceof Error && (\n                error.message.includes('Timeout') || \n                error.message.includes('Fehler bei der Analyse')\n              );\n              \n              if (isCriticalError) {\n                handlePollingError(error);\n                return;\n              }\n              \n              // Non-critical error - log and continue\n              console.error('Non-critical error polling status:', error);\n              \n              // Check timeout even on error\n              if (attempts >= maxAttempts) {\n                handlePollingError(new Error('Timeout: Die Analyse hat zu lange gedauert.'));\n                return;\n              }\n              \n              // Continue polling on non-critical errors\n              setTimeout(() => {\n                pollStatus().catch(handlePollingError);\n              }, 2000);\n            }\n          };\n          \n          // Start polling and handle errors\n          pollStatus().catch(handlePollingError);\n          \n        } catch (error) {\n          console.error('Error in AI Readiness check:', error);\n          if (statusEl) statusEl.textContent = '\u274C Fehler';\n          if (statusDetailsEl) statusDetailsEl.textContent = error instanceof Error ? error.message : 'Unbekannter Fehler';\n          alert('Fehler beim AI Readiness Check: ' + (error instanceof Error ? error.message : 'Unbekannter Fehler'));\n          if (startBtn) {\n            startBtn.disabled = false;\n            startBtn.textContent = 'AI Readiness Check starten';\n          }\n          if (loadingEl) {\n            setTimeout(() => {\n              loadingEl.style.display = 'none';\n              loadingEl.classList.remove('show');\n            }, 2000);\n          }\n        }\n      };\n    })();\n  </script>\n</head>\n<body>\n  <div class=\"app-container\">\n    <!-- Sidebar -->\n    <aside class=\"sidebar\">\n      <div class=\"sidebar-header\">\n        <h1>GEO</h1>\n        <p>Engine Optimization</p>\n      </div>\n      <nav class=\"sidebar-nav\">\n        <div class=\"nav-item active\" onclick=\"showDashboard(event)\">\n          <span>Dashboard</span>\n        </div>\n        <div class=\"nav-item\" onclick=\"showAnalyses(event)\">\n          <span>Analysen</span>\n        </div>\n        <div class=\"nav-item\" onclick=\"showAIReadiness(event)\">\n          <span>AI Readiness</span>\n        </div>\n      </nav>\n    </aside>\n\n    <!-- Main Content -->\n    <main class=\"main-content\">\n      <header class=\"top-header\">\n        <h2>Neue Analyse starten</h2>\n        <div style=\"display: flex; gap: 12px; align-items: center;\">\n          <span style=\"font-size: 14px; color: var(--gray-500);\">Status: Bereit</span>\n        </div>\n      </header>\n\n      <div class=\"content-area\">\n        <!-- Analysis Form -->\n        <div class=\"card\">\n          <div class=\"card-header\">\n            <h3>Analyse-Konfiguration</h3>\n          </div>\n          <div class=\"card-body\">\n            <form id=\"analyzeForm\">\n              <div class=\"form-grid\">\n                <div class=\"form-group\">\n                  <label for=\"websiteUrl\">Website URL *</label>\n                  <input type=\"url\" id=\"websiteUrl\" name=\"websiteUrl\" \n                         placeholder=\"https://example.com\" required>\n                </div>\n                <div class=\"form-group\">\n                  <label for=\"country\">Land (ISO Code) *</label>\n                  <input type=\"text\" id=\"country\" name=\"country\" \n                         placeholder=\"CH, DE, US\" maxlength=\"2\" required>\n                </div>\n                <div class=\"form-group\">\n                  <label for=\"language\">Sprache (ISO Code) *</label>\n                  <select id=\"language\" name=\"language\" required>\n                    <option value=\"de\">Deutsch (de)</option>\n                    <option value=\"en\">English (en)</option>\n                    <option value=\"fr\">Fran\u00E7ais (fr)</option>\n                  </select>\n                </div>\n                <div class=\"form-group\">\n                  <label for=\"region\">Region (optional)</label>\n                  <input type=\"text\" id=\"region\" name=\"region\" \n                         placeholder=\"z.B. Zurich, Berlin\">\n                </div>\n                <div class=\"form-group\">\n                  <label for=\"questionsPerCategory\">Fragen pro Kategorie</label>\n                  <input type=\"number\" id=\"questionsPerCategory\" name=\"questionsPerCategory\" \n                         value=\"3\" min=\"1\" max=\"10\" style=\"width: 100px;\">\n                  <small style=\"display: block; margin-top: 4px; color: var(--gray-500); font-size: 12px;\">Anzahl der Fragen, die pro Kategorie generiert werden (Standard: 3)</small>\n                </div>\n              </div>\n              <button type=\"button\" id=\"startAnalysisBtn\" class=\"btn btn-primary btn-block\" \n                      onclick=\"if(window.startAnalysisNow){window.startAnalysisNow();}else{alert('startAnalysisNow nicht gefunden!');} return false;\">\n                Analyse starten\n              </button>\n            </form>\n\n            <!-- Loading/Progress -->\n            <div class=\"loading\" id=\"loading\" style=\"display: none;\">\n              <div class=\"progress-container\">\n                <div class=\"progress-bar\">\n                  <div class=\"progress-fill\" id=\"progressFill\" style=\"width: 0%\"></div>\n                </div>\n                <div class=\"progress-text\" id=\"progressText\">Initializing...</div>\n              </div>\n              <div class=\"status-card\">\n                <div class=\"status-title\" id=\"currentStatus\">Bereit zum Starten...</div>\n                <div class=\"status-details\" id=\"statusDetails\"></div>\n              </div>\n            </div>\n\n            <!-- Results -->\n            <div id=\"result\" style=\"display: none; margin-top: 24px;\">\n              <div class=\"card\">\n                <div class=\"card-header\">\n                  <h3>Analyse-Ergebnisse</h3>\n                </div>\n                <div class=\"card-body\">\n                  <div id=\"resultContent\"></div>\n                </div>\n              </div>\n            </div>\n\n            <div id=\"resultsContainer\" style=\"display: none; margin-top: 24px;\">\n              <div class=\"card\">\n                <div class=\"card-header\">\n                  <h3>Detaillierte Analyse-Ergebnisse</h3>\n                </div>\n                <div class=\"card-body\">\n                  <div id=\"resultsContent\"></div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <!-- Analyses Section (hidden by default) -->\n        <div id=\"analysesSection\" style=\"display: none;\">\n          <div class=\"card\">\n            <div class=\"card-header\" style=\"display: flex; justify-content: space-between; align-items: center;\">\n              <h3>Gespeicherte Analysen</h3>\n              <button class=\"btn btn-primary\" onclick=\"if(typeof hideAllSections === 'function'){hideAllSections();} (function(){var card = document.querySelector('.content-area > .card'); if(card){card.style.display = 'block';}})();\" style=\"padding: 8px 16px; font-size: 14px;\">\n                + Neue Analyse\n              </button>\n            </div>\n            <div class=\"card-body\">\n              <div id=\"analysesList\" style=\"display: grid; gap: 16px;\">\n                <div style=\"text-align: center; padding: 40px; color: var(--gray-500);\">\n                  Lade Analysen...\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <!-- Analysis Detail Section (hidden by default) -->\n        <div id=\"analysisDetailSection\" style=\"display: none;\">\n          <div class=\"card\">\n            <div class=\"card-header\" style=\"display: flex; justify-content: space-between; align-items: center;\">\n              <h3 id=\"analysisDetailTitle\">Analyse Details</h3>\n              <button class=\"btn\" onclick=\"showAnalyses(event)\" style=\"padding: 8px 16px; font-size: 14px; background: var(--gray-100); color: var(--gray-700);\">\n                \u2190 Zur\u00FCck\n              </button>\n            </div>\n            <div class=\"card-body\">\n              <div id=\"analysisDetailContent\">\n                <div style=\"text-align: center; padding: 40px; color: var(--gray-500);\">\n                  Lade Analyse-Details...\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <!-- AI Readiness Section -->\n        <div id=\"aiReadinessSection\" style=\"display: none;\">\n          <div class=\"card\">\n            <div class=\"card-header\">\n              <h3>AI Readiness Check</h3>\n              <p style=\"margin: 8px 0 0 0; color: var(--gray-600); font-size: 14px;\">\n                Analysiere die Website auf AI-Readiness: robots.txt, Sitemap und alle Seiten werden analysiert.\n              </p>\n            </div>\n            <div class=\"card-body\">\n              <form id=\"aiReadinessForm\">\n                <div class=\"form-group\">\n                  <label for=\"aiReadinessUrl\">Website URL *</label>\n                  <input type=\"text\" id=\"aiReadinessUrl\" name=\"aiReadinessUrl\" \n                         placeholder=\"example.com oder https://example.com\" required>\n                  <small style=\"display: block; margin-top: 4px; color: var(--gray-500); font-size: 12px;\">\n                    Die URL der zu analysierenden Website (https:// wird automatisch hinzugef\u00FCgt)\n                  </small>\n                </div>\n                <button type=\"button\" id=\"startAIReadinessBtn\" class=\"btn btn-primary btn-block\" \n                        onclick=\"if(window.startAIReadiness){window.startAIReadiness();}else{alert('startAIReadiness nicht gefunden!');} return false;\">\n                  AI Readiness Check starten\n                  </button>\n                </form>\n              \n              <!-- Progress -->\n              <div id=\"aiReadinessLoading\" class=\"loading\" style=\"margin-top: 24px;\">\n                <div class=\"status-card\">\n                  <div class=\"status-title\" id=\"aiReadinessStatus\">Vorbereitung...</div>\n                  <div class=\"status-details\" id=\"aiReadinessStatusDetails\">Starte Analyse...</div>\n                  <div class=\"progress-bar\" style=\"margin-top: 16px;\">\n                    <div class=\"progress-fill\" id=\"aiReadinessProgress\" style=\"width: 0%;\"></div>\n                </div>\n                  <div class=\"progress-text\" id=\"aiReadinessProgressText\">0%</div>\n              </div>\n              \n              <!-- Console Log -->\n              <div id=\"aiReadinessConsole\" style=\"display: none; margin-top: 24px;\">\n                <div class=\"card\" style=\"background: #1e1e1e; border: 1px solid #333;\">\n                  <div class=\"card-header\" style=\"background: #2d2d2d; border-bottom: 1px solid #444; padding: 12px 16px;\">\n                    <div style=\"display: flex; justify-content: space-between; align-items: center;\">\n                      <h4 style=\"margin: 0; color: #fff; font-size: 14px; font-weight: 600;\">\uD83D\uDCCB Console Log</h4>\n                      <button type=\"button\" id=\"clearConsoleBtn\" style=\"background: #444; color: #fff; border: none; padding: 4px 12px; border-radius: 4px; cursor: pointer; font-size: 12px;\">L\u00F6schen</button>\n                    </div>\n                  </div>\n                  <div class=\"card-body\" style=\"padding: 16px;\">\n                    <div id=\"aiReadinessConsoleContent\" style=\"background: #1e1e1e; color: #d4d4d4; font-family: 'Courier New', monospace; font-size: 12px; line-height: 1.6; max-height: 400px; overflow-y: auto; padding: 12px; border-radius: 4px; white-space: pre-wrap; word-wrap: break-word;\">\n                      <div style=\"color: #6a9955;\">[System] Console bereit. Warte auf Logs...</div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n              \n              <!-- Results -->\n              <div id=\"aiReadinessResults\" style=\"display: none; margin-top: 32px;\">\n                <div class=\"card\">\n                  <div class=\"card-header\">\n                    <h3>AI Readiness Empfehlungen</h3>\n          </div>\n                  <div class=\"card-body\" id=\"aiReadinessResultsContent\">\n                    <!-- Results werden hier angezeigt -->\n        </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n      </div>\n    </main>\n  </div>\n\n  <script>\n    // GLOBAL FUNCTIONS - available immediately (before DOMContentLoaded)\n    // These must be defined before any HTML tries to call them\n    window.showDashboard = function(event) {\n      if (event) event.preventDefault();\n      const analysesSection = document.getElementById('analysesSection');\n      const analysisDetailSection = document.getElementById('analysisDetailSection');\n      const analysisSection = document.querySelector('.content-area > .card');\n      if (analysesSection) analysesSection.style.display = 'none';\n      if (analysisDetailSection) analysisDetailSection.style.display = 'none';\n      if (analysisSection) analysisSection.style.display = 'block';\n      // Update navigation\n      const navItems = document.querySelectorAll('.nav-item');\n      navItems.forEach(item => item.classList.remove('active'));\n      if (event && event.target) {\n        event.target.closest('.nav-item')?.classList.add('active');\n      } else {\n        // Set first nav item (Dashboard) as active\n        const dashboardNav = document.querySelector('.nav-item');\n        if (dashboardNav) dashboardNav.classList.add('active');\n      }\n      // Try to call full implementation if available\n      if (window.showDashboardFull) {\n        window.showDashboardFull(event);\n      }\n    };\n    \n    window.showAnalyses = function(event) {\n      if (event) event.preventDefault();\n      const analysesSection = document.getElementById('analysesSection');\n      const analysisDetailSection = document.getElementById('analysisDetailSection');\n      const aiReadinessSection = document.getElementById('aiReadinessSection');\n      const analysisSection = document.querySelector('.content-area > .card');\n      if (analysesSection) analysesSection.style.display = 'block';\n      if (analysisDetailSection) analysisDetailSection.style.display = 'none';\n      if (aiReadinessSection) aiReadinessSection.style.display = 'none';\n      if (analysisSection) analysisSection.style.display = 'none';\n      // Update navigation\n      const navItems = document.querySelectorAll('.nav-item');\n      navItems.forEach(item => item.classList.remove('active'));\n      if (event && event.target) {\n        event.target.closest('.nav-item')?.classList.add('active');\n      }\n      // Try to load analyses if function is available\n      if (window.loadAnalyses) {\n        window.loadAnalyses();\n      } else if (window.showAnalysesFull) {\n        window.showAnalysesFull(event);\n      } else {\n        // Wait for DOMContentLoaded with max attempts\n        let attempts = 0;\n        const maxAttempts = 50;\n        const tryLoad = function() {\n          attempts++;\n          if (window.loadAnalyses) {\n            window.loadAnalyses();\n          } else if (window.showAnalysesFull) {\n            window.showAnalysesFull(event);\n          } else if (attempts < maxAttempts) {\n            if (document.readyState === 'loading') {\n              document.addEventListener('DOMContentLoaded', function() {\n                if (window.loadAnalyses) window.loadAnalyses();\n                else if (window.showAnalysesFull) window.showAnalysesFull(event);\n              });\n            } else {\n              setTimeout(tryLoad, 100);\n            }\n          } else {\n            console.error('\u274C loadAnalyses not available after ' + maxAttempts + ' attempts');\n          }\n        };\n        tryLoad();\n      }\n    };\n    \n    window.showAIReadiness = function(event) {\n      if (event) event.preventDefault();\n      const analysesSection = document.getElementById('analysesSection');\n      const analysisDetailSection = document.getElementById('analysisDetailSection');\n      const aiReadinessSection = document.getElementById('aiReadinessSection');\n      const analysisSection = document.querySelector('.content-area > .card');\n      if (analysesSection) analysesSection.style.display = 'none';\n      if (analysisDetailSection) analysisDetailSection.style.display = 'none';\n      if (aiReadinessSection) aiReadinessSection.style.display = 'block';\n      if (analysisSection) analysisSection.style.display = 'none';\n      // Update navigation\n      const navItems = document.querySelectorAll('.nav-item');\n      navItems.forEach(item => item.classList.remove('active'));\n      if (event && event.target) {\n        event.target.closest('.nav-item')?.classList.add('active');\n      }\n      // Try to call full implementation if available\n      if (window.showAIReadinessFull) {\n        window.showAIReadinessFull(event);\n      }\n    };\n    \n    // startAIReadiness is already defined in <head> script tag above\n    \n    window.viewAnalysisDetails = function(runId) {\n      console.log('\uD83D\uDD0D viewAnalysisDetails called with runId:', runId);\n      if (!runId) {\n        console.error('\u274C No runId provided');\n        alert('Fehler: Keine Analyse-ID angegeben.');\n        return;\n      }\n      // Try to call the full implementation, with retry logic and max attempts\n      let attempts = 0;\n      const maxAttempts = 50; // 5 seconds max (50 * 100ms)\n      const startTime = Date.now();\n      const maxTime = 5000; // 5 seconds in milliseconds\n      let timeoutId = null;\n      \n      const tryCall = () => {\n        attempts++;\n        const elapsed = Date.now() - startTime;\n        \n        // Check if function is available\n        if (window.viewAnalysisDetailsFull) {\n          console.log('\u2705 Calling viewAnalysisDetailsFull');\n          if (timeoutId) clearTimeout(timeoutId);\n          window.viewAnalysisDetailsFull(runId);\n          return; // Success, exit\n        }\n        \n        // Check if we've exceeded max attempts or max time\n        if (attempts >= maxAttempts || elapsed >= maxTime) {\n          console.error('\u274C viewAnalysisDetailsFull not available after ' + attempts + ' attempts or ' + elapsed + 'ms');\n          if (timeoutId) clearTimeout(timeoutId);\n          alert('Fehler: Funktion noch nicht geladen. Bitte Seite neu laden.');\n          return; // Exit retry loop\n        }\n        \n        // Continue retrying\n        console.warn('\u26A0\uFE0F viewAnalysisDetailsFull not yet available, retrying... (' + attempts + '/' + maxAttempts + ')');\n        timeoutId = setTimeout(tryCall, 100);\n      };\n      \n      tryCall();\n    };\n    \n    window.deleteAnalysis = function(runId) {\n      if (!runId) {\n        console.error('\u274C No runId provided');\n        return;\n      }\n      let attempts = 0;\n      const maxAttempts = 50;\n      const startTime = Date.now();\n      const maxTime = 5000; // 5 seconds\n      let timeoutId = null;\n      \n      const tryCall = () => {\n        attempts++;\n        const elapsed = Date.now() - startTime;\n        \n        if (window.deleteAnalysisFull) {\n          if (timeoutId) clearTimeout(timeoutId);\n          window.deleteAnalysisFull(runId);\n          return;\n        }\n        \n        if (attempts >= maxAttempts || elapsed >= maxTime) {\n          console.error('\u274C deleteAnalysisFull not available after ' + attempts + ' attempts or ' + elapsed + 'ms');\n          if (timeoutId) clearTimeout(timeoutId);\n          alert('Fehler: Funktion noch nicht geladen. Bitte Seite neu laden.');\n          return;\n        }\n        \n        timeoutId = setTimeout(tryCall, 100);\n      };\n      \n      tryCall();\n    };\n    \n    window.pauseAnalysis = function(runId) {\n      if (!runId) {\n        console.error('\u274C No runId provided');\n        return;\n      }\n      let attempts = 0;\n      const maxAttempts = 50;\n      const startTime = Date.now();\n      const maxTime = 5000; // 5 seconds\n      let timeoutId = null;\n      \n      const tryCall = () => {\n        attempts++;\n        const elapsed = Date.now() - startTime;\n        \n        if (window.pauseAnalysisFull) {\n          if (timeoutId) clearTimeout(timeoutId);\n          window.pauseAnalysisFull(runId);\n          return;\n        }\n        \n        if (attempts >= maxAttempts || elapsed >= maxTime) {\n          console.error('\u274C pauseAnalysisFull not available after ' + attempts + ' attempts or ' + elapsed + 'ms');\n          if (timeoutId) clearTimeout(timeoutId);\n          alert('Fehler: Funktion noch nicht geladen. Bitte Seite neu laden.');\n          return;\n        }\n        \n        timeoutId = setTimeout(tryCall, 100);\n      };\n      \n      tryCall();\n    };\n    \n    // GLOBAL FUNCTION - available immediately\n    window.startAnalysisNow = async function() {\n      try {\n        const btn = document.getElementById('startAnalysisBtn');\n        if (btn) {\n          btn.disabled = true;\n          btn.textContent = 'Starte Analyse...';\n        }\n        \n        const websiteUrlEl = document.getElementById('websiteUrl');\n        const countryEl = document.getElementById('country');\n        const languageEl = document.getElementById('language');\n        const regionEl = document.getElementById('region');\n        \n        let websiteUrl = websiteUrlEl?.value?.trim();\n        // Auto-add https:// if missing\n        var urlPattern1 = new RegExp(\"^https?:\\\\/\\\\/\", \"i\");\n        if (websiteUrl && !urlPattern1.test(websiteUrl)) {\n          websiteUrl = \"https://\" + websiteUrl;\n        }\n        const country = countryEl?.value?.toUpperCase()?.trim();\n        const language = languageEl?.value?.trim();\n        const region = regionEl?.value?.trim();\n        const questionsPerCategoryEl = document.getElementById('questionsPerCategory');\n        const questionsPerCategory = questionsPerCategoryEl ? parseInt(questionsPerCategoryEl.value) || 3 : 3;\n        \n        if (!websiteUrl || !country || !language) {\n          alert('Bitte f\u00FCllen Sie alle Pflichtfelder aus!\\\\n\\\\nURL: ' + (websiteUrl || 'FEHLT') + '\\\\nLand: ' + (country || 'FEHLT') + '\\\\nSprache: ' + (language || 'FEHLT'));\n          if (btn) {\n            btn.disabled = false;\n            btn.textContent = 'Analyse starten';\n          }\n          return;\n        }\n        \n        // Show loading\n        const loading = document.getElementById('loading');\n        if (loading) {\n          loading.style.display = 'block';\n          loading.classList.add('show');\n        }\n        \n        const progressFill = document.getElementById('progressFill');\n        const progressText = document.getElementById('progressText');\n        if (progressFill) progressFill.style.width = '5%';\n        if (progressText) progressText.textContent = 'Starte Analyse...';\n        \n        // Call the API\n        const response = await fetch('/api/workflow/step1', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            websiteUrl,\n            country,\n            language,\n            region: region || undefined\n          })\n        });\n        \n        if (!response.ok) {\n          const errorText = await response.text();\n          console.error('API error:', errorText);\n          alert('API Fehler: ' + response.status + ' - ' + errorText.substring(0, 100));\n          if (btn) {\n            btn.disabled = false;\n            btn.textContent = 'Analyse starten';\n          }\n          if (loading) {\n            loading.style.display = 'none';\n          }\n          return;\n        }\n        \n        const data = await response.json();\n        \n        if (data.error) {\n          alert('Fehler: ' + (data.message || data.error));\n          if (btn) {\n            btn.disabled = false;\n            btn.textContent = 'Analyse starten';\n          }\n          if (loading) {\n            loading.style.display = 'none';\n          }\n          return;\n        }\n        \n        // Continue with workflow - trigger executeStep1 from DOMContentLoaded scope\n        // The executeStep1 function will handle the rest of the workflow\n        if (data.runId && window.executeStep1) {\n          window.currentRunId = data.runId;\n          window.workflowData = { websiteUrl, country, language, region, questionsPerCategory };\n          window.workflowData.urls = data.urls || [];\n          // Call executeStep1 with the formData\n          await window.executeStep1({ websiteUrl, country, language, region, questionsPerCategory });\n        } else if (data.runId) {\n          // If DOMContentLoaded hasn't run yet, wait for it\n          document.addEventListener('DOMContentLoaded', async () => {\n            if (window.executeStep1) {\n              window.currentRunId = data.runId;\n              window.workflowData = { websiteUrl, country, language, region };\n              window.workflowData.urls = data.urls || [];\n              await window.executeStep1({ websiteUrl, country, language, region });\n            }\n          });\n        }\n        \n      } catch (error) {\n        console.error('Error:', error);\n        alert('Fehler: ' + (error.message || error));\n        const btn = document.getElementById('startAnalysisBtn');\n        if (btn) {\n          btn.disabled = false;\n          btn.textContent = 'Analyse starten';\n        }\n      }\n    };\n    \n    document.addEventListener('DOMContentLoaded', function() {\n    console.log('\u2705 DOM loaded, initializing form...');\n    let pollInterval = null;\n\n    async function pollStatus(runId) {\n      try {\n        const response = await fetch('/api/analysis/' + runId + '/status');\n        const status = await response.json();\n        \n        const progressFill = document.getElementById('progressFill');\n        const progressText = document.getElementById('progressText');\n        \n        if (status.progress) {\n          const progress = status.progress.progress || 0;\n          progressFill.style.width = progress + '%';\n          progressFill.textContent = progress + '%';\n          progressText.textContent = status.progress.message || status.progress.step || 'Processing...';\n        }\n        \n        if (status.status === 'completed') {\n          clearInterval(pollInterval);\n          document.getElementById('loading').classList.remove('show');\n          await loadResults(runId);\n        } else if (status.status === 'failed') {\n          clearInterval(pollInterval);\n          document.getElementById('loading').classList.remove('show');\n          document.getElementById('result').classList.add('show');\n          document.getElementById('resultContent').innerHTML = \n            '<div style=\"color: red;\"><h4>\u274C Analyse fehlgeschlagen</h4><p>' + \n            (status.error || status.progress?.message || 'Unknown error') + '</p></div>';\n        }\n      } catch (error) {\n        console.error('Status poll error:', error);\n      }\n    }\n\n    async function loadResults(runId) {\n      try {\n        const response = await fetch('/api/analysis/' + runId);\n        const result = await response.json();\n        \n        const resultsContainer = document.getElementById('resultsContainer');\n        const resultsContent = document.getElementById('resultsContent');\n        \n        let html = '<div class=\"metric-card\">';\n        html += '<h4>\uD83C\uDF10 Website</h4>';\n        html += '<p><strong>URL:</strong> ' + result.websiteUrl + '</p>';\n        html += '<p><strong>Land:</strong> ' + result.country + '</p>';\n        html += '<p><strong>Sprache:</strong> ' + result.language + '</p>';\n        html += '</div>';\n        \n        if (result.categoryMetrics && result.categoryMetrics.length > 0) {\n          html += '<div class=\"metric-card\">';\n          html += '<h4>\uD83D\uDCC8 Kategorie-Metriken</h4>';\n          result.categoryMetrics.forEach(metric => {\n            html += '<div style=\"margin: 10px 0; padding: 10px; background: #f0f0f0; border-radius: 4px;\">';\n            html += '<strong>' + metric.categoryId + '</strong><br>';\n            html += 'Sichtbarkeit: <span class=\"metric-value\">' + metric.visibilityScore.toFixed(1) + '</span><br>';\n            html += 'Zitationsrate: ' + metric.citationRate.toFixed(2) + '<br>';\n            html += 'Brand-Erw\u00E4hnungen: ' + (metric.brandMentionRate * 100).toFixed(1) + '%';\n            html += '</div>';\n          });\n          html += '</div>';\n        }\n        \n        if (result.competitiveAnalysis) {\n          const comp = result.competitiveAnalysis;\n          html += '<div class=\"metric-card\">';\n          html += '<h4>\uD83C\uDFC6 Wettbewerbsanalyse</h4>';\n          html += '<p><span class=\"metric-value\">' + comp.brandShare.toFixed(1) + '%</span> Brand-Anteil</p>';\n          if (Object.keys(comp.competitorShares).length > 0) {\n            html += '<p><strong>Konkurrenten:</strong></p><ul>';\n            for (const [name, share] of Object.entries(comp.competitorShares)) {\n              html += '<li>' + name + ': ' + share.toFixed(1) + '%</li>';\n            }\n            html += '</ul>';\n          }\n          html += '</div>';\n        }\n        \n        resultsContent.innerHTML = html;\n        resultsContainer.style.display = 'block';\n        document.getElementById('result').classList.add('show');\n        document.getElementById('resultContent').innerHTML = \n          '<div style=\"color: green;\"><h4>\u2705 Analyse abgeschlossen!</h4><p>Run ID: ' + runId + '</p></div>';\n      } catch (error) {\n        document.getElementById('resultContent').innerHTML = \n          '<div style=\"color: red;\">Fehler beim Laden der Ergebnisse: ' + error.message + '</div>';\n      }\n    }\n\n    let currentRunId = null;\n    let currentStep = 'step1';\n    let workflowData = {};\n    \n    // Make variables available globally for startAnalysisNow\n    window.currentRunId = currentRunId;\n    window.workflowData = workflowData;\n\n    // Extract form submission logic to a function (DEFINED FIRST)\n    async function handleFormSubmit() {\n      console.log('\uD83D\uDD35 handleFormSubmit called');\n      try {\n        if (pollInterval) {\n          clearInterval(pollInterval);\n        }\n        \n        const websiteUrlEl = document.getElementById('websiteUrl');\n        const countryEl = document.getElementById('country');\n        const languageEl = document.getElementById('language');\n        const regionEl = document.getElementById('region');\n        \n        console.log('Form elements:', {\n          websiteUrl: !!websiteUrlEl,\n          country: !!countryEl,\n          language: !!languageEl,\n          region: !!regionEl\n        });\n        \n        if (!websiteUrlEl || !countryEl || !languageEl) {\n          throw new Error('Form fields not found');\n        }\n        \n        const questionsPerCategoryEl = document.getElementById('questionsPerCategory');\n        const questionsPerCategory = questionsPerCategoryEl ? parseInt(questionsPerCategoryEl.value) || 3 : 3;\n        \n        let websiteUrl = websiteUrlEl.value.trim();\n        // Auto-add https:// if missing\n        var urlPattern2 = new RegExp(\"^https?:\\\\/\\\\/\", \"i\");\n        if (websiteUrl && !urlPattern2.test(websiteUrl)) {\n          websiteUrl = \"https://\" + websiteUrl;\n        }\n        const formData = {\n          websiteUrl: websiteUrl,\n          country: countryEl.value.toUpperCase().trim(),\n          language: languageEl.value.trim(),\n          region: regionEl ? regionEl.value.trim() || undefined : undefined,\n          questionsPerCategory: questionsPerCategory\n        };\n        \n        console.log('\uD83D\uDCCB Form data extracted:', formData);\n        \n        // Validate form data\n        if (!formData.websiteUrl) {\n          throw new Error('Website URL ist erforderlich');\n        }\n        if (!formData.country) {\n          throw new Error('Land ist erforderlich');\n        }\n        if (!formData.language) {\n          throw new Error('Sprache ist erforderlich');\n        }\n        \n        console.log('\u2705 Form validation passed');\n\n        workflowData = { ...formData };\n\n        const loading = document.getElementById('loading');\n        const result = document.getElementById('result');\n        const resultsContainer = document.getElementById('resultsContainer');\n        const progressFill = document.getElementById('progressFill');\n        const progressText = document.getElementById('progressText');\n\n        if (!loading || !result || !progressFill || !progressText) {\n          throw new Error('UI elements not found');\n        }\n\n        // Show loading immediately with visual feedback\n        loading.style.display = 'block';\n        loading.classList.add('show');\n        result.classList.remove('show');\n        if (resultsContainer) {\n          resultsContainer.style.display = 'none';\n        }\n        \n        // Reset progress and show initial status\n        progressFill.style.width = '0%';\n        progressText.textContent = 'Starte Analyse...';\n        \n        const statusEl = document.getElementById('currentStatus');\n        const statusDetailsEl = document.getElementById('statusDetails');\n        if (statusEl) statusEl.textContent = '\uD83D\uDE80 Analyse wird gestartet...';\n        if (statusDetailsEl) statusDetailsEl.textContent = 'Vorbereitung der Analyse...';\n        \n        console.log('Form submitted, calling executeStep1 with:', formData);\n        await executeStep1(formData);\n      } catch (error) {\n        console.error('Error in form submit:', error);\n        const startBtn = document.getElementById('startAnalysisBtn');\n        if (startBtn) {\n          startBtn.disabled = false;\n          startBtn.textContent = 'Analyse starten';\n        }\n        const result = document.getElementById('result');\n        const loading = document.getElementById('loading');\n        const resultContent = document.getElementById('resultContent');\n        \n        if (resultContent) {\n          resultContent.innerHTML = \n            '<div style=\"color: red; padding: 15px; background: #ffebee; border-radius: 6px; border-left: 4px solid #f44336;\">' +\n            '<strong>\u274C Fehler:</strong><br>' + \n            (error.message || error || 'Unbekannter Fehler') + \n            '</div>';\n        }\n        if (result) result.classList.add('show');\n        if (loading) loading.classList.remove('show');\n        throw error;\n      }\n    }\n\n    // Step 1: Find Sitemap\n    async function executeStep1(formData) {\n      try {\n        console.log('executeStep1 called with:', formData);\n        const progressText = document.getElementById('progressText');\n        const progressFill = document.getElementById('progressFill');\n        const loading = document.getElementById('loading');\n        const result = document.getElementById('result');\n        \n        if (!progressText || !progressFill || !loading) {\n          throw new Error('UI elements not found');\n        }\n        \n        // Show loading immediately\n        loading.style.display = 'block';\n        loading.classList.add('show');\n        result.classList.remove('show');\n        progressFill.style.width = '5%';\n        progressText.textContent = 'Suche Sitemap.xml...';\n        \n        const statusEl1 = document.getElementById('currentStatus');\n        const statusDetailsEl1 = document.getElementById('statusDetails');\n        if (statusEl1) statusEl1.textContent = '\uD83D\uDD0D Schritt 1: Sitemap wird gesucht...';\n        if (statusDetailsEl1) statusDetailsEl1.textContent = 'Suche nach sitemap.xml auf ' + formData.websiteUrl;\n        \n        console.log('Making API call to /api/workflow/step1');\n        const response = await fetch('/api/workflow/step1', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(formData)\n        });\n        \n        console.log('Response status:', response.status, response.statusText);\n        \n        if (!response.ok) {\n          const errorText = await response.text();\n          console.error('API error response:', errorText);\n          let errorData;\n          try {\n            errorData = JSON.parse(errorText);\n          } catch {\n            errorData = { error: 'Unknown error', message: response.statusText };\n          }\n          throw new Error(errorData.message || errorData.error || 'Failed to start analysis');\n        }\n        \n        const data = await response.json();\n        console.log('API response data:', data);\n        \n        if (data.error) {\n          throw new Error(data.message || data.error);\n        }\n        \n        if (!data.runId) {\n          throw new Error('No runId received from server');\n        }\n        \n        currentRunId = data.runId;\n        workflowData.urls = data.urls || [];\n        workflowData.foundSitemap = data.foundSitemap !== false; // Default to true if not specified\n        progressFill.style.width = '20%';\n        \n        const statusEl2 = document.getElementById('currentStatus');\n        const statusDetailsEl2 = document.getElementById('statusDetails');\n        \n        if (data.foundSitemap) {\n          progressText.textContent = 'Sitemap gefunden: ' + (data.urls ? data.urls.length : 0) + ' URLs';\n          if (statusEl2) {\n            statusEl2.textContent = '\u2705 Schritt 1 abgeschlossen: Sitemap gefunden';\n            statusEl2.style.color = '#059669';\n          }\n          if (statusDetailsEl2) statusDetailsEl2.textContent = data.urls && data.urls.length > 0 \n            ? data.urls.length + ' URLs gefunden. Bereite Schritt 2 vor...'\n            : 'Keine URLs in Sitemap gefunden.';\n        } else {\n          progressText.textContent = 'Keine Sitemap gefunden: ' + (data.urls ? data.urls.length : 0) + ' URLs von Startseite';\n          if (statusEl2) {\n            statusEl2.textContent = '\u26A0\uFE0F Schritt 1 abgeschlossen: Keine Sitemap gefunden';\n            statusEl2.style.color = '#d97706';\n          }\n          if (statusDetailsEl2) {\n            statusDetailsEl2.textContent = data.message || (data.urls && data.urls.length > 0 \n              ? data.urls.length + ' URLs von Startseite extrahiert. Bereite Schritt 2 vor...'\n              : 'Keine URLs gefunden.');\n          }\n        }\n        \n        console.log('Step 1 completed. RunId:', currentRunId, 'URLs:', data.urls?.length || 0, 'FoundSitemap:', data.foundSitemap);\n        \n        if (data.urls && data.urls.length > 0) {\n          // Auto-proceed to step 2\n          setTimeout(() => executeStep2(), 1000);\n        } else {\n          document.getElementById('resultContent').innerHTML = \n            '<div style=\"color: orange; padding: 15px; background: #fff3cd; border-radius: 8px; border-left: 4px solid #ffc107;\">' +\n            '\u26A0\uFE0F Keine URLs gefunden. Bitte manuell URLs eingeben oder Crawling verwenden.</div>';\n          result.classList.add('show');\n          loading.classList.remove('show');\n          loading.style.display = 'none';\n        }\n      } catch (error) {\n        console.error('Error in executeStep1:', error);\n        const result = document.getElementById('result');\n        const loading = document.getElementById('loading');\n        const resultContent = document.getElementById('resultContent');\n        \n        if (resultContent) {\n          resultContent.innerHTML = \n            '<div style=\"color: red; padding: 15px; background: #ffebee; border-radius: 8px; border-left: 4px solid #f44336;\">' +\n            '<strong>\u274C Fehler beim Starten der Analyse:</strong><br>' + \n            (error.message || error || 'Unbekannter Fehler') + \n            '</div>';\n        }\n        if (result) result.classList.add('show');\n        if (loading) loading.classList.remove('show');\n        throw error;\n      }\n    }\n\n    // Step 2: Fetch Content (with live updates)\n    async function executeStep2() {\n      // Update global reference\n      window.currentRunId = currentRunId;\n      window.workflowData = workflowData;\n      try {\n        const statusEl3 = document.getElementById('currentStatus');\n        const statusDetailsEl3 = document.getElementById('statusDetails');\n        if (statusEl3) statusEl3.textContent = '\uD83D\uDCC4 Schritt 2: Inhalte werden geholt...';\n        if (statusDetailsEl3) statusDetailsEl3.textContent = 'Lade Inhalte von ' + workflowData.urls.length + ' URLs';\n        \n        const progressText = document.getElementById('progressText');\n        const resultContent = document.getElementById('resultContent');\n        resultContent.innerHTML = '<h3>\uD83D\uDCC4 Geholte Inhalte:</h3><div id=\"contentList\"></div>';\n        document.getElementById('result').classList.add('show');\n        \n        let fetchedCount = 0;\n        const contentList = document.getElementById('contentList');\n        const allContent = [];\n        \n        // Fetch URLs one by one with live updates\n        const maxUrls = Math.min(workflowData.urls.length, 50);\n        for (let i = 0; i < maxUrls; i++) {\n          const url = workflowData.urls[i];\n          progressText.textContent = 'Hole Inhalte... (' + (i + 1) + '/' + maxUrls + ')';\n          const statusDetailsEl3Loop = document.getElementById('statusDetails');\n          if (statusDetailsEl3Loop) statusDetailsEl3Loop.textContent = 'Lade URL ' + (i + 1) + ' von ' + maxUrls + ': ' + url.substring(0, 50) + '...';\n          document.getElementById('progressFill').style.width = (20 + (i / maxUrls) * 20) + '%';\n          \n          try {\n            const response = await fetch('/api/workflow/fetchUrl', {\n              method: 'POST',\n              headers: { 'Content-Type': 'application/json' },\n              body: JSON.stringify({ url: url })\n            });\n            const data = await response.json();\n            \n            if (data.content) {\n              fetchedCount++;\n              allContent.push(data.content);\n              const urlDiv = document.createElement('div');\n              urlDiv.style.cssText = 'margin: 5px 0; padding: 8px; background: #e8f5e9; border-radius: 4px; border-left: 3px solid #4caf50;';\n              urlDiv.innerHTML = '<strong>\u2713 ' + url + '</strong><br><small>' + \n                (data.content.substring(0, 100) + '...') + '</small>';\n              contentList.appendChild(urlDiv);\n            }\n          } catch (error) {\n            const urlDiv = document.createElement('div');\n            urlDiv.style.cssText = 'margin: 5px 0; padding: 8px; background: #ffebee; border-radius: 4px; border-left: 3px solid #f44336;';\n            urlDiv.innerHTML = '<strong>\u2717 ' + url + '</strong><br><small>Fehler beim Laden</small>';\n            contentList.appendChild(urlDiv);\n          }\n        }\n        \n        const separator = String.fromCharCode(10) + String.fromCharCode(10);\n        workflowData.content = allContent.join(separator);\n        document.getElementById('progressFill').style.width = '40%';\n        progressText.textContent = 'Inhalte von ' + fetchedCount + ' Seiten geholt';\n        \n        const statusEl4 = document.getElementById('currentStatus');\n        const statusDetailsEl4 = document.getElementById('statusDetails');\n        if (statusEl4) statusEl4.textContent = '\u2705 Schritt 2 abgeschlossen: Inhalte geholt';\n        if (statusDetailsEl4) statusDetailsEl4.textContent = fetchedCount + ' Seiten erfolgreich geladen. Bereite Schritt 3 vor...';\n        \n        // Auto-proceed to step 3\n        setTimeout(() => executeStep3(), 1000);\n      } catch (error) {\n        throw error;\n      }\n    }\n\n    // Step 3: Generate Categories\n    async function executeStep3() {\n      try {\n        const statusEl5 = document.getElementById('currentStatus');\n        const statusDetailsEl5 = document.getElementById('statusDetails');\n        if (statusEl5) statusEl5.textContent = '\uD83E\uDD16 Schritt 3: Kategorien werden generiert...';\n        if (statusDetailsEl5) statusDetailsEl5.textContent = 'GPT analysiert Inhalte und generiert Kategorien/Keywords...';\n        \n        document.getElementById('progressText').textContent = 'Generiere Kategorien/Keywords mit GPT...';\n        const response = await fetch('/api/workflow/step3', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            runId: currentRunId,\n            content: workflowData.content || 'Website content',\n            language: workflowData.language\n          })\n        });\n        const data = await response.json();\n        console.log('\uD83D\uDCCA Step 3 Response:', data);\n        console.log('\uD83D\uDCCA Categories received:', data.categories?.length || 0, data.categories);\n        \n        if (!data.categories || !Array.isArray(data.categories)) {\n          console.error('\u274C Invalid categories data:', data);\n          alert('Fehler: Keine Kategorien erhalten. Bitte versuche es erneut.');\n          return;\n        }\n        \n        workflowData.categories = data.categories;\n        document.getElementById('progressFill').style.width = '60%';\n        document.getElementById('progressText').textContent = \n          data.categories.length + ' Kategorien generiert';\n        \n        // Update status (reuse existing variables)\n        if (statusEl5) statusEl5.textContent = '\u2705 Schritt 3 abgeschlossen: ' + data.categories.length + ' Kategorien generiert';\n        if (statusDetailsEl5) statusDetailsEl5.textContent = 'Bitte w\u00E4hle die Kategorien aus, f\u00FCr die Fragen generiert werden sollen.';\n        \n        // Show categories for user selection\n        try {\n          showCategorySelection(data.categories);\n        } catch (error) {\n          console.error('\u274C Error in showCategorySelection:', error);\n          const resultContent = document.getElementById('resultContent');\n          if (resultContent) {\n            resultContent.innerHTML = \n              '<div style=\"color: red; padding: 15px; background: #ffebee; border-radius: 8px; border-left: 4px solid #f44336;\">' +\n              '<strong>\u274C Fehler beim Anzeigen der Kategorien:</strong><br>' + \n              (error.message || error || 'Unbekannter Fehler') + \n              '</div>';\n          }\n          throw error;\n        }\n      } catch (error) {\n        console.error('\u274C Error in executeStep3:', error);\n        throw error;\n      }\n    }\n\n    function showCategorySelection(categories) {\n      try {\n        console.log('\uD83D\uDCCB Showing categories:', categories.length, categories);\n        \n        if (!categories || !Array.isArray(categories)) {\n          throw new Error('Ung\u00FCltige Kategorien-Daten: ' + typeof categories);\n        }\n        \n        const result = document.getElementById('result');\n        const resultContent = document.getElementById('resultContent');\n        \n        if (!result || !resultContent) {\n          console.error('\u274C Result elements not found!');\n          alert('Fehler: Ergebnis-Container nicht gefunden. Bitte Seite neu laden.');\n          return;\n        }\n      \n      // Ensure result is visible\n      result.style.display = 'block';\n      result.classList.add('show');\n      \n      let html = '<div style=\"margin-bottom: 20px;\">';\n      html += '<h3 style=\"margin-bottom: 16px; color: var(--gray-900); font-size: 20px;\">\uD83D\uDCCB W\u00E4hle Kategorien aus (' + categories.length + ' gefunden):</h3>';\n      html += '<p style=\"color: var(--gray-600); font-size: 14px; margin-bottom: 20px;\">W\u00E4hle die Kategorien aus, f\u00FCr die Fragen generiert werden sollen. Du kannst auch neue Kategorien hinzuf\u00FCgen.</p>';\n      html += '</div>';\n      \n      html += '<form id=\"categoryForm\" style=\"margin-top: 20px;\">';\n      \n      if (!categories || categories.length === 0) {\n        html += '<div style=\"padding: 20px; background: var(--gray-100); border-radius: 8px; color: var(--gray-600);\">';\n        html += 'Keine Kategorien gefunden. Bitte versuche es erneut oder f\u00FCge manuell Kategorien hinzu.';\n        html += '</div>';\n      } else {\n        // Use grid layout for compact display\n        html += '<div id=\"categoriesGrid\" style=\"display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 8px; margin-bottom: 16px;\">';\n        categories.forEach(function(cat, index) {\n          const catId = (cat.id || 'cat_' + index).replace(/\"/g, '&quot;').replace(/'/g, '&#39;');\n          const catName = (cat.name || 'Kategorie ' + (index + 1)).replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;').replace(/'/g, '&#39;');\n          const catDesc = (cat.description || 'Keine Beschreibung').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;').replace(/'/g, '&#39;');\n          html += '<div class=\"category-item-compact\" data-cat-id=\"' + catId + '\" style=\"padding: 10px; background: white; border: 1px solid var(--gray-200); border-radius: 6px; transition: all 0.2s; cursor: pointer;\">';\n          html += '<label style=\"display: flex; align-items: center; cursor: pointer; gap: 8px; margin: 0;\">';\n          html += '<input type=\"checkbox\" name=\"category\" value=\"' + catId + '\" checked style=\"width: 16px; height: 16px; cursor: pointer; flex-shrink: 0;\">';\n          html += '<div style=\"flex: 1; min-width: 0;\">';\n          html += '<strong style=\"display: block; color: var(--gray-900); font-size: 14px; margin-bottom: 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;\">' + catName + '</strong>';\n          html += '<span style=\"display: block; color: var(--gray-600); font-size: 12px; line-height: 1.3; max-height: 2.6em; overflow: hidden; text-overflow: ellipsis;\">' + catDesc + '</span>';\n          html += '</div>';\n          html += '</label>';\n          html += '</div>';\n        });\n        html += '</div>';\n      }\n      \n      // Add custom category input\n      html += '<div style=\"margin-top: 24px; padding: 16px; background: var(--gray-50); border-radius: 8px; border: 2px dashed var(--gray-300);\">';\n      html += '<h4 style=\"margin-bottom: 12px; color: var(--gray-900); font-size: 14px; font-weight: 600;\">\u2795 Neue Kategorie hinzuf\u00FCgen</h4>';\n      html += '<div style=\"display: grid; grid-template-columns: 1fr 2fr; gap: 12px; margin-bottom: 12px;\">';\n      html += '<input type=\"text\" id=\"newCategoryName\" placeholder=\"Kategorie-Name\" style=\"padding: 10px; border: 1px solid var(--gray-300); border-radius: 6px; font-size: 14px;\">';\n      html += '<input type=\"text\" id=\"newCategoryDesc\" placeholder=\"Beschreibung\" style=\"padding: 10px; border: 1px solid var(--gray-300); border-radius: 6px; font-size: 14px;\">';\n      html += '</div>';\n      html += '<button type=\"button\" id=\"addCategoryBtn\" class=\"btn\" style=\"background: var(--gray-600); padding: 10px 20px; font-size: 14px;\">Kategorie hinzuf\u00FCgen</button>';\n      html += '</div>';\n      \n      html += '<div style=\"margin-top: 24px; display: flex; gap: 12px;\">';\n      html += '<button type=\"submit\" class=\"btn btn-primary\" style=\"flex: 1; padding: 14px 24px; font-size: 16px;\">\u2705 Weiter zu Fragen generieren</button>';\n      html += '<button type=\"button\" id=\"regenerateCategoriesBtn\" class=\"btn\" style=\"background: var(--gray-600); padding: 14px 24px; font-size: 16px;\">\uD83D\uDD04 Kategorien neu generieren</button>';\n      html += '</div>';\n      html += '</form>';\n      \n      resultContent.innerHTML = html;\n      \n      // Add click handlers for category items (click anywhere on card to toggle checkbox)\n      const categoryItems = document.querySelectorAll('.category-item-compact');\n      categoryItems.forEach(function(item) {\n        item.addEventListener('click', function(e) {\n          if (e.target.tagName !== 'INPUT' && e.target.tagName !== 'LABEL' && e.target.tagName !== 'STRONG' && e.target.tagName !== 'SPAN' && e.target.tagName !== 'DIV') {\n            const checkbox = item.querySelector('input[type=\"checkbox\"]');\n            if (checkbox) {\n              checkbox.click();\n            }\n          }\n        });\n      });\n      \n      // Add event listener for adding custom categories\n      const addCategoryBtn = document.getElementById('addCategoryBtn');\n      if (addCategoryBtn) {\n        addCategoryBtn.addEventListener('click', () => {\n          const nameInput = document.getElementById('newCategoryName');\n          const descInput = document.getElementById('newCategoryDesc');\n          const name = nameInput?.value?.trim();\n          const desc = descInput?.value?.trim();\n          \n          if (!name) {\n            alert('Bitte gib einen Kategorie-Namen ein.');\n            return;\n          }\n          \n          // Add new category to the form\n          const form = document.getElementById('categoryForm');\n          if (form) {\n            const newCategoryDiv = document.createElement('div');\n            newCategoryDiv.style.cssText = 'margin: 12px 0; padding: 16px; background: white; border: 2px solid var(--primary); border-radius: 8px;';\n            newCategoryDiv.innerHTML = \n              '<label style=\"display: flex; align-items: flex-start; cursor: pointer; gap: 12px;\">' +\n              '<input type=\"checkbox\" name=\"category\" value=\"custom_' + Date.now() + '\" checked style=\"margin-top: 4px; width: 18px; height: 18px; cursor: pointer;\">' +\n              '<div style=\"flex: 1;\">' +\n              '<strong style=\"display: block; color: var(--gray-900); font-size: 16px; margin-bottom: 4px;\">' + name + '</strong>' +\n              '<span style=\"display: block; color: var(--gray-600); font-size: 14px;\">' + (desc || 'Benutzerdefinierte Kategorie') + '</span>' +\n              '</div>' +\n              '</label>';\n            \n            // Insert before the \"Add category\" section\n            const addSection = document.querySelector('#categoryForm > div:last-of-type');\n            if (addSection && addSection.previousElementSibling) {\n              addSection.parentNode?.insertBefore(newCategoryDiv, addSection);\n            } else {\n              form.insertBefore(newCategoryDiv, form.lastElementChild);\n            }\n            \n            // Clear inputs\n            if (nameInput) nameInput.value = '';\n            if (descInput) descInput.value = '';\n            \n            // Add to workflowData\n            if (!workflowData.categories) workflowData.categories = [];\n            workflowData.categories.push({\n              id: 'custom_' + Date.now(),\n              name: name,\n              description: desc || 'Benutzerdefinierte Kategorie',\n              confidence: 0.5,\n              sourcePages: []\n            });\n          }\n        });\n      }\n      \n      // Add event listener for regenerate button\n      const regenerateBtn = document.getElementById('regenerateCategoriesBtn');\n      if (regenerateBtn) {\n        regenerateBtn.addEventListener('click', async () => {\n          if (confirm('M\u00F6chtest du die Kategorien wirklich neu generieren? Die aktuellen Auswahlen gehen verloren.')) {\n            await executeStep3();\n          }\n        });\n      }\n      \n      // Add form submit handler\n      const categoryForm = document.getElementById('categoryForm');\n      if (categoryForm) {\n        console.log('\uD83D\uDCCB Setting up category form submit handler');\n        \n        // Remove existing listeners by cloning (but keep the form reference)\n        const formClone = categoryForm.cloneNode(true);\n        categoryForm.parentNode?.replaceChild(formClone, categoryForm);\n        \n        // Get the new form element\n        const newForm = document.getElementById('categoryForm');\n        if (newForm) {\n          console.log('\u2705 Category form found, adding submit listener');\n          \n          newForm.addEventListener('submit', async (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            \n            console.log('\uD83D\uDD35 Category form submitted!');\n            \n            const selected = Array.from(document.querySelectorAll('input[name=\"category\"]:checked'))\n              .map(cb => cb.value);\n            \n            console.log('\u2705 Selected categories:', selected);\n            console.log('\uD83D\uDCCA Available categories:', workflowData.categories?.length || 0);\n            \n            if (selected.length === 0) {\n              alert('Bitte w\u00E4hle mindestens eine Kategorie aus.');\n              return;\n            }\n            \n            // Update workflow data\n            workflowData.selectedCategories = selected;\n            \n            // IMMEDIATE VISUAL FEEDBACK - Disable button and show loading\n            const submitBtn = e.target.closest('form')?.querySelector('button[type=\"submit\"]');\n            if (submitBtn) {\n              submitBtn.disabled = true;\n              submitBtn.textContent = '\u23F3 Generiere Fragen...';\n              submitBtn.style.opacity = '0.7';\n              submitBtn.style.cursor = 'not-allowed';\n            }\n            \n            // Show loading state immediately\n            const loading = document.getElementById('loading');\n            if (loading) {\n              loading.style.display = 'block';\n              loading.classList.add('show');\n            }\n            \n            const progressFill = document.getElementById('progressFill');\n            const progressText = document.getElementById('progressText');\n            if (progressFill) {\n              progressFill.style.width = '60%';\n              progressFill.style.transition = 'width 0.3s ease';\n            }\n            if (progressText) progressText.textContent = 'Starte Fragen-Generierung...';\n            \n            const statusEl = document.getElementById('currentStatus');\n            const statusDetailsEl = document.getElementById('statusDetails');\n            if (statusEl) {\n              statusEl.textContent = '\uD83E\uDD16 Schritt 4: Fragen werden generiert...';\n              statusEl.style.color = '#2563eb';\n            }\n            if (statusDetailsEl) {\n              statusDetailsEl.textContent = 'GPT generiert Fragen f\u00FCr ' + selected.length + ' ausgew\u00E4hlte Kategorien. Bitte warten...';\n            }\n            \n            // Show progress in result area too\n            const resultContent = document.getElementById('resultContent');\n            if (resultContent) {\n              resultContent.innerHTML = \n                '<div style=\"text-align: center; padding: 40px;\">' +\n                '<div style=\"font-size: 48px; margin-bottom: 20px;\">\u23F3</div>' +\n                '<h3 style=\"color: var(--gray-900); margin-bottom: 12px;\">Fragen werden generiert...</h3>' +\n                '<p style=\"color: var(--gray-600); margin-bottom: 20px;\">GPT generiert ' + (workflowData.questionsPerCategory || 3) + ' Fragen pro Kategorie f\u00FCr ' + selected.length + ' Kategorien.</p>' +\n                '<div style=\"display: inline-block; width: 40px; height: 40px; border: 4px solid var(--gray-200); border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite;\"></div>' +\n                '</div>';\n              document.getElementById('result').style.display = 'block';\n              document.getElementById('result').classList.add('show');\n            }\n            \n            // Add spinning animation CSS if not already present\n            if (!document.getElementById('spinnerStyle')) {\n              const style = document.createElement('style');\n              style.id = 'spinnerStyle';\n              style.textContent = '@keyframes spin { to { transform: rotate(360deg); } }';\n              document.head.appendChild(style);\n            }\n            \n            try {\n              console.log('\uD83D\uDE80 Calling executeStep4...');\n              await executeStep4();\n            } catch (error) {\n              console.error('\u274C Error in executeStep4:', error);\n              const errorMessage = error && typeof error === 'object' && 'message' in error ? error.message : String(error);\n              alert('Fehler beim Generieren der Fragen: ' + errorMessage);\n              \n              // Re-enable button\n              if (submitBtn) {\n                submitBtn.disabled = false;\n                submitBtn.textContent = '\u2705 Weiter zu Fragen generieren';\n                submitBtn.style.opacity = '1';\n                submitBtn.style.cursor = 'pointer';\n              }\n              \n              if (loading) {\n                loading.style.display = 'none';\n              }\n            }\n          });\n          \n          console.log('\u2705 Category form submit handler attached');\n        } else {\n          console.error('\u274C Could not find categoryForm after clone');\n        }\n      } else {\n        console.error('\u274C Category form not found!');\n      }\n      } catch (error) {\n        console.error('\u274C Error in showCategorySelection:', error);\n        const resultContent = document.getElementById('resultContent');\n        if (resultContent) {\n          resultContent.innerHTML = \n            '<div style=\"color: red; padding: 15px; background: #ffebee; border-radius: 8px; border-left: 4px solid #f44336;\">' +\n            '<strong>\u274C Fehler beim Anzeigen der Kategorien:</strong><br>' + \n            (error && typeof error === 'object' && 'message' in error ? error.message : String(error)) + \n            '<br><small>Bitte versuche es erneut oder lade die Seite neu.</small>' +\n            '</div>';\n        }\n        throw error;\n      }\n    }\n\n    // Step 4: Generate Prompts\n    async function executeStep4() {\n      try {\n        console.log('\uD83D\uDE80 executeStep4 called');\n        console.log('\uD83D\uDCCA Selected categories:', workflowData.selectedCategories);\n        console.log('\uD83D\uDCCA Available categories:', workflowData.categories?.length || 0);\n        console.log('\uD83D\uDCCA Current runId:', currentRunId);\n        \n        if (!workflowData.selectedCategories || workflowData.selectedCategories.length === 0) {\n          throw new Error('Keine Kategorien ausgew\u00E4hlt');\n        }\n        \n        if (!workflowData.categories || workflowData.categories.length === 0) {\n          throw new Error('Keine Kategorien verf\u00FCgbar');\n        }\n        \n        const selectedCats = workflowData.categories.filter(c => \n          workflowData.selectedCategories.includes(c.id)\n        );\n        \n        console.log('\uD83D\uDCCB Filtered selected categories:', selectedCats.length, selectedCats);\n        \n        if (selectedCats.length === 0) {\n          throw new Error('Keine passenden Kategorien gefunden. Bitte w\u00E4hle Kategorien aus.');\n        }\n        \n        const questionsPerCategory = workflowData.questionsPerCategory || 3;\n        const totalQuestions = selectedCats.length * questionsPerCategory;\n        console.log('\uD83D\uDCCA Questions per category:', questionsPerCategory);\n        console.log('\uD83D\uDCCA Total questions to generate:', totalQuestions);\n        \n        // Update progress with detailed info\n        const progressText = document.getElementById('progressText');\n        const progressFill = document.getElementById('progressFill');\n        if (progressText) progressText.textContent = 'Generiere ' + totalQuestions + ' Fragen f\u00FCr ' + selectedCats.length + ' Kategorien...';\n        if (progressFill) {\n          progressFill.style.width = '65%';\n          progressFill.style.transition = 'width 0.3s ease';\n        }\n        \n        const statusEl = document.getElementById('currentStatus');\n        const statusDetailsEl = document.getElementById('statusDetails');\n        if (statusEl) {\n          statusEl.textContent = '\uD83E\uDD16 Schritt 4: Fragen werden generiert...';\n          statusEl.style.color = '#2563eb';\n        }\n        if (statusDetailsEl) {\n          statusDetailsEl.textContent = 'GPT generiert ' + questionsPerCategory + ' Fragen pro Kategorie f\u00FCr ' + selectedCats.length + ' Kategorien. Dies kann einige Sekunden dauern...';\n        }\n        \n        // Update result area with progress\n        const resultContent = document.getElementById('resultContent');\n        if (resultContent) {\n          resultContent.innerHTML = \n            '<div style=\"text-align: center; padding: 40px;\">' +\n            '<div style=\"font-size: 48px; margin-bottom: 20px;\">\u23F3</div>' +\n            '<h3 style=\"color: var(--gray-900); margin-bottom: 12px;\">Fragen werden generiert...</h3>' +\n            '<p style=\"color: var(--gray-600); margin-bottom: 8px;\">Generiere ' + questionsPerCategory + ' Fragen pro Kategorie</p>' +\n            '<p style=\"color: var(--gray-600); margin-bottom: 20px;\">f\u00FCr ' + selectedCats.length + ' Kategorien = ' + totalQuestions + ' Fragen insgesamt</p>' +\n            '<div style=\"display: inline-block; width: 40px; height: 40px; border: 4px solid var(--gray-200); border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite;\"></div>' +\n            '<p style=\"color: var(--gray-500); font-size: 12px; margin-top: 20px;\">Bitte warten, dies kann 30-60 Sekunden dauern...</p>' +\n            '</div>';\n        }\n        \n        console.log('\uD83D\uDCE1 Making API call to /api/workflow/step4');\n        console.log('\uD83D\uDCCA Sending questionsPerCategory:', questionsPerCategory);\n        const response = await fetch('/api/workflow/step4', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            runId: currentRunId,\n            categories: selectedCats,\n            userInput: workflowData,\n            content: workflowData.content || '',\n            questionsPerCategory: questionsPerCategory\n          })\n        });\n        \n        console.log('\uD83D\uDCE1 API Response status:', response.status);\n        \n        if (!response.ok) {\n          const errorText = await response.text();\n          console.error('\u274C API Error:', errorText);\n          throw new Error('API Fehler: ' + response.status + ' - ' + errorText.substring(0, 200));\n        }\n        \n        const data = await response.json();\n        console.log('\u2705 API Response data:', data);\n        console.log('\uD83D\uDCCB Prompts received:', data.prompts?.length || 0);\n        \n        if (!data.prompts || !Array.isArray(data.prompts)) {\n          throw new Error('Keine Fragen erhalten. Bitte versuche es erneut.');\n        }\n        \n        workflowData.prompts = data.prompts;\n        \n        // Update progress to 80%\n        if (progressFill) {\n          progressFill.style.width = '80%';\n          progressFill.style.transition = 'width 0.3s ease';\n        }\n        if (progressText) {\n          progressText.textContent = '\u2705 ' + data.prompts.length + ' Fragen erfolgreich generiert!';\n        }\n        \n        if (statusEl) {\n          statusEl.textContent = '\u2705 Schritt 4 abgeschlossen: ' + data.prompts.length + ' Fragen generiert';\n          statusEl.style.color = '#059669';\n        }\n        if (statusDetailsEl) {\n          statusDetailsEl.textContent = 'Alle Fragen wurden erfolgreich generiert. Bitte \u00FCberpr\u00FCfe und bearbeite die Fragen.';\n        }\n        \n        // Show success message briefly before showing prompts\n        if (resultContent) {\n          resultContent.innerHTML = \n            '<div style=\"text-align: center; padding: 40px;\">' +\n            '<div style=\"font-size: 48px; margin-bottom: 20px;\">\u2705</div>' +\n            '<h3 style=\"color: var(--success); margin-bottom: 12px;\">Fragen erfolgreich generiert!</h3>' +\n            '<p style=\"color: var(--gray-600); margin-bottom: 20px;\">' + data.prompts.length + ' Fragen wurden generiert und werden gleich angezeigt...</p>' +\n            '</div>';\n        }\n        \n        // Wait a moment to show success, then display prompts\n        setTimeout(function() {\n          showPromptSelection(data.prompts);\n        }, 1000);\n      } catch (error) {\n        console.error('\u274C Error in executeStep4:', error);\n        const errorMessage = error && typeof error === 'object' && 'message' in error ? error.message : String(error);\n        const errorStack = error && typeof error === 'object' && 'stack' in error ? error.stack : '';\n        console.error('Error details:', errorMessage, errorStack);\n        \n        const statusEl = document.getElementById('currentStatus');\n        const statusDetailsEl = document.getElementById('statusDetails');\n        if (statusEl) statusEl.textContent = '\u274C Fehler beim Generieren der Fragen';\n        if (statusDetailsEl) statusDetailsEl.textContent = errorMessage || 'Unbekannter Fehler';\n        \n        alert('Fehler beim Generieren der Fragen: ' + errorMessage);\n        throw error;\n      }\n    }\n\n    function showPromptSelection(prompts) {\n      console.log('\uD83D\uDCCB Showing prompts:', prompts.length);\n      const resultContent = document.getElementById('resultContent');\n      if (!resultContent) {\n        console.error('\u274C resultContent not found!');\n        return;\n      }\n      \n      let html = '<div style=\"margin-bottom: 20px;\">';\n      html += '<h3 style=\"margin-bottom: 16px; color: var(--gray-900); font-size: 20px;\">\u2753 Generierte Fragen (' + prompts.length + '):</h3>';\n      html += '<p style=\"color: var(--gray-600); font-size: 14px; margin-bottom: 20px;\">Du kannst die Fragen bearbeiten oder einzelne deaktivieren, bevor die Analyse startet.</p>';\n      html += '</div>';\n      \n      html += '<form id=\"promptForm\" style=\"margin-top: 20px;\">';\n      \n      if (!prompts || prompts.length === 0) {\n        html += '<div style=\"padding: 20px; background: var(--gray-100); border-radius: 8px; color: var(--gray-600);\">';\n        html += 'Keine Fragen gefunden. Bitte versuche es erneut.';\n        html += '</div>';\n      } else {\n        prompts.forEach((prompt, idx) => {\n          const promptId = prompt.id || 'prompt_' + idx;\n          const promptQuestion = prompt.question || prompt.text || '';\n          html += '<div style=\"margin-bottom: 16px; padding: 16px; background: white; border: 1px solid var(--gray-200); border-radius: 8px; transition: all 0.2s;\">';\n          html += '<div style=\"display: flex; align-items: flex-start; gap: 12px;\">';\n          html += '<input type=\"checkbox\" name=\"selected\" value=\"' + promptId + '\" checked style=\"width: 20px; height: 20px; margin-top: 4px; cursor: pointer; flex-shrink: 0;\">';\n          html += '<div style=\"flex: 1;\">';\n          html += '<label style=\"display: block; color: var(--gray-700); font-size: 12px; font-weight: 600; margin-bottom: 6px;\">Frage ' + (idx + 1) + ':</label>';\n          html += '<textarea name=\"prompt_' + promptId + '\" style=\"width: 100%; padding: 12px; border: 1px solid var(--gray-300); border-radius: 6px; font-size: 14px; font-family: inherit; resize: vertical; min-height: 60px;\" rows=\"2\">' + promptQuestion.replace(/</g, '&lt;').replace(/>/g, '&gt;') + '</textarea>';\n          html += '</div>';\n          html += '</div>';\n          html += '</div>';\n        });\n      }\n      \n      html += '<div style=\"margin-top: 24px; display: flex; gap: 12px;\">';\n      html += '<button type=\"submit\" class=\"btn btn-primary\" style=\"flex: 1; padding: 14px 24px; font-size: 16px;\">\uD83D\uDE80 Analyse mit GPT-5 starten</button>';\n      html += '</div>';\n      html += '</form>';\n      \n      resultContent.innerHTML = html;\n      \n      // Remove existing form and recreate to avoid duplicate listeners\n      const promptForm = document.getElementById('promptForm');\n      if (promptForm) {\n        const formClone = promptForm.cloneNode(true);\n        promptForm.parentNode?.replaceChild(formClone, promptForm);\n        \n        const newPromptForm = document.getElementById('promptForm');\n        if (newPromptForm) {\n          newPromptForm.addEventListener('submit', async (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            \n            console.log('\uD83D\uDD35 Prompt form submitted!');\n            \n            const updatedPrompts = prompts.map(p => {\n              const textarea = document.querySelector('textarea[name=\"prompt_' + p.id + '\"]');\n              const checkbox = document.querySelector('input[name=\"selected\"][value=\"' + p.id + '\"]');\n              return {\n                ...p,\n                question: textarea ? textarea.value : p.question,\n                isSelected: checkbox ? checkbox.checked : true\n              };\n            }).filter(p => p.isSelected);\n            \n            console.log('\u2705 Updated prompts:', updatedPrompts.length);\n            \n            if (updatedPrompts.length === 0) {\n              alert('Bitte w\u00E4hle mindestens eine Frage aus.');\n              return;\n            }\n            \n            workflowData.prompts = updatedPrompts;\n            \n            // Show loading\n            const loading = document.getElementById('loading');\n            if (loading) {\n              loading.style.display = 'block';\n              loading.classList.add('show');\n            }\n            \n            const progressFill = document.getElementById('progressFill');\n            const progressText = document.getElementById('progressText');\n            if (progressFill) progressFill.style.width = '80%';\n            if (progressText) progressText.textContent = 'Starte GPT-5 Ausf\u00FChrung...';\n            \n            const statusEl = document.getElementById('currentStatus');\n            const statusDetailsEl = document.getElementById('statusDetails');\n            if (statusEl) statusEl.textContent = '\uD83E\uDD16 Schritt 5: GPT-5 Ausf\u00FChrung...';\n            if (statusDetailsEl) statusDetailsEl.textContent = 'F\u00FChre ' + updatedPrompts.length + ' Fragen aus...';\n            \n            try {\n              await executeStep5();\n            } catch (error) {\n              console.error('\u274C Error in executeStep5:', error);\n              const errorMessage = error && typeof error === 'object' && 'message' in error ? error.message : String(error);\n              alert('Fehler beim Ausf\u00FChren der Fragen: ' + errorMessage);\n              if (loading) {\n                loading.style.display = 'none';\n              }\n            }\n          });\n          \n          console.log('\u2705 Prompt form submit handler attached');\n        }\n      }\n    }\n\n    // Step 5: Execute with GPT-5 (with live updates)\n    async function executeStep5() {\n      try {\n        const progressText = document.getElementById('progressText');\n        const progressFill = document.getElementById('progressFill');\n        const resultContent = document.getElementById('resultContent');\n        const statusEl = document.getElementById('currentStatus');\n        const statusDetailsEl = document.getElementById('statusDetails');\n        \n        // Initialize result area\n        resultContent.innerHTML = \n          '<div style=\"margin-bottom: 20px;\">' +\n          '<h3 style=\"margin-bottom: 16px; color: var(--gray-900); font-size: 20px;\">\uD83E\uDD16 GPT-5 Antworten (Live):</h3>' +\n          '<p style=\"color: var(--gray-600); font-size: 14px;\">Jede Frage wird einzeln ausgef\u00FChrt und live angezeigt...</p>' +\n          '</div>' +\n          '<div id=\"responsesList\" style=\"display: flex; flex-direction: column; gap: 16px;\"></div>';\n        document.getElementById('result').style.display = 'block';\n        document.getElementById('result').classList.add('show');\n        \n        const responsesList = document.getElementById('responsesList');\n        let executedCount = 0;\n        const promptsLength = workflowData.prompts.length;\n        \n        // Store all questions and answers for summary\n        const allQuestionsAndAnswers = [];\n        \n        // Update status\n        if (statusEl) statusEl.textContent = '\uD83E\uDD16 Schritt 5: GPT-5 Ausf\u00FChrung l\u00E4uft...';\n        if (statusDetailsEl) statusDetailsEl.textContent = 'F\u00FChre ' + promptsLength + ' Fragen mit Web Search aus...';\n        \n        // Execute prompts one by one with live updates\n        for (let i = 0; i < promptsLength; i++) {\n          const prompt = workflowData.prompts[i];\n          const progressPercent = 80 + ((i / promptsLength) * 20);\n          \n          // Update progress\n          if (progressText) progressText.textContent = 'Frage ' + (i + 1) + '/' + promptsLength + ' wird ausgef\u00FChrt...';\n          if (progressFill) {\n            progressFill.style.width = progressPercent + '%';\n            progressFill.style.transition = 'width 0.3s ease';\n          }\n          \n          // Show \"processing\" indicator for current question\n          const processingDiv = document.createElement('div');\n          processingDiv.id = 'processing_' + i;\n          processingDiv.style.cssText = 'padding: 16px; background: var(--gray-100); border: 2px dashed var(--gray-300); border-radius: 8px; text-align: center;';\n          processingDiv.innerHTML = \n            '<div style=\"display: inline-block; width: 24px; height: 24px; border: 3px solid var(--gray-300); border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 8px;\"></div>' +\n            '<p style=\"color: var(--gray-700); font-weight: 600; margin: 0;\">Frage ' + (i + 1) + ' wird ausgef\u00FChrt...</p>' +\n            '<p style=\"color: var(--gray-600); font-size: 14px; margin: 4px 0 0 0;\">' + prompt.question + '</p>';\n          responsesList.appendChild(processingDiv);\n          processingDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });\n          \n          try {\n            const response = await fetch('/api/workflow/executePrompt', {\n              method: 'POST',\n              headers: { 'Content-Type': 'application/json' },\n              body: JSON.stringify({\n                runId: currentRunId,\n                prompt: prompt,\n                userInput: workflowData\n              })\n            });\n            \n            if (!response.ok) {\n              const errorData = await response.json();\n              throw new Error(errorData.error || 'API Fehler: ' + response.status);\n            }\n            \n            const data = await response.json();\n            \n            console.log('\uD83D\uDCE1 API Response data:', JSON.stringify(data, null, 2));\n            console.log('\uD83D\uDCCA Response outputText:', data.response?.outputText);\n            console.log('\uD83D\uDCCA Response citations:', JSON.stringify(data.response?.citations, null, 2));\n            console.log('\uD83D\uDCCA Analysis citations:', JSON.stringify(data.analysis?.citations, null, 2));\n            console.log('\uD83D\uDCCA Citations count in response:', data.response?.citations?.length || 0);\n            console.log('\uD83D\uDCCA Citations count in analysis:', data.analysis?.citations?.length || 0);\n            console.log('\uD83D\uDCCA Full response object keys:', data.response ? Object.keys(data.response) : 'no response');\n            console.log('\uD83D\uDCCA Full analysis object keys:', data.analysis ? Object.keys(data.analysis) : 'no analysis');\n            \n            // Remove processing indicator\n            const processingEl = document.getElementById('processing_' + i);\n            if (processingEl) processingEl.remove();\n            \n            if (data.response && data.analysis) {\n              executedCount++;\n              let answerText = data.response.outputText || '';\n              \n              console.log('\u2705 Answer text length:', answerText.length);\n              console.log('\u2705 Answer text preview:', answerText.substring(0, 100));\n              console.log('\uD83D\uDCCA Full response object:', data.response);\n              \n              // If answer is empty, try to get it from different paths\n              if (!answerText || answerText.trim().length === 0) {\n                console.warn('\u26A0\uFE0F Empty answer text! Trying fallback paths...');\n                if (data.response?.text) {\n                  answerText = data.response.text;\n                  console.log('\u2705 Found text in response.text');\n                } else if (data.response?.content) {\n                  answerText = typeof data.response.content === 'string' \n                    ? data.response.content \n                    : JSON.stringify(data.response.content);\n                  console.log('\u2705 Found text in response.content');\n                } else if (data.outputText) {\n                  answerText = data.outputText;\n                  console.log('\u2705 Found text in data.outputText');\n                } else {\n                  console.warn('\u26A0\uFE0F No answer text found anywhere! Full data:', JSON.stringify(data, null, 2));\n                  answerText = '\u26A0\uFE0F Keine Antwort erhalten. Bitte Browser-Konsole f\u00FCr Details pr\u00FCfen.';\n                }\n              }\n              \n              // Use citations directly from GPT-5 Web Search response (response.citations)\n              // Fallback to analysis.citations if response.citations is not available\n              const responseCitations = data.response?.citations || [];\n              const analysisCitations = data.analysis?.citations || [];\n              const citations = responseCitations.length > 0 ? responseCitations : analysisCitations;\n              \n              const brandMentions = data.analysis.brandMentions || { exact: 0, fuzzy: 0, contexts: [] };\n              const competitors = data.analysis.competitors || [];\n              const sentiment = data.analysis.sentiment || { tone: 'neutral', confidence: 0 };\n              \n              // Store question and answer for summary\n              allQuestionsAndAnswers.push({\n                question: prompt.question,\n                answer: answerText,\n                citations: citations,\n                brandMentions: brandMentions,\n                competitors: competitors\n              });\n              \n              // Create response card\n              const responseDiv = document.createElement('div');\n              responseDiv.style.cssText = 'padding: 20px; background: white; border: 1px solid var(--gray-200); border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);';\n              \n              let citationsHtml = '';\n              if (citations.length > 0) {\n                citationsHtml = '<div style=\"margin-top: 16px; padding: 16px; background: #f0f9ff; border: 1px solid #bae6fd; border-radius: 8px;\">';\n                citationsHtml += '<div style=\"font-size: 13px; font-weight: 500; color: #0369a1; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 12px;\">Quellen (' + citations.length + ')</div>';\n                citationsHtml += '<div style=\"display: flex; flex-direction: column; gap: 8px;\">';\n                citations.forEach(function(citation, idx) {\n                  const url = citation.url || '';\n                  const title = citation.title || url || 'Unbenannte Quelle';\n                  const snippet = citation.snippet || '';\n                  citationsHtml += '<a href=\"' + url + '\" target=\"_blank\" rel=\"noopener noreferrer\" class=\"citation-link\" style=\"color: #0369a1; font-size: 13px; text-decoration: none; padding: 12px; background: #ffffff; border-radius: 6px; display: block; border: 1px solid #e5e7eb; transition: all 0.2s ease; box-shadow: 0 1px 2px rgba(0,0,0,0.05); cursor: pointer;\">';\n                  citationsHtml += '<div style=\"display: flex; align-items: start; gap: 10px;\">';\n                  citationsHtml += '<span style=\"font-weight: 600; color: #3b82f6; font-size: 13px; min-width: 24px; padding-top: 2px;\">' + (idx + 1) + '.</span>';\n                  citationsHtml += '<div style=\"flex: 1;\">';\n                  citationsHtml += '<div style=\"font-weight: 500; color: #111827; margin-bottom: 4px; line-height: 1.4;\">' + title.replace(/</g, '&lt;').replace(/>/g, '&gt;') + '</div>';\n                  if (url) {\n                    try {\n                      const hostname = new URL(url).hostname;\n                      citationsHtml += '<div style=\"color: #6b7280; font-size: 11px; margin-bottom: 6px; font-family: ui-monospace, monospace;\">' + hostname + '</div>';\n                    } catch (e) {\n                      // Invalid URL, skip hostname\n                    }\n                  }\n                  if (snippet && snippet.trim().length > 0) {\n                    citationsHtml += '<div style=\"color: #6b7280; font-size: 12px; line-height: 1.5; font-style: normal;\">';\n                    citationsHtml += snippet.substring(0, 120).replace(/</g, '&lt;').replace(/>/g, '&gt;') + (snippet.length > 120 ? '...' : '');\n                    citationsHtml += '</div>';\n                  }\n                  citationsHtml += '</div></div></a>';\n                });\n                citationsHtml += '</div></div>';\n                // Add CSS for citation links hover effect (after HTML is inserted)\n                if (!document.getElementById('citation-link-style')) {\n                  const style = document.createElement('style');\n                  style.id = 'citation-link-style';\n                  style.textContent = '.citation-link:hover { border-color: #3b82f6 !important; box-shadow: 0 2px 4px rgba(59,130,246,0.1) !important; transform: translateY(-1px) !important; }';\n                  document.head.appendChild(style);\n                }\n              } else {\n                // Show message if no citations available\n                citationsHtml = '<div style=\"margin-top: 16px; padding: 12px; background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 8px;\">';\n                citationsHtml += '<div style=\"font-size: 13px; color: #6b7280;\">Keine Quellen verf\u00FCgbar</div>';\n                citationsHtml += '</div>';\n              }\n              \n              let mentionsHtml = '';\n              const totalMentions = brandMentions.exact + brandMentions.fuzzy;\n              if (totalMentions > 0) {\n                mentionsHtml = '<div style=\"margin-top: 16px; padding: 14px; background: #f0fdf4; border: 1px solid #bbf7d0; border-radius: 8px;\">';\n                mentionsHtml += '<div style=\"display: flex; align-items: center; gap: 12px; font-size: 13px;\">';\n                mentionsHtml += '<span style=\"color: #10b981; font-weight: 600;\">Markenerw\u00E4hnungen gefunden</span>';\n                mentionsHtml += '<span style=\"color: #6b7280;\">\u2022</span>';\n                mentionsHtml += '<span style=\"color: #374151;\"><strong>' + brandMentions.exact + '</strong> exakt</span>';\n                if (brandMentions.fuzzy > 0) {\n                  mentionsHtml += '<span style=\"color: #6b7280;\">\u2022</span>';\n                  mentionsHtml += '<span style=\"color: #374151;\"><strong>' + brandMentions.fuzzy + '</strong> \u00E4hnlich</span>';\n                }\n                mentionsHtml += '</div></div>';\n              }\n              \n              // Competitors section removed as requested\n              let competitorsHtml = '';\n              \n              responseDiv.innerHTML = \n                '<div style=\"display: flex; align-items: center; gap: 12px; margin-bottom: 16px; padding-bottom: 16px; border-bottom: 1px solid #e5e7eb;\">' +\n                '<span style=\"display: inline-flex; align-items: center; justify-content: center; width: 36px; height: 36px; background: #3b82f6; color: white; border-radius: 8px; font-weight: 600; font-size: 15px; flex-shrink: 0;\">' + (i + 1) + '</span>' +\n                '<h4 style=\"margin: 0; color: #111827; font-size: 17px; font-weight: 600; line-height: 1.4;\">' + prompt.question.replace(/</g, '&lt;').replace(/>/g, '&gt;') + '</h4>' +\n                '</div>' +\n                '<div style=\"margin-bottom: 16px;\">' +\n                '<div style=\"font-size: 13px; font-weight: 500; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px;\">Antwort</div>' +\n                '<div style=\"white-space: pre-wrap; background: #f9fafb; padding: 18px; border-radius: 8px; border: 1px solid #e5e7eb; color: #374151; line-height: 1.7; font-size: 14px; max-height: 400px; overflow-y: auto;\">' + \n                answerText.replace(/</g, '&lt;').replace(/>/g, '&gt;') + \n                '</div>' +\n                '</div>' +\n                mentionsHtml +\n                citationsHtml;\n              \n              responsesList.appendChild(responseDiv);\n              responseDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });\n            } else {\n              throw new Error('Ung\u00FCltige Antwort vom Server');\n            }\n          } catch (error) {\n            // Remove processing indicator\n            const processingEl = document.getElementById('processing_' + i);\n            if (processingEl) processingEl.remove();\n            \n            const errorDiv = document.createElement('div');\n            errorDiv.style.cssText = 'padding: 16px; background: #ffebee; border: 1px solid #f44336; border-radius: 8px; border-left: 4px solid #f44336;';\n            errorDiv.innerHTML = \n              '<div style=\"display: flex; align-items: center; gap: 8px; margin-bottom: 8px;\">' +\n              '<span style=\"font-size: 20px;\">\u274C</span>' +\n              '<strong style=\"color: #c62828;\">Fehler bei Frage ' + (i + 1) + ':</strong>' +\n              '</div>' +\n              '<p style=\"margin: 4px 0; color: var(--gray-700);\">' + prompt.question + '</p>' +\n              '<small style=\"color: #d32f2f;\">' + (error.message || 'Unbekannter Fehler') + '</small>';\n            responsesList.appendChild(errorDiv);\n            errorDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });\n          }\n        }\n        \n        // Final update\n        if (progressFill) {\n          progressFill.style.width = '100%';\n          progressFill.style.transition = 'width 0.3s ease';\n        }\n        if (progressText) progressText.textContent = '\u2705 Analyse abgeschlossen! ' + executedCount + ' von ' + promptsLength + ' Fragen erfolgreich ausgef\u00FChrt';\n        if (statusEl) {\n          statusEl.textContent = '\u2705 Schritt 5 abgeschlossen';\n          statusEl.style.color = '#059669';\n        }\n        if (statusDetailsEl) statusDetailsEl.textContent = 'Alle Fragen wurden ausgef\u00FChrt. Ergebnisse sind unten sichtbar.';\n        \n        // Save all responses\n        try {\n          await fetch('/api/workflow/step5', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              runId: currentRunId,\n              prompts: workflowData.prompts\n            })\n          });\n        } catch (error) {\n          console.error('Error saving responses:', error);\n        }\n        \n        // Generate summary/fazit after all questions are answered\n        if (executedCount > 0 && allQuestionsAndAnswers.length > 0) {\n          await generateSummary(allQuestionsAndAnswers, workflowData);\n        }\n        \n        const loading = document.getElementById('loading');\n        if (loading) {\n          loading.style.display = 'none';\n          loading.classList.remove('show');\n        }\n      } catch (error) {\n        console.error('Error in executeStep5:', error);\n        throw error;\n      }\n    }\n\n    async function generateSummary(questionsAndAnswers, workflowData) {\n      try {\n        const statusEl = document.getElementById('currentStatus');\n        const statusDetailsEl = document.getElementById('statusDetails');\n        const responsesList = document.getElementById('responsesList');\n        \n        if (statusEl) {\n          statusEl.textContent = '\uD83D\uDCCA Fazit wird generiert...';\n          statusEl.style.color = '#7c3aed';\n        }\n        if (statusDetailsEl) {\n          statusDetailsEl.textContent = 'GPT analysiert alle Fragen und Antworten...';\n        }\n        \n        // Check if responsesList exists\n        if (!responsesList) {\n          console.error('\u274C responsesList element not found');\n          throw new Error('Responses list element not found');\n        }\n        \n        // Show loading indicator\n        const summaryLoadingDiv = document.createElement('div');\n        summaryLoadingDiv.id = 'summaryLoading';\n        summaryLoadingDiv.style.cssText = 'padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; text-align: center; margin-top: 24px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);';\n        summaryLoadingDiv.innerHTML = \n          '<div style=\"display: inline-block; width: 32px; height: 32px; border: 4px solid rgba(255,255,255,0.3); border-top-color: white; border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 12px;\"></div>' +\n          '<p style=\"color: white; font-weight: 600; margin: 0; font-size: 16px;\">Fazit wird generiert...</p>' +\n          '<p style=\"color: rgba(255,255,255,0.9); font-size: 14px; margin: 8px 0 0 0;\">GPT analysiert alle Fragen und Antworten</p>';\n        responsesList.appendChild(summaryLoadingDiv);\n        summaryLoadingDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });\n        \n        // Call API to generate summary\n        const response = await fetch('/api/workflow/generateSummary', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            runId: currentRunId,\n            questionsAndAnswers: questionsAndAnswers,\n            userInput: workflowData\n          })\n        });\n        \n        if (!response.ok) {\n          throw new Error('Fehler beim Generieren des Fazits');\n        }\n        \n        const summaryData = await response.json();\n        \n        // Remove loading indicator\n        const loadingEl = document.getElementById('summaryLoading');\n        if (loadingEl) loadingEl.remove();\n        \n        // Display summary\n        const summaryDiv = document.createElement('div');\n        summaryDiv.id = 'summary';\n        summaryDiv.style.cssText = 'padding: 24px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; margin-top: 24px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); color: white;';\n        \n        const totalMentions = summaryData.totalMentions || 0;\n        const totalCitations = summaryData.totalCitations || 0;\n        const bestPrompts = summaryData.bestPrompts || [];\n        const otherSources = summaryData.otherSources || {};\n        \n        let bestPromptsHtml = '';\n        if (bestPrompts.length > 0) {\n          bestPromptsHtml = '<div style=\"margin-top: 16px; padding: 16px; background: rgba(255,255,255,0.15); border-radius: 8px; backdrop-filter: blur(10px);\">';\n          bestPromptsHtml += '<h4 style=\"margin: 0 0 12px 0; font-size: 16px; font-weight: 700; color: white;\">\uD83C\uDFC6 Beste Prompts:</h4>';\n          bestPromptsHtml += '<ul style=\"margin: 0; padding-left: 20px; list-style: none;\">';\n          bestPrompts.forEach(function(prompt, idx) {\n            bestPromptsHtml += '<li style=\"margin-bottom: 8px; padding: 8px 12px; background: rgba(255,255,255,0.1); border-radius: 6px; border-left: 3px solid white;\">';\n            bestPromptsHtml += '<span style=\"font-weight: 600; margin-right: 8px;\">' + (idx + 1) + '.</span>';\n            bestPromptsHtml += '<span>' + prompt.question.replace(/</g, '&lt;').replace(/>/g, '&gt;') + '</span>';\n            bestPromptsHtml += '<div style=\"margin-top: 4px; font-size: 12px; opacity: 0.9;\">Erw\u00E4hnungen: ' + prompt.mentions + ', Zitierungen: ' + prompt.citations + '</div>';\n            bestPromptsHtml += '</li>';\n          });\n          bestPromptsHtml += '</ul></div>';\n        }\n        \n        let otherSourcesHtml = '';\n        const sourceEntries = Object.entries(otherSources);\n        if (sourceEntries.length > 0) {\n          otherSourcesHtml = '<div style=\"margin-top: 16px; padding: 16px; background: rgba(255,255,255,0.15); border-radius: 8px; backdrop-filter: blur(10px);\">';\n          otherSourcesHtml += '<h4 style=\"margin: 0 0 12px 0; font-size: 16px; font-weight: 700; color: white;\">\uD83D\uDCDA Andere Quellen:</h4>';\n          otherSourcesHtml += '<div style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 8px;\">';\n          sourceEntries.forEach(function([source, count]) {\n            otherSourcesHtml += '<div style=\"padding: 10px; background: rgba(255,255,255,0.1); border-radius: 6px; text-align: center;\">';\n            otherSourcesHtml += '<div style=\"font-size: 24px; font-weight: 700; margin-bottom: 4px;\">' + count + '</div>';\n            otherSourcesHtml += '<div style=\"font-size: 12px; opacity: 0.9; word-break: break-word;\">' + source.replace(/</g, '&lt;').replace(/>/g, '&gt;') + '</div>';\n            otherSourcesHtml += '</div>';\n          });\n          otherSourcesHtml += '</div></div>';\n        }\n        \n        summaryDiv.innerHTML = \n          '<div style=\"display: flex; align-items: center; gap: 12px; margin-bottom: 20px;\">' +\n          '<span style=\"font-size: 32px;\">\uD83D\uDCCA</span>' +\n          '<h3 style=\"margin: 0; font-size: 24px; font-weight: 700; color: white;\">Fazit</h3>' +\n          '</div>' +\n          '<div style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 20px;\">' +\n          '<div style=\"padding: 16px; background: rgba(255,255,255,0.15); border-radius: 8px; backdrop-filter: blur(10px); text-align: center;\">' +\n          '<div style=\"font-size: 32px; font-weight: 700; margin-bottom: 8px;\">' + totalMentions + '</div>' +\n          '<div style=\"font-size: 14px; opacity: 0.9;\">Anzahl Erw\u00E4hnungen</div>' +\n          '</div>' +\n          '<div style=\"padding: 16px; background: rgba(255,255,255,0.15); border-radius: 8px; backdrop-filter: blur(10px); text-align: center;\">' +\n          '<div style=\"font-size: 32px; font-weight: 700; margin-bottom: 8px;\">' + totalCitations + '</div>' +\n          '<div style=\"font-size: 14px; opacity: 0.9;\">Anzahl Zitierungen</div>' +\n          '</div>' +\n          '</div>' +\n          bestPromptsHtml +\n          otherSourcesHtml;\n        \n        // Check if responsesList still exists before appending\n        if (responsesList) {\n          responsesList.appendChild(summaryDiv);\n          summaryDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });\n        } else {\n          console.error('\u274C responsesList element not found when trying to append summary');\n        }\n        \n        if (statusEl) {\n          statusEl.textContent = '\u2705 Fazit generiert';\n          statusEl.style.color = '#059669';\n        }\n        if (statusDetailsEl) {\n          statusDetailsEl.textContent = 'Alle Analysen abgeschlossen';\n        }\n      } catch (error) {\n        console.error('Error generating summary:', error);\n        const loadingEl = document.getElementById('summaryLoading');\n        if (loadingEl) loadingEl.remove();\n        \n        const errorDiv = document.createElement('div');\n        errorDiv.style.cssText = 'padding: 16px; background: #ffebee; border: 1px solid #f44336; border-radius: 8px; margin-top: 24px;';\n        errorDiv.innerHTML = \n          '<div style=\"display: flex; align-items: center; gap: 8px; margin-bottom: 8px;\">' +\n          '<span style=\"font-size: 20px;\">\u274C</span>' +\n          '<strong style=\"color: #c62828;\">Fehler beim Generieren des Fazits:</strong>' +\n          '</div>' +\n          '<small style=\"color: #d32f2f;\">' + (error.message || 'Unbekannter Fehler') + '</small>';\n        const responsesList = document.getElementById('responsesList');\n        if (responsesList) responsesList.appendChild(errorDiv);\n      }\n    }\n\n    const analyzeForm = document.getElementById('analyzeForm');\n    if (!analyzeForm) {\n      console.error('\u274C Form element not found!');\n      alert('Fehler: Formular nicht gefunden. Bitte Seite neu laden.');\n      return;\n    }\n    \n    console.log('\u2705 Form found, adding event listeners...');\n    \n    // Handle button click - PRIMARY METHOD\n    const startBtn = document.getElementById('startAnalysisBtn');\n    if (!startBtn) {\n      console.error('\u274C Start button not found!');\n      alert('Fehler: Start-Button nicht gefunden. Bitte Seite neu laden.');\n      return;\n    }\n    \n    console.log('\u2705 Start button found, attaching click handler...');\n    \n    // Override the inline onclick with our full handler\n    startBtn.onclick = async function(e) {\n      console.log('\uD83D\uDD35 Button clicked via onclick handler!');\n      if (e) {\n        e.preventDefault();\n        e.stopPropagation();\n      }\n      \n      try {\n        // Visual feedback immediately\n        startBtn.disabled = true;\n        const originalText = startBtn.textContent;\n        startBtn.textContent = 'Starte Analyse...';\n        startBtn.style.opacity = '0.7';\n        startBtn.style.cursor = 'not-allowed';\n        \n        console.log('\uD83D\uDD35 Calling handleFormSubmit...');\n        await handleFormSubmit();\n        \n        // Re-enable button after completion\n        startBtn.disabled = false;\n        startBtn.textContent = originalText;\n        startBtn.style.opacity = '1';\n        startBtn.style.cursor = 'pointer';\n      } catch (error) {\n        console.error('\u274C Error in button click handler:', error);\n        alert('Fehler beim Starten der Analyse: ' + (error.message || error));\n        \n        // Re-enable button on error\n        startBtn.disabled = false;\n        startBtn.textContent = 'Analyse starten';\n        startBtn.style.opacity = '1';\n        startBtn.style.cursor = 'pointer';\n      }\n    };\n    \n    console.log('\u2705 Button onclick handler attached');\n    \n    // Prevent form submission on Enter key in input fields\n    const formInputs = analyzeForm.querySelectorAll('input, select');\n    formInputs.forEach(input => {\n      input.addEventListener('keydown', (e) => {\n        if (e.key === 'Enter') {\n          e.preventDefault();\n          e.stopPropagation();\n          console.log('\uD83D\uDD35 Enter key pressed, triggering button click');\n          startBtn.click();\n        }\n      });\n    });\n    \n    // Also handle form submit (as fallback)\n    analyzeForm.addEventListener('submit', async function(e) {\n      e.preventDefault();\n      e.stopPropagation();\n      console.log('\uD83D\uDD35 Form submitted (fallback)!');\n      startBtn.click(); // Trigger button click instead\n    });\n    \n    // Prevent AI Readiness form from submitting to wrong handler\n    const aiReadinessForm = document.getElementById('aiReadinessForm');\n    if (aiReadinessForm) {\n      aiReadinessForm.addEventListener('submit', function(e) {\n        e.preventDefault();\n        e.stopPropagation();\n        console.log('\uD83D\uDD35 AI Readiness form submitted - preventing default');\n        // Call startAIReadiness if available\n        if (window.startAIReadiness) {\n          window.startAIReadiness();\n        }\n        return false;\n      });\n    }\n    \n    console.log('\u2705 All event listeners attached successfully');\n    \n    // Make functions available globally for startAnalysisNow\n    window.executeStep1 = executeStep1;\n    window.executeStep2 = executeStep2;\n    window.executeStep3 = executeStep3;\n    window.executeStep4 = executeStep4;\n    window.executeStep5 = executeStep5;\n\n    // Helper functions\n    function hideAllSections() {\n      const analysisSection = document.querySelector('.content-area > .card');\n      const analysesSection = document.getElementById('analysesSection');\n      const analysisDetailSection = document.getElementById('analysisDetailSection');\n      const aiReadinessSection = document.getElementById('aiReadinessSection');\n      if (analysisSection) analysisSection.style.display = 'none';\n      if (analysesSection) analysesSection.style.display = 'none';\n      if (analysisDetailSection) analysisDetailSection.style.display = 'none';\n      if (aiReadinessSection) aiReadinessSection.style.display = 'none';\n    }\n    \n    function updateNavActive(event) {\n      const navItems = document.querySelectorAll('.nav-item');\n      navItems.forEach(item => item.classList.remove('active'));\n      if (event && event.target) {\n        event.target.closest('.nav-item')?.classList.add('active');\n      }\n    }\n    \n    // Dashboard functionality\n    function showDashboard(event) {\n      hideAllSections();\n      const analysisSection = document.querySelector('.content-area > .card');\n      if (analysisSection) {\n        analysisSection.style.display = 'block';\n      }\n      updateNavActive(event);\n    }\n    \n    // Analyses functionality\n    function showAnalyses(event) {\n      hideAllSections();\n      const analysesSection = document.getElementById('analysesSection');\n      if (analysesSection) {\n        analysesSection.style.display = 'block';\n        loadAnalyses();\n      }\n      updateNavActive(event);\n    }\n    \n    // AI Readiness functionality\n    function showAIReadiness(event) {\n      hideAllSections();\n      const aiReadinessSection = document.getElementById('aiReadinessSection');\n      if (aiReadinessSection) {\n        aiReadinessSection.style.display = 'block';\n      }\n      updateNavActive(event);\n    }\n    \n    // Start AI Readiness Check\n    async function startAIReadiness() {\n      const urlInput = document.getElementById('aiReadinessUrl');\n      const url = urlInput?.value?.trim();\n      \n      if (!url) {\n        alert('Bitte geben Sie eine URL ein.');\n            return;\n          }\n          \n      // Validate URL\n      let websiteUrl = url;\n      const urlPattern = new RegExp('^https?:\\\\/\\\\/', 'i');\n      if (!urlPattern.test(websiteUrl)) {\n        websiteUrl = 'https://' + websiteUrl;\n      }\n      \n      try {\n        new URL(websiteUrl);\n      } catch (e) {\n        alert('Ung\u00FCltige URL. Bitte geben Sie eine g\u00FCltige URL ein.');\n        return;\n      }\n      \n      const loadingEl = document.getElementById('aiReadinessLoading');\n      const resultsEl = document.getElementById('aiReadinessResults');\n      const statusEl = document.getElementById('aiReadinessStatus');\n      const statusDetailsEl = document.getElementById('aiReadinessStatusDetails');\n      const progressEl = document.getElementById('aiReadinessProgress');\n      const progressTextEl = document.getElementById('aiReadinessProgressText');\n      const resultsContentEl = document.getElementById('aiReadinessResultsContent');\n      const consoleEl = document.getElementById('aiReadinessConsole');\n      const consoleContentEl = document.getElementById('aiReadinessConsoleContent');\n      \n      // Console logging function\n      const addConsoleLog = (message, type = 'info') => {\n        if (!consoleContentEl) return;\n        const timestamp = new Date().toLocaleTimeString('de-DE');\n        const colors = {\n          info: '#4fc3f7',\n          success: '#66bb6a',\n          warning: '#ffa726',\n          error: '#ef5350',\n          system: '#6a9955'\n        };\n        const icons = {\n          info: '\u2139\uFE0F',\n          success: '\u2705',\n          warning: '\u26A0\uFE0F',\n          error: '\u274C',\n          system: '\uD83D\uDD35'\n        };\n        const color = colors[type] || colors.info;\n        const icon = icons[type] || icons.info;\n        const logLine = document.createElement('div');\n        logLine.style.color = color;\n        logLine.style.marginBottom = '4px';\n        const timestampSpan = document.createElement('span');\n        timestampSpan.style.color = '#858585';\n        timestampSpan.textContent = '[' + timestamp + ']';\n        logLine.appendChild(timestampSpan);\n        logLine.appendChild(document.createTextNode(' ' + icon + ' ' + message));\n        consoleContentEl.appendChild(logLine);\n        consoleContentEl.scrollTop = consoleContentEl.scrollHeight;\n      };\n      \n      // Clear console function\n      const clearConsole = () => {\n        if (consoleContentEl) {\n          consoleContentEl.innerHTML = '<div style=\"color: #6a9955;\">[System] Console gel\u00F6scht.</div>';\n        }\n      };\n      \n      // Setup clear button\n      const clearBtn = document.getElementById('clearConsoleBtn');\n      if (clearBtn) {\n        clearBtn.onclick = clearConsole;\n      }\n      \n      if (loadingEl) {\n        loadingEl.style.display = 'block';\n        loadingEl.classList.add('show');\n      }\n      if (consoleEl) {\n        consoleEl.style.display = 'block';\n        clearConsole();\n        addConsoleLog('AI Readiness Analyse gestartet', 'system');\n        addConsoleLog('Ziel-URL: ' + websiteUrl, 'info');\n      }\n      if (resultsEl) resultsEl.style.display = 'none';\n      if (statusEl) statusEl.textContent = 'Vorbereitung...';\n      if (statusDetailsEl) statusDetailsEl.textContent = 'Starte AI Readiness Check...';\n      if (progressEl) progressEl.style.width = '0%';\n      if (progressTextEl) progressTextEl.textContent = '0%';\n      \n      try {\n        // Step 1: Start analysis\n        addConsoleLog('Starte Analyse-Request an Server...', 'info');\n        if (statusEl) statusEl.textContent = 'Schritt 1: robots.txt und Sitemap holen...';\n        if (statusDetailsEl) statusDetailsEl.textContent = 'Lade robots.txt und Sitemap...';\n        if (progressEl) progressEl.style.width = '20%';\n        if (progressTextEl) progressTextEl.textContent = '20%';\n        \n        const step1Response = await fetch('/api/ai-readiness/analyze', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({ websiteUrl })\n        });\n        \n        if (!step1Response.ok) {\n          addConsoleLog('Fehler beim Starten der Analyse', 'error');\n          throw new Error('Fehler beim Starten der Analyse');\n        }\n        \n        const step1Data = await step1Response.json();\n        addConsoleLog('Analyse gestartet. Run ID: ' + step1Data.runId, 'success');\n        addConsoleLog('Warte auf Hintergrund-Verarbeitung...', 'info');\n        \n        // Wait for completion (polling)\n        let attempts = 0;\n        const maxAttempts = 120; // 10 minutes max (120 * 5 seconds)\n        let recommendations = null;\n        let lastMessage = '';\n        \n        while (attempts < maxAttempts) {\n          await new Promise(resolve => setTimeout(resolve, 5000)); // Wait 5 seconds\n          \n          const statusResponse = await fetch('/api/ai-readiness/status/' + step1Data.runId);\n          if (statusResponse.ok) {\n            const statusData = await statusResponse.json();\n            \n            // Log status updates\n            if (statusData.message && statusData.message !== lastMessage) {\n              addConsoleLog(statusData.message, 'info');\n              lastMessage = statusData.message;\n              \n              // Parse step from message\n              if (statusData.message.includes('Schritt 1')) {\n                if (progressEl) progressEl.style.width = '15%';\n                if (progressTextEl) progressTextEl.textContent = '15%';\n                if (statusEl) statusEl.textContent = 'Schritt 1/6: robots.txt';\n              } else if (statusData.message.includes('Schritt 2')) {\n                if (progressEl) progressEl.style.width = '30%';\n                if (progressTextEl) progressTextEl.textContent = '30%';\n                if (statusEl) statusEl.textContent = 'Schritt 2/6: Sitemap';\n              } else if (statusData.message.includes('Schritt 3')) {\n                if (progressEl) progressEl.style.width = '45%';\n                if (progressTextEl) progressTextEl.textContent = '45%';\n                if (statusEl) statusEl.textContent = 'Schritt 3/6: Homepage';\n              } else if (statusData.message.includes('Schritt 4')) {\n                if (progressEl) progressEl.style.width = '60%';\n                if (progressTextEl) progressTextEl.textContent = '60%';\n                if (statusEl) statusEl.textContent = 'Schritt 4/6: Seiten scrapen';\n              } else if (statusData.message.includes('Schritt 5')) {\n                if (progressEl) progressEl.style.width = '75%';\n                if (progressTextEl) progressTextEl.textContent = '75%';\n                if (statusEl) statusEl.textContent = 'Schritt 5/6: Daten analysieren';\n              } else if (statusData.message.includes('Schritt 6')) {\n                if (progressEl) progressEl.style.width = '85%';\n                if (progressTextEl) progressTextEl.textContent = '85%';\n                if (statusEl) statusEl.textContent = 'Schritt 6/6: GPT-Analyse';\n              }\n            }\n            \n            if (statusData.status === 'completed') {\n              addConsoleLog('Analyse erfolgreich abgeschlossen!', 'success');\n              recommendations = statusData.recommendations;\n              break;\n            } else if (statusData.status === 'error') {\n              addConsoleLog('Fehler: ' + (statusData.error || 'Unbekannter Fehler'), 'error');\n              throw new Error(statusData.error || 'Fehler bei der Analyse');\n            }\n            \n            // Update progress\n            if (statusDetailsEl && statusData.message) {\n              statusDetailsEl.textContent = statusData.message;\n            }\n          } else {\n            addConsoleLog('Status-Abfrage fehlgeschlagen (Versuch ' + (attempts + 1) + '/' + maxAttempts + ')', 'warning');\n          }\n          \n          attempts++;\n        }\n        \n        if (!recommendations) {\n          addConsoleLog('Timeout: Die Analyse hat zu lange gedauert.', 'error');\n          throw new Error('Timeout: Die Analyse hat zu lange gedauert.');\n        }\n        \n        // Display results\n        addConsoleLog('Ergebnisse werden angezeigt...', 'success');\n        if (statusEl) statusEl.textContent = '\u2705 Analyse abgeschlossen';\n        if (statusDetailsEl) statusDetailsEl.textContent = 'AI Readiness Check erfolgreich durchgef\u00FChrt';\n        if (progressEl) progressEl.style.width = '100%';\n        if (progressTextEl) progressTextEl.textContent = '100%';\n        \n        if (resultsContentEl) {\n          resultsContentEl.innerHTML = \n            '<div style=\"white-space: pre-wrap; font-size: 14px; line-height: 1.7; color: #374151;\">' +\n            recommendations.replace(/</g, '&lt;').replace(/>/g, '&gt;') +\n            '</div>';\n        }\n        \n        if (resultsEl) resultsEl.style.display = 'block';\n        \n      } catch (error) {\n        console.error('Error in AI Readiness check:', error);\n        addConsoleLog('Fehler: ' + (error instanceof Error ? error.message : 'Unbekannter Fehler'), 'error');\n        if (statusEl) statusEl.textContent = '\u274C Fehler';\n        if (statusDetailsEl) statusDetailsEl.textContent = error instanceof Error ? error.message : 'Unbekannter Fehler';\n        alert('Fehler beim AI Readiness Check: ' + (error instanceof Error ? error.message : 'Unbekannter Fehler'));\n      } finally {\n        if (loadingEl) {\n          setTimeout(() => {\n            loadingEl.style.display = 'none';\n            loadingEl.classList.remove('show');\n          }, 2000);\n        }\n      }\n    }\n    \n    function loadAnalyses() {\n      const analysesList = document.getElementById('analysesList');\n      if (!analysesList) return;\n      \n      analysesList.innerHTML = '<div style=\"text-align: center; padding: 40px; color: var(--gray-500);\">Lade Analysen...</div>';\n      \n      fetch('/api/analyses')\n        .then(res => res.json())\n        .then(analyses => {\n          if (analyses.length === 0) {\n            analysesList.innerHTML = '<div style=\"text-align: center; padding: 40px; color: var(--gray-500);\">Keine Analysen vorhanden. Starte eine neue Analyse.</div>';\n            return;\n          }\n          \n          analysesList.innerHTML = analyses.map(function(analysis) {\n            const createdAt = new Date(analysis.createdAt);\n            const statusBadge = analysis.status === 'completed' \n              ? '<span style=\"padding: 4px 12px; background: #059669; color: white; border-radius: 12px; font-size: 12px; font-weight: 600;\">Abgeschlossen</span>'\n              : analysis.status === 'running'\n              ? '<span style=\"padding: 4px 12px; background: #d97706; color: white; border-radius: 12px; font-size: 12px; font-weight: 600;\">L\u00E4uft</span>'\n              : '<span style=\"padding: 4px 12px; background: #cbd5e1; color: white; border-radius: 12px; font-size: 12px; font-weight: 600;\">' + analysis.status + '</span>';\n            \n            const runId = analysis.id || '';\n            return '<div style=\"padding: 20px; background: white; border: 1px solid var(--gray-200); border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); transition: all 0.2s;\">' +\n              '<div style=\"display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;\">' +\n                '<div style=\"flex: 1;\">' +\n                  '<h4 style=\"margin: 0 0 4px 0; font-size: 18px; font-weight: 600; color: var(--gray-900);\">' + (analysis.websiteUrl || 'Unbekannte URL') + '</h4>' +\n                  '<p style=\"margin: 0; font-size: 13px; color: var(--gray-500);\">' + createdAt.toLocaleString('de-DE') + '</p>' +\n                '</div>' +\n                statusBadge +\n              '</div>' +\n              '<div style=\"display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-top: 16px;\">' +\n                '<div>' +\n                  '<div style=\"font-size: 11px; color: var(--gray-500); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px;\">Land</div>' +\n                  '<div style=\"font-size: 14px; font-weight: 600; color: var(--gray-900);\">' + (analysis.country || '') + '</div>' +\n                '</div>' +\n                '<div>' +\n                  '<div style=\"font-size: 11px; color: var(--gray-500); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px;\">Sprache</div>' +\n                  '<div style=\"font-size: 14px; font-weight: 600; color: var(--gray-900);\">' + (analysis.language || '') + '</div>' +\n                '</div>' +\n                '<div>' +\n                  '<div style=\"font-size: 11px; color: var(--gray-500); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px;\">Region</div>' +\n                  '<div style=\"font-size: 14px; font-weight: 600; color: var(--gray-900);\">' + (analysis.region || '-') + '</div>' +\n                '</div>' +\n              '</div>' +\n              '<div style=\"margin-top: 16px; display: flex; gap: 8px;\">' +\n                '<button class=\"btn btn-primary\" data-run-id=\"' + String(runId).replace(/\"/g, '&quot;').replace(/'/g, '&#39;') + '\" onclick=\"viewAnalysisDetails(this.dataset.runId)\" style=\"flex: 1; padding: 8px 16px; font-size: 13px;\">' +\n                  '\uD83D\uDCCA Details anzeigen' +\n                '</button>' +\n                (analysis.status === 'running' \n                  ? '<button class=\"btn\" data-run-id=\"' + String(runId).replace(/\"/g, '&quot;').replace(/'/g, '&#39;') + '\" onclick=\"pauseAnalysis(this.dataset.runId)\" style=\"padding: 8px 16px; font-size: 13px; background: var(--warning); color: white;\">\u23F8 Pausieren</button>'\n                  : '') +\n                '<button class=\"btn\" data-run-id=\"' + String(runId).replace(/\"/g, '&quot;').replace(/'/g, '&#39;') + '\" onclick=\"deleteAnalysis(this.dataset.runId)\" style=\"padding: 8px 16px; font-size: 13px; background: var(--error); color: white;\">\uD83D\uDDD1 L\u00F6schen</button>' +\n              '</div>' +\n            '</div>';\n          }).join('');\n        })\n        .catch(err => {\n          console.error('Error loading analyses:', err);\n          analysesList.innerHTML = '<div style=\"text-align: center; padding: 40px; color: #dc2626;\">Fehler beim Laden der Analysen.</div>';\n        });\n    }\n    \n    function viewAnalysisDetails(runId) {\n      console.log('\uD83D\uDD0D Loading analysis details for runId:', runId);\n      hideAllSections();\n      const analysisDetailSection = document.getElementById('analysisDetailSection');\n      const analysisDetailContent = document.getElementById('analysisDetailContent');\n      const analysisDetailTitle = document.getElementById('analysisDetailTitle');\n      \n      if (!analysisDetailSection || !analysisDetailContent) {\n        console.error('\u274C Analysis detail elements not found!');\n        return;\n      }\n      \n      analysisDetailSection.style.display = 'block';\n      analysisDetailContent.innerHTML = \n        '<div style=\"text-align: center; padding: 40px; color: var(--gray-500);\">' +\n        '<div style=\"display: inline-block; width: 40px; height: 40px; border: 4px solid var(--gray-200); border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 16px;\"></div>' +\n        '<p style=\"margin-top: 16px; font-size: 14px;\">Lade Analyse-Insights...</p>' +\n        '<p style=\"margin-top: 8px; font-size: 12px; color: var(--gray-400);\">Dies kann einige Sekunden dauern</p>' +\n        '</div>';\n      \n      // Add spinner animation if not already present\n      if (!document.getElementById('spinnerStyle')) {\n        const style = document.createElement('style');\n        style.id = 'spinnerStyle';\n        style.textContent = '@keyframes spin { to { transform: rotate(360deg); } }';\n        document.head.appendChild(style);\n      }\n      \n      // Fetch insights instead of full analysis\n      const startTime = Date.now();\n      const controller = new AbortController();\n      const timeoutId = setTimeout(() => controller.abort(), 30000); // 30 second timeout\n      \n      fetch('/api/analysis/' + runId + '/insights', {\n        signal: controller.signal\n      })\n        .then(res => {\n          if (!res.ok) {\n            return res.text().then(text => {\n              throw new Error('HTTP ' + res.status + ': ' + text.substring(0, 200));\n            });\n          }\n          return res.json();\n        })\n        .then(insights => {\n          clearTimeout(timeoutId);\n          const loadTime = ((Date.now() - startTime) / 1000).toFixed(2);\n          console.log('\u2705 Insights loaded in', loadTime, 'seconds');\n          \n          if (insights.error) {\n            console.error('\u274C API returned error:', insights.error);\n            analysisDetailContent.innerHTML = '<div style=\"color: #dc2626; padding: 20px;\">Fehler: ' + insights.error + '</div>';\n            return;\n          }\n          \n          // Validate that insights has required structure\n          if (!insights || !insights.summary) {\n            console.error('\u274C Invalid insights data structure:', insights);\n            analysisDetailContent.innerHTML = '<div style=\"color: #dc2626; padding: 20px; background: #ffebee; border-radius: 8px; border-left: 4px solid #f44336;\">' +\n              '<strong>\u274C Fehler beim Laden der Insights</strong><br>' +\n              '<p style=\"margin-top: 8px; color: #c62828;\">Ung\u00FCltige Datenstruktur erhalten. Bitte versuche es erneut.</p>' +\n              '<p style=\"margin-top: 12px; font-size: 12px; color: #666;\">Empfangen: ' + JSON.stringify(insights).substring(0, 200) + '</p>' +\n              '</div>';\n            return;\n          }\n          \n          // Ensure all required fields exist with defaults\n          if (!insights.summary) {\n            insights.summary = { totalBrandMentions: 0, totalBrandCitations: 0, promptsWithMentions: 0, totalPrompts: 0 };\n          }\n          if (!insights.promptsWithMentions) {\n            insights.promptsWithMentions = [];\n          }\n          if (!insights.allCompetitors) {\n            insights.allCompetitors = [];\n          }\n          if (!insights.detailedData) {\n            insights.detailedData = [];\n          }\n          \n          console.log('\uD83D\uDCCA Insights data:', {\n            totalBrandMentions: insights.summary.totalBrandMentions,\n            totalBrandCitations: insights.summary.totalBrandCitations,\n            promptsWithMentions: insights.summary.promptsWithMentions,\n            totalPrompts: insights.summary.totalPrompts\n          });\n          \n          // Build insights dashboard - Professional design\n          let html = '<div style=\"margin-bottom: 40px; padding-bottom: 24px; border-bottom: 1px solid #e5e7eb;\">';\n          html += '<h2 style=\"margin: 0 0 8px 0; color: #111827; font-size: 28px; font-weight: 600; letter-spacing: -0.5px;\">Analyse-Ergebnisse</h2>';\n          html += '<div style=\"display: flex; gap: 24px; margin-top: 12px; font-size: 14px; color: #6b7280;\">';\n          html += '<span style=\"display: flex; align-items: center; gap: 6px;\"><span style=\"width: 8px; height: 8px; background: #3b82f6; border-radius: 50%;\"></span> ' + (insights.websiteUrl || '') + '</span>';\n          if (insights.brandName) {\n            html += '<span style=\"display: flex; align-items: center; gap: 6px;\"><span style=\"width: 8px; height: 8px; background: #10b981; border-radius: 50%;\"></span> ' + insights.brandName + '</span>';\n          }\n          html += '</div>';\n          html += '</div>';\n          \n          // Summary Metrics Cards - Clean, professional design\n          html += '<div style=\"display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-bottom: 48px;\">';\n          html += '<div style=\"padding: 28px; background: #ffffff; border: 1px solid #e5e7eb; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); transition: all 0.2s;\">';\n          html += '<div style=\"font-size: 13px; font-weight: 500; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 12px;\">Markenerw\u00E4hnungen</div>';\n          html += '<div style=\"font-size: 42px; font-weight: 700; color: #111827; margin-bottom: 4px; line-height: 1;\">' + (insights.summary?.totalBrandMentions || 0) + '</div>';\n          html += '<div style=\"font-size: 13px; color: #9ca3af; margin-top: 8px;\">Gesamtanzahl</div>';\n          html += '</div>';\n          \n          html += '<div style=\"padding: 28px; background: #ffffff; border: 1px solid #e5e7eb; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); transition: all 0.2s;\">';\n          html += '<div style=\"font-size: 13px; font-weight: 500; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 12px;\">Zitationen</div>';\n          html += '<div style=\"font-size: 42px; font-weight: 700; color: #111827; margin-bottom: 4px; line-height: 1;\">' + (insights.summary?.totalBrandCitations || 0) + '</div>';\n          html += '<div style=\"font-size: 13px; color: #9ca3af; margin-top: 8px;\">Von dieser Marke</div>';\n          html += '</div>';\n          \n          html += '<div style=\"padding: 28px; background: #ffffff; border: 1px solid #e5e7eb; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); transition: all 0.2s;\">';\n          html += '<div style=\"font-size: 13px; font-weight: 500; color: #6b7280; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 12px;\">Erfolgreiche Prompts</div>';\n          html += '<div style=\"font-size: 42px; font-weight: 700; color: #111827; margin-bottom: 4px; line-height: 1;\">' + (insights.summary?.promptsWithMentions || 0) + '</div>';\n          html += '<div style=\"font-size: 13px; color: #9ca3af; margin-top: 8px;\">von ' + (insights.summary?.totalPrompts || 0) + ' analysiert</div>';\n          html += '</div>';\n          html += '</div>';\n          \n          // Prompts where brand is mentioned - Professional design\n          if (insights.promptsWithMentions && insights.promptsWithMentions.length > 0) {\n            html += '<div style=\"margin-bottom: 48px;\">';\n            html += '<h3 style=\"margin: 0 0 24px 0; color: #111827; font-size: 20px; font-weight: 600; letter-spacing: -0.3px;\">Prompts mit Markenerw\u00E4hnungen</h3>';\n            html += '<div style=\"display: grid; gap: 16px;\">';\n            insights.promptsWithMentions.forEach(function(prompt) {\n              html += '<div style=\"padding: 20px; background: #ffffff; border: 1px solid #e5e7eb; border-radius: 10px; box-shadow: 0 1px 2px rgba(0,0,0,0.05);\">';\n              html += '<div style=\"font-weight: 500; color: #111827; margin-bottom: 12px; font-size: 15px; line-height: 1.5;\">' + (prompt?.question || 'Unbekannte Frage').replace(/</g, '&lt;').replace(/>/g, '&gt;') + '</div>';\n              html += '<div style=\"display: flex; gap: 24px; font-size: 13px; color: #6b7280; padding-top: 12px; border-top: 1px solid #f3f4f6;\">';\n              html += '<span style=\"display: flex; align-items: center; gap: 6px;\"><span style=\"color: #3b82f6; font-weight: 600;\">' + (prompt?.mentionCount || 0) + '</span> Erw\u00E4hnungen</span>';\n              html += '<span style=\"display: flex; align-items: center; gap: 6px;\"><span style=\"color: #10b981; font-weight: 600;\">' + (prompt?.citationCount || 0) + '</span> Zitationen</span>';\n              html += '</div>';\n              html += '</div>';\n            });\n            html += '</div></div>';\n          }\n          \n          // Competitors section removed as requested\n          \n          // Detailed data (collapsible) - Professional design\n          html += '<div style=\"margin-bottom: 32px;\">';\n          html += '<details style=\"cursor: pointer;\">';\n          html += '<summary style=\"padding: 18px 20px; background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 10px; font-weight: 500; color: #111827; font-size: 15px; user-select: none; transition: background 0.2s;\">Detaillierte Analyse-Ergebnisse</summary>';\n          html += '<div style=\"display: grid; gap: 20px; margin-top: 20px;\">';\n          (insights.detailedData || []).forEach(function(data) {\n            html += '<div style=\"padding: 24px; background: #ffffff; border: 1px solid #e5e7eb; border-radius: 10px; box-shadow: 0 1px 2px rgba(0,0,0,0.05);\">';\n            html += '<div style=\"font-weight: 500; color: #111827; margin-bottom: 16px; font-size: 16px; line-height: 1.5;\">' + (data?.question || 'Unbekannte Frage').replace(/</g, '&lt;').replace(/>/g, '&gt;') + '</div>';\n            if (data?.answer) {\n              const answerText = String(data.answer || '');\n              html += '<div style=\"padding: 16px; background: #f9fafb; border: 1px solid #e5e7eb; border-radius: 8px; margin-bottom: 16px; font-size: 14px; color: #374151; line-height: 1.7;\">';\n              html += answerText.substring(0, 400).replace(/</g, '&lt;').replace(/>/g, '&gt;') + (answerText.length > 400 ? '...' : '');\n              html += '</div>';\n            }\n            html += '<div style=\"display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; padding-top: 16px; border-top: 1px solid #f3f4f6;\">';\n            html += '<div style=\"font-size: 13px;\"><span style=\"color: #6b7280; display: block; margin-bottom: 4px;\">Erw\u00E4hnungen</span><span style=\"color: #111827; font-weight: 600; font-size: 18px;\">' + (data?.brandMentions?.total || 0) + '</span></div>';\n            html += '<div style=\"font-size: 13px;\"><span style=\"color: #6b7280; display: block; margin-bottom: 4px;\">Zitate (Marke)</span><span style=\"color: #111827; font-weight: 600; font-size: 18px;\">' + (data?.citations?.brandCitations || 0) + '</span></div>';\n            html += '<div style=\"font-size: 13px;\"><span style=\"color: #6b7280; display: block; margin-bottom: 4px;\">Zitate (gesamt)</span><span style=\"color: #111827; font-weight: 600; font-size: 18px;\">' + (data?.citations?.total || 0) + '</span></div>';\n            html += '</div>';\n            html += '</div>';\n          });\n          html += '</div></details></div>';\n          \n          analysisDetailContent.innerHTML = html;\n          console.log('\u2705 Analysis details rendered successfully');\n        })\n        .catch(err => {\n          clearTimeout(timeoutId);\n          const loadTime = ((Date.now() - startTime) / 1000).toFixed(2);\n          console.error('\u274C Error loading analysis insights after', loadTime, 'seconds:', err);\n          \n          let errorMessage = 'Unbekannter Fehler';\n          if (err.name === 'AbortError') {\n            errorMessage = 'Zeit\u00FCberschreitung: Die Anfrage hat zu lange gedauert (>30 Sekunden). Bitte versuche es erneut.';\n          } else if (err && err.message) {\n            errorMessage = err.message;\n          }\n          analysisDetailContent.innerHTML = \n            '<div style=\"color: #dc2626; padding: 20px; background: #ffebee; border-radius: 8px; border-left: 4px solid #f44336;\">' +\n            '<strong>\u274C Fehler beim Laden der Analyse-Insights</strong><br>' +\n            '<p style=\"margin-top: 8px; color: #c62828;\">' + errorMessage + '</p>' +\n            '<p style=\"margin-top: 12px; font-size: 12px; color: #666;\">Bitte \u00FCberpr\u00FCfe die Browser-Konsole f\u00FCr weitere Details oder versuche es sp\u00E4ter erneut.</p>' +\n            '<button data-run-id=\"' + String(runId).replace(/\"/g, '&quot;').replace(/'/g, '&#39;') + '\" onclick=\"viewAnalysisDetails(this.dataset.runId)\" class=\"btn\" style=\"margin-top: 12px; padding: 8px 16px; background: var(--primary); color: white; border: none; border-radius: 6px; cursor: pointer;\">\uD83D\uDD04 Erneut versuchen</button>' +\n            '</div>';\n        });\n    }\n    \n    function deleteAnalysis(runId) {\n      if (!confirm('M\u00F6chtest du diese Analyse wirklich l\u00F6schen? Diese Aktion kann nicht r\u00FCckg\u00E4ngig gemacht werden.')) {\n        return;\n      }\n      \n      fetch('/api/analysis/' + runId, {\n        method: 'DELETE',\n        headers: { 'Content-Type': 'application/json' }\n      })\n        .then(res => res.json())\n        .then(data => {\n          if (data.success) {\n            alert('Analyse erfolgreich gel\u00F6scht!');\n            loadAnalyses(); // Reload the list\n          } else {\n            alert('Fehler beim L\u00F6schen: ' + (data.error || 'Unbekannter Fehler'));\n          }\n        })\n        .catch(err => {\n          console.error('Error deleting analysis:', err);\n          alert('Fehler beim L\u00F6schen der Analyse.');\n        });\n    }\n    \n    function pauseAnalysis(runId) {\n      if (!confirm('M\u00F6chtest du diese Analyse pausieren?')) {\n            return;\n          }\n          \n      fetch('/api/analysis/' + runId + '/pause', {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' }\n          })\n            .then(res => res.json())\n        .then(data => {\n          if (data.success) {\n            alert('Analyse erfolgreich pausiert!');\n            loadAnalyses(); // Reload the list\n          } else {\n            alert('Fehler beim Pausieren: ' + (data.error || 'Unbekannter Fehler'));\n          }\n        })\n        .catch(err => {\n          console.error('Error pausing analysis:', err);\n          alert('Fehler beim Pausieren der Analyse.');\n        });\n    }\n    \n    // Store full implementations for use by global stubs\n    window.showDashboardFull = showDashboard;\n    window.showAnalysesFull = showAnalyses;\n    window.showAIReadinessFull = showAIReadiness;\n    window.startAIReadinessFull = startAIReadiness;\n    window.loadAnalyses = loadAnalyses;\n    window.viewAnalysisDetailsFull = viewAnalysisDetails;\n    window.deleteAnalysisFull = deleteAnalysis;\n    window.pauseAnalysisFull = pauseAnalysis;\n    \n    // Update global functions to use full implementations\n    // Note: window.startAIReadiness is already defined in <head> script, don't override it\n    window.showDashboard = showDashboard;\n    window.showAnalyses = showAnalyses;\n    window.showAIReadiness = showAIReadiness;\n    window.viewAnalysisDetails = viewAnalysisDetails;\n    window.deleteAnalysis = deleteAnalysis;\n    window.pauseAnalysis = pauseAnalysis;\n    }); // End of DOMContentLoaded\n  </script>\n</body>\n</html>`;\n\n        return new Response(html, {\n          headers: {\n            \"Content-Type\": \"text/html; charset=utf-8\",\n            ...corsHeaders,\n          },\n        });\n      }\n\n      return new Response(\n        JSON.stringify({\n          error: \"Not Found\",\n          message: \"The requested endpoint does not exist\",\n          availableEndpoints: [\n            \"GET /\",\n            \"POST /api/analyze\",\n            \"POST /api/test/analyze\",\n            \"POST /api/chat\",\n            \"GET /api/analysis/:runId\",\n            \"GET /api/analysis/:runId/metrics\",\n            \"GET /api/health\",\n          ],\n        }),\n        {\n          status: 404,\n          headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n        }\n      );\n    } catch (error) {\n      console.error(\"API error:\", error);\n      return new Response(\n        JSON.stringify({\n          error: \"Internal Server Error\",\n          message: error instanceof Error ? error.message : \"Unknown error\",\n        }),\n        {\n          status: 500,\n          headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n        }\n      );\n    }\n  }\n\n  private async handleFetchUrl(\n    request: Request,\n    env: Env,\n    corsHeaders: Record<string, string>\n  ): Promise<Response> {\n    const body = await request.json();\n    const { url } = body;\n\n    try {\n      const response = await fetch(url, {\n        headers: { \"User-Agent\": \"GEO-Platform/1.0\" },\n        signal: AbortSignal.timeout(10000),\n      });\n\n      if (response.ok) {\n        const html = await response.text();\n        // Extract text content\n        let text = html.replace(/<script[^>]*>[\\s\\S]*?<\\/script>/gi, \"\");\n        text = text.replace(/<style[^>]*>[\\s\\S]*?<\\/style>/gi, \"\");\n        text = text.replace(/<[^>]+>/g, \" \");\n        text = text.replace(/\\s+/g, \" \").trim();\n        \n        return new Response(JSON.stringify({ content: text.substring(0, 2000) }), {\n          headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n        });\n      } else {\n        return new Response(JSON.stringify({ content: null, error: \"Failed to fetch\" }), {\n          headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n        });\n      }\n    } catch (error) {\n      return new Response(JSON.stringify({ content: null, error: error instanceof Error ? error.message : \"Unknown error\" }), {\n        headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n      });\n    }\n  }\n\n  private async handleExecutePrompt(\n    request: Request,\n    env: Env,\n    corsHeaders: Record<string, string>\n  ): Promise<Response> {\n    const body = await request.json();\n    const { runId, prompt, userInput } = body;\n\n    try {\n      const { LLMExecutor } = await import(\"../llm_execution/index.js\");\n      const { getConfig } = await import(\"../config.js\");\n      const config = getConfig(env);\n      const executor = new LLMExecutor(config);\n      \n      // Execute prompt with GPT-5 Web Search\n      const response = await executor.executePrompt(prompt);\n      \n      // Extract brand name from website URL\n      const websiteUrl = userInput?.websiteUrl || '';\n      const brandName = this.extractBrandName(websiteUrl);\n      \n      // Perform analysis: Brand mentions, Citations, Competitors, Sentiment\n      const { AnalysisEngine } = await import(\"../analysis/index.js\");\n      const analysisEngine = new AnalysisEngine(brandName, 0.7);\n      const analysis = analysisEngine.analyzeResponses([prompt], [response])[0];\n      \n      // Save prompt, response, and analysis immediately (with timestamps)\n      const { Database } = await import(\"../persistence/index.js\");\n      const db = new Database(env.geo_db as any);\n      \n      // Ensure prompt is saved (if runId is provided)\n      // Use INSERT OR REPLACE to avoid duplicate key errors\n      if (runId) {\n        try {\n          await db.savePrompts(runId, [prompt]);\n        } catch (error: any) {\n          // If it's a unique constraint error, the prompt already exists - that's okay\n          if (!error.message?.includes(\"UNIQUE constraint\")) {\n            console.warn(\"Error saving prompt (may already exist):\", error.message);\n          }\n        }\n      }\n      \n      // Save response (with timestamp)\n      await db.saveLLMResponses([response]);\n      \n      // Save analysis immediately (with structured answers)\n      await db.savePromptAnalyses([analysis]);\n      \n      console.log(`\u2705 Saved question, answer, and analysis for prompt ${prompt.id} at ${new Date().toISOString()}`);\n      \n      // Return response with structured analysis\n      // Structured answers to the three key questions:\n      return new Response(JSON.stringify({ \n        response,\n        analysis: {\n          // Original analysis fields\n          brandMentions: analysis.brandMentions,\n          citations: response.citations || [], // Use citations directly from GPT-5 Web Search response\n          competitors: analysis.competitors,\n          sentiment: analysis.sentiment,\n          citationCount: response.citations?.length || 0,\n          citationUrls: response.citations?.map((c: any) => c.url) || [],\n          brandCitations: analysis.brandCitations || [],\n          \n          // Structured answers to the three key questions:\n          // 1. Bin ich erw\u00E4hnt? Wenn ja, wie viel?\n          isMentioned: analysis.isMentioned,\n          mentionCount: analysis.mentionCount,\n          \n          // 2. Werde ich zitiert? Wenn ja, wo und was?\n          isCited: analysis.isCited,\n          citationDetails: analysis.citationDetails,\n          \n          // 3. Welche anderen Unternehmen werden genannt und wo?\n          competitorDetails: analysis.competitorDetails,\n        }\n      }), {\n        headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n      });\n    } catch (error) {\n      console.error('Error in handleExecutePrompt:', error);\n      return new Response(JSON.stringify({ \n        error: error instanceof Error ? error.message : \"Unknown error\",\n        details: error instanceof Error ? error.stack : undefined\n      }), {\n        status: 500,\n        headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n      });\n    }\n  }\n  \n  private async handleGenerateSummary(\n    request: Request,\n    env: Env,\n    corsHeaders: Record<string, string>\n  ): Promise<Response> {\n    const body = await request.json();\n    const { runId, questionsAndAnswers, userInput } = body;\n\n    try {\n      // Extract brand name from website URL\n      const websiteUrl = userInput?.websiteUrl || '';\n      const brandName = this.extractBrandName(websiteUrl);\n      \n      // Calculate totals\n      let totalMentions = 0;\n      let totalCitations = 0;\n      const promptScores: Array<{ question: string; mentions: number; citations: number; score: number }> = [];\n      const sourceCounts: Record<string, number> = {};\n      \n      questionsAndAnswers.forEach((qa: any) => {\n        const mentions = (qa.brandMentions?.exact || 0) + (qa.brandMentions?.fuzzy || 0);\n        const citations = qa.citations?.length || 0;\n        \n        totalMentions += mentions;\n        totalCitations += citations;\n        \n        // Score = mentions * 2 + citations (weighted)\n        const score = mentions * 2 + citations;\n        promptScores.push({\n          question: qa.question,\n          mentions: mentions,\n          citations: citations,\n          score: score\n        });\n        \n        // Count sources\n        if (qa.citations && Array.isArray(qa.citations)) {\n          qa.citations.forEach((citation: any) => {\n            if (citation.url) {\n              try {\n                const url = new URL(citation.url);\n                const hostname = url.hostname.replace(/^www\\./, '');\n                sourceCounts[hostname] = (sourceCounts[hostname] || 0) + 1;\n              } catch (e) {\n                // Invalid URL, skip\n              }\n            }\n          });\n        }\n      });\n      \n      // Sort prompts by score (best first)\n      promptScores.sort((a, b) => b.score - a.score);\n      const bestPrompts = promptScores.slice(0, 5).map(p => ({\n        question: p.question,\n        mentions: p.mentions,\n        citations: p.citations\n      }));\n      \n      // Prepare summary prompt for GPT\n      const summaryPrompt = `Du bist ein Experte f\u00FCr Markenanalyse. Analysiere die folgenden Fragen und Antworten und erstelle ein pr\u00E4zises Fazit.\n\nMarke: ${brandName}\nWebsite: ${websiteUrl}\n\nFragen und Antworten:\n${questionsAndAnswers.map((qa: any, idx: number) => \n  `${idx + 1}. Frage: ${qa.question}\\n   Antwort: ${qa.answer.substring(0, 500)}${qa.answer.length > 500 ? '...' : ''}\\n   Erw\u00E4hnungen: ${(qa.brandMentions?.exact || 0) + (qa.brandMentions?.fuzzy || 0)}, Zitierungen: ${qa.citations?.length || 0}`\n).join('\\n\\n')}\n\nBitte erstelle ein strukturiertes Fazit im JSON-Format mit folgenden Feldern:\n{\n  \"totalMentions\": ${totalMentions},\n  \"totalCitations\": ${totalCitations},\n  \"bestPrompts\": [${bestPrompts.map(p => JSON.stringify({ question: p.question, mentions: p.mentions, citations: p.citations })).join(', ')}],\n  \"otherSources\": ${JSON.stringify(sourceCounts)},\n  \"summary\": \"Eine kurze Zusammenfassung der wichtigsten Erkenntnisse\"\n}\n\nAntworte NUR mit dem JSON-Objekt, ohne zus\u00E4tzlichen Text.`;\n\n      // Call GPT to generate summary\n      const { LLMExecutor } = await import(\"../llm_execution/index.js\");\n      const { getConfig } = await import(\"../config.js\");\n      const config = getConfig(env);\n      const executor = new LLMExecutor(config);\n      \n      // Create a prompt object for GPT\n      const summaryPromptObj = {\n        id: `summary-${runId}`,\n        question: summaryPrompt,\n        category: \"summary\",\n        intent: \"high\" as const\n      };\n      \n      const gptResponse = await executor.executePrompt(summaryPromptObj);\n      const responseText = gptResponse.outputText || '';\n      \n      // Try to parse JSON from response\n      let summaryData: any = {\n        totalMentions: totalMentions,\n        totalCitations: totalCitations,\n        bestPrompts: bestPrompts,\n        otherSources: sourceCounts,\n        summary: responseText\n      };\n      \n      // Try to extract JSON from GPT response\n      try {\n        const jsonMatch = responseText.match(/\\{[\\s\\S]*\\}/);\n        if (jsonMatch) {\n          const parsed = JSON.parse(jsonMatch[0]);\n          summaryData = { ...summaryData, ...parsed };\n        }\n      } catch (e) {\n        // Use default summary data if JSON parsing fails\n        console.warn('Could not parse JSON from GPT response, using calculated values');\n      }\n      \n      return new Response(JSON.stringify(summaryData), {\n        headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n      });\n    } catch (error) {\n      console.error('Error in handleGenerateSummary:', error);\n      return new Response(JSON.stringify({ \n        error: error instanceof Error ? error.message : \"Unknown error\",\n        details: error instanceof Error ? error.stack : undefined\n      }), {\n        status: 500,\n        headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n      });\n    }\n  }\n  \n  private extractBrandName(websiteUrl: string): string {\n    try {\n      const url = new URL(websiteUrl);\n      const hostname = url.hostname.replace('www.', '');\n      const parts = hostname.split('.');\n      // Return the main domain name (e.g., \"example\" from \"example.com\")\n      return parts[0].charAt(0).toUpperCase() + parts[0].slice(1);\n    } catch {\n      return 'Company';\n    }\n  }\n\n  private async handleChat(\n    request: Request,\n    env: Env,\n    corsHeaders: Record<string, string>\n  ): Promise<Response> {\n    try {\n      console.log(\"\uD83D\uDCAC Chat endpoint called\");\n      console.log(\"\uD83D\uDCAC Request method:\", request.method);\n      console.log(\"\uD83D\uDCAC Request URL:\", request.url);\n      \n      let body;\n      try {\n        body = await request.json() as { question: string };\n      } catch (jsonError) {\n        console.error(\"\u274C Failed to parse request JSON:\", jsonError);\n        return new Response(\n          JSON.stringify({ error: \"Invalid JSON in request body\" }),\n          {\n            status: 400,\n            headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n          }\n        );\n      }\n      const { question } = body;\n\n      console.log(\"\uD83D\uDCAC Chat request received:\", question);\n\n      if (!question || question.trim().length === 0) {\n        return new Response(\n          JSON.stringify({ error: \"Question is required\" }),\n          {\n            status: 400,\n            headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n          }\n        );\n      }\n\n      // Check if API key is available\n      if (!env.OPENAI_API_KEY) {\n        console.error(\"\u274C OPENAI_API_KEY not found in environment\");\n        return new Response(\n          JSON.stringify({ error: \"OpenAI API key not configured\" }),\n          {\n            status: 500,\n            headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n          }\n        );\n      }\n\n      console.log(\"\uD83D\uDCE6 Importing modules...\");\n      const { LLMExecutor } = await import(\"../llm_execution/index.js\");\n      const { getConfig } = await import(\"../config.js\");\n      \n      console.log(\"\u2699\uFE0F Getting config...\");\n      const config = getConfig(env);\n      console.log(\"\u2705 Config received, model:\", config.openai.model);\n      \n      console.log(\"\uD83D\uDD27 Creating LLMExecutor...\");\n      const executor = new LLMExecutor(config);\n      \n      // Create a temporary prompt object for the chat question\n      const chatPrompt = {\n        id: `chat_${Date.now()}`,\n        categoryId: \"chat\",\n        question: question.trim(),\n        language: \"de\",\n        country: \"CH\",\n        intent: \"high\" as const,\n        createdAt: new Date().toISOString(),\n      };\n      \n      console.log(\"\uD83E\uDD16 Executing chat prompt with GPT-5 Web Search...\");\n      console.log(\"\uD83D\uDCCB Prompt:\", JSON.stringify(chatPrompt, null, 2));\n      \n      // Execute with GPT-5 Web Search\n      const response = await executor.executePrompt(chatPrompt);\n      \n      console.log(\"\u2705 Chat response received:\");\n      console.log(\"  - OutputText length:\", response.outputText?.length || 0);\n      console.log(\"  - Citations count:\", response.citations?.length || 0);\n      console.log(\"  - OutputText preview:\", response.outputText?.substring(0, 200) || \"EMPTY\");\n      \n      if (!response.outputText || response.outputText.trim().length === 0) {\n        console.warn(\"\u26A0\uFE0F Empty response from LLMExecutor!\");\n        return new Response(\n          JSON.stringify({\n            error: \"Keine Antwort von GPT-5 erhalten. Bitte versuche es erneut.\",\n            answer: \"\",\n            citations: response.citations || [],\n          }),\n          {\n            status: 200,\n            headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n          }\n        );\n      }\n      \n      return new Response(\n        JSON.stringify({\n          answer: response.outputText,\n          outputText: response.outputText, // Also include as outputText for compatibility\n          citations: response.citations || [],\n        }),\n        {\n          headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n        }\n      );\n    } catch (error) {\n      console.error(\"\u274C Error in chat handler:\", error);\n      const errorMessage = error instanceof Error ? error.message : \"Unknown error\";\n      const errorStack = error instanceof Error ? error.stack : undefined;\n      const errorName = error instanceof Error ? error.name : \"Error\";\n      \n      console.error(\"\u274C Error name:\", errorName);\n      console.error(\"\u274C Error message:\", errorMessage);\n      if (errorStack) {\n        console.error(\"\u274C Error stack:\", errorStack);\n      }\n      \n      // Log full error object for debugging\n      console.error(\"\u274C Full error object:\", JSON.stringify(error, Object.getOwnPropertyNames(error)));\n      \n      // Return user-friendly error message with details\n      return new Response(\n        JSON.stringify({\n          error: errorMessage,\n          errorName: errorName,\n          details: errorStack ? errorStack.split('\\n').slice(0, 5).join('\\n') : undefined, // First 5 lines of stack\n        }),\n        {\n          status: 500,\n          headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n        }\n      );\n    }\n  }\n\n  private async handleAnalyze(\n    request: Request,\n    env: Env,\n    corsHeaders: Record<string, string>\n  ): Promise<Response> {\n    const body = await request.json();\n    let websiteUrl = body.websiteUrl?.trim();\n    // Auto-add https:// if missing\n    if (websiteUrl) {\n      const urlPattern4 = new RegExp('^https?:\\\\/\\\\/', 'i');\n      if (!urlPattern4.test(websiteUrl)) {\n      websiteUrl = 'https://' + websiteUrl;\n      }\n    }\n    const userInput: UserInput = {\n      websiteUrl: websiteUrl,\n      country: body.country,\n      region: body.region,\n      language: body.language,\n    };\n\n    // Validate input\n    if (!userInput.websiteUrl || !userInput.country || !userInput.language) {\n      return new Response(\n        JSON.stringify({ error: \"Missing required fields\" }),\n        {\n          status: 400,\n          headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n        }\n      );\n    }\n\n    const runId = await this.engine.runAnalysis(userInput, env);\n\n    return new Response(\n      JSON.stringify({\n        runId,\n        status: \"started\",\n        message: \"Analysis started successfully\",\n      }),\n      {\n        status: 202,\n        headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n      }\n    );\n  }\n\n  private async handleGetAllAnalyses(\n    request: Request,\n    env: Env,\n    corsHeaders: Record<string, string>\n  ): Promise<Response> {\n    try {\n      const { Database } = await import(\"../persistence/index.js\");\n      const db = new Database(env.geo_db as any);\n      const analyses = await db.getAllAnalysisRuns(100);\n      \n      // Ensure we always return an array, even if empty or if there's an error\n      const analysesArray = Array.isArray(analyses) ? analyses : [];\n      \n      return new Response(JSON.stringify(analysesArray), {\n        headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n      });\n    } catch (error) {\n      console.error(\"Error getting all analyses:\", error);\n      // Return empty array instead of error object to prevent frontend errors\n      return new Response(JSON.stringify([]), {\n        status: 200,\n        headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n      });\n    }\n  }\n\n  private async handleGetAnalysis(\n    runId: string,\n    env: Env,\n    corsHeaders: Record<string, string>\n  ): Promise<Response> {\n    const result = await this.engine.getAnalysisResult(runId, env);\n\n    if (!result) {\n      return new Response(JSON.stringify({ error: \"Analysis not found\" }), {\n        status: 404,\n        headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n      });\n    }\n\n    return new Response(JSON.stringify(result), {\n      headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n    });\n  }\n\n  private async handleGetStatus(\n    runId: string,\n    env: Env,\n    corsHeaders: Record<string, string>\n  ): Promise<Response> {\n    const { Database } = await import(\"../persistence/index.js\");\n    const db = new Database(env.geo_db as any);\n    const status = await db.getAnalysisStatus(runId);\n\n    if (!status) {\n      return new Response(JSON.stringify({ error: \"Analysis not found\" }), {\n        status: 404,\n        headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n      });\n    }\n\n    return new Response(JSON.stringify(status), {\n      headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n    });\n  }\n\n  private async handleGetMetrics(\n    runId: string,\n    env: Env,\n    corsHeaders: Record<string, string>\n  ): Promise<Response> {\n    const result = await this.engine.getAnalysisResult(runId, env);\n\n    if (!result) {\n      return new Response(JSON.stringify({ error: \"Analysis not found\" }), {\n        status: 404,\n        headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n      });\n    }\n\n    return new Response(\n      JSON.stringify({\n        categoryMetrics: result.categoryMetrics,\n        competitiveAnalysis: result.competitiveAnalysis,\n        timeSeries: result.timeSeries,\n      }),\n      {\n        headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n      }\n    );\n  }\n\n  private async handleStep1(\n    request: Request,\n    env: Env,\n    corsHeaders: Record<string, string>\n  ): Promise<Response> {\n    try {\n      const body = await request.json();\n      let websiteUrl = body.websiteUrl?.trim();\n      // Auto-add https:// if missing\n      if (websiteUrl) {\n        const urlPattern5 = new RegExp('^https?:\\\\/\\\\/', 'i');\n        if (!urlPattern5.test(websiteUrl)) {\n        websiteUrl = 'https://' + websiteUrl;\n        }\n      }\n      const userInput: UserInput = {\n        websiteUrl: websiteUrl,\n        country: body.country,\n        region: body.region,\n        language: body.language,\n      };\n\n      const result = await this.workflowEngine.step1FindSitemap(userInput, env);\n\n      return new Response(JSON.stringify({\n        runId: result.runId,\n        urls: result.urls,\n        foundSitemap: result.foundSitemap,\n        message: result.foundSitemap \n          ? `Sitemap gefunden: ${result.urls.length} URLs` \n          : `Keine Sitemap gefunden. ${result.urls.length} URLs von Startseite extrahiert`\n      }), {\n        headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n      });\n    } catch (error) {\n      console.error(\"Error in handleStep1:\", error);\n      return new Response(\n        JSON.stringify({\n          error: \"Failed to start analysis\",\n          message: error instanceof Error ? error.message : \"Unknown error\",\n        }),\n        {\n          status: 500,\n          headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n        }\n      );\n    }\n  }\n\n  private async handleStep2(\n    request: Request,\n    env: Env,\n    corsHeaders: Record<string, string>\n  ): Promise<Response> {\n    const body = await request.json();\n    const { runId, urls } = body;\n\n    const result = await this.workflowEngine.step2FetchContent(\n      runId,\n      urls,\n      body.language,\n      env\n    );\n\n    return new Response(JSON.stringify(result), {\n      headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n    });\n  }\n\n  private async handleStep3(\n    request: Request,\n    env: Env,\n    corsHeaders: Record<string, string>\n  ): Promise<Response> {\n    const body = await request.json();\n    const { runId, content, language } = body;\n\n    const categories = await this.workflowEngine.step3GenerateCategories(\n      runId,\n      content,\n      language,\n      env\n    );\n\n    return new Response(JSON.stringify({ categories }), {\n      headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n    });\n  }\n\n  private async handleSaveCategories(\n    runId: string,\n    request: Request,\n    env: Env,\n    corsHeaders: Record<string, string>\n  ): Promise<Response> {\n    const body = await request.json();\n    const { selectedCategoryIds, customCategories } = body;\n\n    await this.workflowEngine.saveSelectedCategories(\n      runId,\n      selectedCategoryIds || [],\n      customCategories || [],\n      env\n    );\n\n    return new Response(JSON.stringify({ success: true }), {\n      headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n    });\n  }\n\n  private async handleStep4(\n    request: Request,\n    env: Env,\n    corsHeaders: Record<string, string>\n  ): Promise<Response> {\n    const body = await request.json();\n    const { runId, categories, userInput, questionsPerCategory, companyId } = body;\n\n    const prompts = await this.workflowEngine.step4GeneratePrompts(\n      runId,\n      categories,\n      userInput,\n      body.content || \"\",\n      env,\n      questionsPerCategory || 3,\n      companyId // Pass companyId to save prompts to company_prompts\n    );\n\n    return new Response(JSON.stringify({ prompts }), {\n      headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n    });\n  }\n\n  private async handleSavePrompts(\n    runId: string,\n    request: Request,\n    env: Env,\n    corsHeaders: Record<string, string>\n  ): Promise<Response> {\n    const body = await request.json();\n    const { prompts } = body;\n\n    await this.workflowEngine.saveUserPrompts(runId, prompts, env);\n\n    return new Response(JSON.stringify({ success: true }), {\n      headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n    });\n  }\n\n  private async handleStep5(\n    request: Request,\n    env: Env,\n    corsHeaders: Record<string, string>\n  ): Promise<Response> {\n    const body = await request.json();\n    const { runId, prompts } = body;\n\n    const result = await this.workflowEngine.step5ExecutePrompts(\n      runId,\n      prompts,\n      env\n    );\n\n    return new Response(JSON.stringify(result), {\n      headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n    });\n  }\n\n  // Execute scheduled run: Load saved prompts from company_prompts and execute them\n  private async handleExecuteScheduledRun(\n    request: Request,\n    env: Env,\n    corsHeaders: Record<string, string>\n  ): Promise<Response> {\n    try {\n      const body = await request.json();\n      const { companyId, scheduleId } = body;\n\n      if (!companyId) {\n        return new Response(\n          JSON.stringify({ error: \"companyId is required\" }),\n          {\n            status: 400,\n            headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n          }\n        );\n      }\n\n      const { Database } = await import(\"../persistence/index.js\");\n      const db = new Database();\n\n      // Get saved prompts for this company\n      const savedPrompts = await db.getCompanyPrompts(companyId, true);\n      if (savedPrompts.length === 0) {\n        return new Response(\n          JSON.stringify({ error: \"No active prompts found for this company\" }),\n          {\n            status: 404,\n            headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n          }\n        );\n      }\n      \n      // Execute prompts (simplified - would need full execution logic)\n      return new Response(\n        JSON.stringify({ \n          message: \"Scheduled run executed\",\n          promptsExecuted: savedPrompts.length \n        }),\n        {\n          headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n        }\n      );\n    } catch (error) {\n      return new Response(\n        JSON.stringify({\n          error: error instanceof Error ? error.message : \"Unknown error\",\n        }),\n        {\n          status: 500,\n          headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n        }\n      );\n    }\n  }\n\n  // Setup database - Run all migrations\n  private async handleSetupDatabase(\n    request: Request,\n    env: Env,\n    corsHeaders: Record<string, string>\n  ): Promise<Response> {\n    // Database setup is disabled - no database dependencies\n    return new Response(\n      JSON.stringify({\n        success: true,\n        message: \"Database setup is disabled - no database dependencies in this project\",\n        results: [\"Database operations are disabled\"],\n      }),\n      {\n        headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n      }\n    );\n  }\n\n  // Test Analysis: Analyze manual input\n  private async handleTestAnalyze(\n    request: Request,\n    env: Env,\n    corsHeaders: Record<string, string>\n  ): Promise<Response> {\n    try {\n      const body = await request.json() as {\n        brandName: string;\n        domain?: string;\n        question: string;\n        answer: string; // GPT-Antwort\n        citations?: Array<{\n          url: string;\n          title?: string;\n          snippet?: string;\n        }>;\n      };\n\n      if (!body.brandName || !body.question || !body.answer) {\n        return new Response(\n          JSON.stringify({ error: \"brandName, question, and answer are required\" }),\n          {\n            status: 400,\n            headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n          }\n        );\n      }\n\n      // Create prompt object\n      const prompt: Prompt = {\n        id: `test_${Date.now()}`,\n        categoryId: \"test\",\n        question: body.question,\n        language: \"de\",\n        country: \"CH\",\n        intent: \"high\",\n        createdAt: new Date().toISOString(),\n      };\n\n      // Create LLMResponse object\n      const response: LLMResponse = {\n        promptId: prompt.id,\n        outputText: body.answer,\n        citations: body.citations || [],\n        timestamp: new Date().toISOString(),\n        model: \"test\",\n      };\n\n      // Perform analysis\n      const { AnalysisEngine } = await import(\"../analysis/index.js\");\n      const analysisEngine = new AnalysisEngine(body.brandName, 0.7);\n      const analysis = analysisEngine.analyzeResponses([prompt], [response])[0];\n\n      // Return detailed results\n      return new Response(\n        JSON.stringify({\n          prompt: {\n            id: prompt.id,\n            question: prompt.question,\n          },\n          response: {\n            outputText: response.outputText,\n            citations: response.citations,\n            timestamp: response.timestamp,\n          },\n          analysis: {\n            // Brand Mentions\n            brandMentions: {\n              exact: analysis.brandMentions.exact,\n              fuzzy: analysis.brandMentions.fuzzy,\n              total: analysis.brandMentions.exact + analysis.brandMentions.fuzzy,\n              contexts: analysis.brandMentions.contexts,\n            },\n            // Citations\n            citations: {\n              total: analysis.citationCount,\n              urls: analysis.citationUrls,\n              brandCitations: analysis.brandCitations,\n              allCitations: response.citations,\n            },\n            // Competitors\n            competitors: analysis.competitors.map(c => ({\n              name: c.name,\n              count: c.count,\n              contexts: c.contexts,\n              citationUrls: c.citations,\n            })),\n            // Sentiment\n            sentiment: {\n              tone: analysis.sentiment.tone,\n              confidence: analysis.sentiment.confidence,\n              keywords: analysis.sentiment.keywords,\n            },\n            // Structured Answers\n            isMentioned: analysis.isMentioned,\n            mentionCount: analysis.mentionCount,\n            isCited: analysis.isCited,\n            citationDetails: analysis.citationDetails,\n            competitorDetails: analysis.competitorDetails,\n          },\n        }),\n        {\n          headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n        }\n      );\n    } catch (error) {\n      console.error(\"Error in handleTestAnalyze:\", error);\n      return new Response(\n        JSON.stringify({\n          error: error instanceof Error ? error.message : \"Unknown error\",\n          details: error instanceof Error ? error.stack : undefined,\n        }),\n        {\n          status: 500,\n          headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n        }\n      );\n    }\n  }\n\n  // Get detailed insights for an analysis\n  private async handleGetAnalysisInsights(\n    runId: string,\n    env: Env,\n    corsHeaders: Record<string, string>\n  ): Promise<Response> {\n    try {\n      const { Database } = await import(\"../persistence/index.js\");\n      const db = new Database(env.geo_db as any);\n      \n      // Get analysis run info\n      const run = await db.db\n        .prepare(\"SELECT * FROM analysis_runs WHERE id = ?\")\n        .bind(runId)\n        .first<{\n          id: string;\n          website_url: string;\n          country: string;\n          language: string;\n          region: string | null;\n          created_at: string;\n        }>();\n      \n      if (!run) {\n        return new Response(JSON.stringify({ error: \"Analysis not found\" }), {\n          status: 404,\n          headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n        });\n      }\n      \n      // Extract brand name from website URL\n      const brandName = this.extractBrandName(run.website_url);\n      \n      // Get all prompts for this run\n      const prompts = await db.db\n        .prepare(\"SELECT * FROM prompts WHERE analysis_run_id = ? ORDER BY created_at ASC\")\n        .bind(runId)\n        .all<{\n          id: string;\n          question: string;\n          category_id: string;\n          created_at: string;\n        }>();\n      \n      if (!prompts.results || prompts.results.length === 0) {\n        return new Response(JSON.stringify({ \n          error: \"No prompts found for this analysis\",\n          summary: {\n            totalBrandMentions: 0,\n            totalBrandCitations: 0,\n            promptsWithMentions: 0,\n            totalPrompts: 0,\n          },\n          promptsWithMentions: [],\n          allCompetitors: [],\n          detailedData: [],\n        }), {\n          headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n        });\n      }\n      \n      // Get all responses and analyses\n      const insightsData = await Promise.all(\n        (prompts.results || []).map(async (prompt) => {\n          // Get LLM response\n          const response = await db.db\n            .prepare(\"SELECT * FROM llm_responses WHERE prompt_id = ? ORDER BY timestamp DESC LIMIT 1\")\n            .bind(prompt.id)\n            .first<{\n              id: string;\n              output_text: string;\n              timestamp: string;\n            }>();\n          \n          // Get citations\n          const citations = response\n            ? await db.db\n                .prepare(\"SELECT * FROM citations WHERE llm_response_id = ?\")\n                .bind(response.id)\n                .all<{\n                  id: string;\n                  url: string;\n                  title: string | null;\n                  snippet: string | null;\n                }>()\n            : { results: [] };\n          \n          // Get analysis\n          const analysis = await db.db\n            .prepare(\"SELECT * FROM prompt_analyses WHERE prompt_id = ? ORDER BY timestamp DESC LIMIT 1\")\n            .bind(prompt.id)\n            .first<{\n              id: string;\n              brand_mentions_exact: number;\n              brand_mentions_fuzzy: number;\n              brand_mentions_contexts: string;\n              citation_count: number;\n              citation_urls: string;\n              timestamp: string;\n            }>();\n          \n          // Get competitor mentions\n          let competitors: { results: Array<{\n            id: string;\n            competitor_name: string;\n            mention_count: number;\n            citation_urls: string;\n          }> } = { results: [] };\n          try {\n            if (analysis) {\n              const competitorsResult = await db.db\n                .prepare(\"SELECT * FROM competitor_mentions WHERE prompt_analysis_id = ?\")\n                .bind(analysis.id)\n                .all<{\n                  id: string;\n                  competitor_name: string;\n                  mention_count: number;\n                  citation_urls: string;\n                }>();\n              competitors = {\n                results: competitorsResult.results || []\n              };\n            }\n          } catch (e) {\n            console.warn('Error fetching competitors for prompt', prompt.id, ':', e);\n            competitors = { results: [] };\n          }\n          \n          // Check which citations mention the brand\n          const brandCitations = (citations.results || []).filter(citation => {\n            try {\n            const text = `${citation.title || \"\"} ${citation.snippet || \"\"}`.toLowerCase();\n            return text.includes(brandName.toLowerCase());\n            } catch (e) {\n              console.warn('Error checking brand citation:', e);\n              return false;\n            }\n          });\n          \n          // Safely parse JSON fields\n          let contexts = [];\n          try {\n            if (analysis?.brand_mentions_contexts) {\n              contexts = JSON.parse(analysis.brand_mentions_contexts);\n            }\n          } catch (e) {\n            console.warn('Error parsing brand_mentions_contexts:', e);\n            contexts = [];\n          }\n          \n          return {\n            promptId: prompt.id,\n            question: prompt.question,\n            answer: response?.output_text || null,\n            timestamp: response?.timestamp || null,\n            // Metriken\n            brandMentions: {\n              total: (analysis?.brand_mentions_exact || 0) + (analysis?.brand_mentions_fuzzy || 0),\n              exact: analysis?.brand_mentions_exact || 0,\n              fuzzy: analysis?.brand_mentions_fuzzy || 0,\n              contexts: contexts,\n            },\n            citations: {\n              total: analysis?.citation_count || 0,\n              brandCitations: brandCitations.length, // Wie oft zitiert von meiner Seite\n              allCitations: (citations.results || []).map(c => ({\n                url: c.url,\n                title: c.title,\n                snippet: c.snippet,\n                mentionsBrand: brandCitations.some(bc => bc.id === c.id),\n              })),\n            },\n            competitors: (competitors.results || []).map(c => {\n              let citationUrls = [];\n              try {\n                citationUrls = JSON.parse(c.citation_urls || \"[]\");\n              } catch (e) {\n                console.warn('Error parsing citation_urls for competitor:', e);\n                citationUrls = [];\n              }\n              return {\n              name: c.competitor_name,\n              count: c.mention_count,\n                citationUrls: citationUrls,\n              };\n            }),\n          };\n        })\n      );\n      \n      // Calculate summary metrics (with safety checks)\n      const totalBrandMentions = insightsData.reduce((sum, d) => sum + (d?.brandMentions?.total || 0), 0);\n      const totalBrandCitations = insightsData.reduce((sum, d) => sum + (d?.citations?.brandCitations || 0), 0);\n      const promptsWithMentions = insightsData.filter(d => (d?.brandMentions?.total || 0) > 0);\n      const allCompetitors = new Map<string, { count: number; prompts: string[] }>();\n      \n      insightsData.forEach((data) => {\n        if (data?.competitors && Array.isArray(data.competitors)) {\n        data.competitors.forEach(comp => {\n            if (comp?.name) {\n          if (!allCompetitors.has(comp.name)) {\n            allCompetitors.set(comp.name, { count: 0, prompts: [] });\n          }\n          const entry = allCompetitors.get(comp.name)!;\n              entry.count += comp.count || 0;\n              if (data.question) {\n          entry.prompts.push(data.question);\n              }\n            }\n        });\n        }\n      });\n      \n      const insights = {\n        runId,\n        websiteUrl: run.website_url,\n        brandName,\n        summary: {\n          totalBrandMentions: totalBrandMentions || 0,\n          totalBrandCitations: totalBrandCitations || 0,\n          promptsWithMentions: promptsWithMentions.length || 0,\n          totalPrompts: insightsData.length || 0,\n        },\n        promptsWithMentions: (promptsWithMentions || []).map(d => ({\n          question: d?.question || '',\n          mentionCount: d?.brandMentions?.total || 0,\n          citationCount: d?.citations?.brandCitations || 0,\n        })),\n        allCompetitors: Array.from(allCompetitors.entries()).map(([name, data]) => ({\n          name: name || '',\n          totalMentions: data?.count || 0,\n          mentionedInPrompts: data?.prompts || [],\n        })),\n        detailedData: insightsData || [],\n      };\n      \n      return new Response(JSON.stringify(insights), {\n        headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n      });\n    } catch (error) {\n      console.error(\"Error getting analysis insights:\", error);\n      return new Response(\n        JSON.stringify({\n          error: error instanceof Error ? error.message : \"Unknown error\",\n        }),\n        {\n          status: 500,\n          headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n        }\n      );\n    }\n  }\n\n  // Delete an analysis\n  private async handleDeleteAnalysis(\n    runId: string,\n    env: Env,\n    corsHeaders: Record<string, string>\n  ): Promise<Response> {\n    try {\n      const { Database } = await import(\"../persistence/index.js\");\n      const db = new Database(env.geo_db as any);\n\n      // Delete all related data\n      await db.db.prepare(\"DELETE FROM citations WHERE llm_response_id IN (SELECT id FROM llm_responses WHERE prompt_id IN (SELECT id FROM prompts WHERE analysis_run_id = ?))\").bind(runId).run();\n      await db.db.prepare(\"DELETE FROM competitor_mentions WHERE prompt_analysis_id IN (SELECT id FROM prompt_analyses WHERE prompt_id IN (SELECT id FROM prompts WHERE analysis_run_id = ?))\").bind(runId).run();\n      await db.db.prepare(\"DELETE FROM prompt_analyses WHERE prompt_id IN (SELECT id FROM prompts WHERE analysis_run_id = ?)\").bind(runId).run();\n      await db.db.prepare(\"DELETE FROM llm_responses WHERE prompt_id IN (SELECT id FROM prompts WHERE analysis_run_id = ?)\").bind(runId).run();\n      await db.db.prepare(\"DELETE FROM prompts WHERE analysis_run_id = ?\").bind(runId).run();\n      await db.db.prepare(\"DELETE FROM categories WHERE analysis_run_id = ?\").bind(runId).run();\n      await db.db.prepare(\"DELETE FROM analysis_runs WHERE id = ?\").bind(runId).run();\n\n      return new Response(JSON.stringify({ success: true, message: \"Analysis deleted successfully\" }), {\n        headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n      });\n    } catch (error) {\n      console.error(\"Error deleting analysis:\", error);\n      return new Response(\n        JSON.stringify({\n          error: error instanceof Error ? error.message : \"Unknown error\",\n        }),\n        {\n          status: 500,\n          headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n        }\n      );\n    }\n  }\n\n  // Pause an analysis\n  \n\n\n  // AI Readiness: Get status\n  private async handleAIReadinessStatus(\n    runId: string,\n    env: Env,\n    corsHeaders: Record<string, string>\n  ): Promise<Response> {\n    try {\n      const { Database } = await import(\"../persistence/index.js\");\n      const db = new Database(env.geo_db as any);\n      \n      // Create table if not exists (using try-catch to ignore if already exists)\n      try {\n        await db.db.exec(\n          'CREATE TABLE IF NOT EXISTS ai_readiness_runs (id TEXT PRIMARY KEY, website_url TEXT NOT NULL, status TEXT NOT NULL, robots_txt TEXT, sitemap_urls TEXT, total_urls INTEGER, recommendations TEXT, message TEXT, error TEXT, created_at TEXT NOT NULL, updated_at TEXT NOT NULL)'\n        );\n      } catch (e: any) {\n        // Ignore error if table already exists\n        if (!e?.message?.includes('already exists') && !e?.message?.includes('duplicate')) {\n          console.warn('Could not create ai_readiness_runs table (may already exist):', e);\n        }\n      }\n      \n      const result = await db.db\n        .prepare(\"SELECT * FROM ai_readiness_runs WHERE id = ?\")\n        .bind(runId)\n        .first<{\n          id: string;\n          status: string;\n          recommendations: string | null;\n          message: string | null;\n          error: string | null;\n        }>();\n      \n      if (!result) {\n        return new Response(\n          JSON.stringify({ error: \"Run not found\" }),\n          {\n            status: 404,\n            headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n          }\n        );\n      }\n      \n      return new Response(\n        JSON.stringify({\n          runId: result.id,\n          status: result.status,\n          recommendations: result.recommendations,\n          message: result.message,\n          error: result.error,\n        }),\n        {\n          headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n        }\n      );\n    } catch (error) {\n      console.error(\"Error in handleAIReadinessStatus:\", error);\n      return new Response(\n        JSON.stringify({\n          error: error instanceof Error ? error.message : \"Unknown error\",\n        }),\n        {\n          status: 500,\n          headers: { ...corsHeaders, \"Content-Type\": \"application/json\" },\n        }\n      );\n    }\n  }\n\n  // AI Readiness: Process analysis (async)\n  private async processAIReadiness(\n    runId: string,\n    websiteUrl: string,\n    env: Env\n  ): Promise<void> {\n    const { Database } = await import(\"../persistence/index.js\");\n    const db = new Database(env.geo_db as any);\n    \n    // Report structure\n    interface PageData {\n      url: string;\n      title: string;\n      content: string;\n      responseTime: number;\n      status: number;\n      success: boolean;\n    }\n    \n    const report = {\n      websiteUrl,\n      robotsTxt: { found: false, content: '', note: '' },\n      sitemap: { found: false, urls: [] as string[], note: '' },\n      homepage: { scraped: false, data: null as PageData | null },\n      pages: [] as PageData[],\n      summary: {\n        totalPages: 0,\n        successfulPages: 0,\n        averageResponseTime: 0,\n        fastestPage: '',\n        slowestPage: ''\n      }\n    };\n    \n    const updateStatus = async (message: string) => {\n      try {\n        console.log(`[AI Readiness ${runId}] Status update: ${message}`);\n        await db.db\n          .prepare('UPDATE ai_readiness_runs SET message = ?, updated_at = ? WHERE id = ?')\n          .bind(message, new Date().toISOString(), runId)\n          .run();\n      } catch (e: any) {\n        console.error(`[AI Readiness ${runId}] Error updating status:`, e);\n      }\n    };\n    \n    console.log(`[AI Readiness ${runId}] processAIReadiness started for ${websiteUrl}`);\n    \n    try {\n      // Create table if not exists\n      try {\n        await db.db.exec(\n          'CREATE TABLE IF NOT EXISTS ai_readiness_runs (id TEXT PRIMARY KEY, website_url TEXT NOT NULL, status TEXT NOT NULL, robots_txt TEXT, sitemap_urls TEXT, total_urls INTEGER, recommendations TEXT, message TEXT, error TEXT, created_at TEXT NOT NULL, updated_at TEXT NOT NULL)'\n        );\n      } catch (e: any) {\n        if (!e?.message?.includes('already exists') && !e?.message?.includes('duplicate')) {\n          console.warn('Could not create ai_readiness_runs table:', e);\n        }\n      }\n      \n      // Update initial record\n      try {\n        await db.db\n          .prepare('INSERT OR IGNORE INTO ai_readiness_runs (id, website_url, status, created_at, updated_at, message) VALUES (?, ?, ?, ?, ?, ?)')\n          .bind(runId, websiteUrl, 'processing', new Date().toISOString(), new Date().toISOString(), 'Starte Analyse...')\n          .run();\n      } catch (e: any) {\n        await db.db\n          .prepare('UPDATE ai_readiness_runs SET message = ?, updated_at = ? WHERE id = ?')\n          .bind('Starte Analyse...', new Date().toISOString(), runId)\n          .run();\n      }\n      \n      // Immediately update to first step to confirm function is running\n      console.log(`[AI Readiness ${runId}] Updating status to Step 1...`);\n      await updateStatus('Schritt 1/6: Pr\u00FCfe robots.txt...');\n      console.log(`[AI Readiness ${runId}] Status updated successfully`);\n      \n      // Helper function to measure response time\n      const measureResponseTime = async (url: string): Promise<{ responseTime: number; response: Response; html: string }> => {\n        const startTime = Date.now();\n        try {\n          const response = await fetch(url, {\n            headers: { \"User-Agent\": \"GEO-Platform/1.0\" },\n            signal: AbortSignal.timeout(15000) // 15 second timeout\n          });\n          const html = await response.text();\n          const responseTime = Date.now() - startTime;\n          return { responseTime, response, html };\n        } catch (error: any) {\n          const responseTime = Date.now() - startTime;\n          // Return a failed response object\n          return {\n            responseTime,\n            response: new Response(null, { status: 0, statusText: error.message || 'Request failed' }) as any,\n            html: ''\n          };\n        }\n      };\n      \n      // Helper function to scrape page\n      const scrapePage = (html: string, url: string): { title: string; content: string } => {\n        const titleMatch = html.match(/<title[^>]*>([^<]+)<\\/title>/i);\n        const title = titleMatch ? titleMatch[1].trim().replace(/\\s+/g, ' ') : url;\n        \n        let textContent = html\n          .replace(/<script[^>]*>[\\s\\S]*?<\\/script>/gi, '')\n          .replace(/<style[^>]*>[\\s\\S]*?<\\/style>/gi, '')\n          .replace(/<[^>]+>/g, ' ')\n          .replace(/\\s+/g, ' ')\n          .trim();\n        \n        if (textContent.length > 10000) {\n          textContent = textContent.substring(0, 10000) + '...';\n        }\n        \n        return { title, content: textContent };\n      };\n      \n      // STEP 1: Check robots.txt\n      console.log(`[AI Readiness ${runId}] ========================================`);\n      console.log(`[AI Readiness ${runId}] STEP 1: Checking robots.txt`);\n      console.log(`[AI Readiness ${runId}] ========================================`);\n      await updateStatus('Schritt 1/6: Pr\u00FCfe robots.txt...');\n      try {\n        const robotsUrl = new URL('/robots.txt', websiteUrl).toString();\n        console.log(`[AI Readiness ${runId}] \u2192 Fetching robots.txt from: ${robotsUrl}`);\n        const startTime = Date.now();\n        const { responseTime, response, html } = await measureResponseTime(robotsUrl);\n        const totalTime = Date.now() - startTime;\n        console.log(`[AI Readiness ${runId}] \u2192 Response Status: ${response.status}`);\n        console.log(`[AI Readiness ${runId}] \u2192 Response Time: ${responseTime}ms`);\n        console.log(`[AI Readiness ${runId}] \u2192 Content Length: ${html.length} bytes`);\n        if (response.ok && response.status !== 0) {\n          report.robotsTxt = { found: true, content: html, note: `Gefunden (${responseTime}ms)` };\n          console.log(`[AI Readiness ${runId}] \u2713 robots.txt gefunden (${responseTime}ms, ${html.length} bytes)`);\n          await updateStatus(`\u2713 robots.txt gefunden (${responseTime}ms)`);\n        } else {\n          report.robotsTxt = { found: false, content: '', note: `Nicht gefunden (Status: ${response.status})` };\n          console.log(`[AI Readiness ${runId}] \u26A0 robots.txt nicht gefunden (Status: ${response.status})`);\n          await updateStatus(`\u26A0 robots.txt nicht gefunden`);\n        }\n      } catch (e: any) {\n        console.error(`[AI Readiness ${runId}] \u274C Error checking robots.txt:`, e.message || e);\n        report.robotsTxt = { found: false, content: '', note: 'Nicht erreichbar' };\n        await updateStatus(`\u26A0 robots.txt nicht erreichbar`);\n      }\n      \n      // STEP 2: Check sitemap\n      console.log(`[AI Readiness ${runId}] ========================================`);\n      console.log(`[AI Readiness ${runId}] STEP 2: Checking sitemap`);\n      console.log(`[AI Readiness ${runId}] ========================================`);\n      await updateStatus('Schritt 2/6: Pr\u00FCfe Sitemap...');\n      try {\n        const { SitemapParser } = await import(\"../ingestion/sitemap.js\");\n        const sitemapParser = new SitemapParser();\n        console.log(`[AI Readiness ${runId}] \u2192 Parsing sitemap for: ${websiteUrl}`);\n        const startTime = Date.now();\n        const sitemapResult = await sitemapParser.findAndParseSitemap(websiteUrl);\n        const parseTime = Date.now() - startTime;\n        console.log(`[AI Readiness ${runId}] \u2192 Sitemap found: ${sitemapResult.foundSitemap}`);\n        console.log(`[AI Readiness ${runId}] \u2192 URLs found: ${sitemapResult.urls.length}`);\n        console.log(`[AI Readiness ${runId}] \u2192 Parse time: ${parseTime}ms`);\n        if (sitemapResult.foundSitemap && sitemapResult.urls.length > 0) {\n          report.sitemap = { found: true, urls: sitemapResult.urls, note: `${sitemapResult.urls.length} URLs gefunden` };\n          console.log(`[AI Readiness ${runId}] \u2713 Sitemap gefunden (${sitemapResult.urls.length} URLs in ${parseTime}ms)`);\n          await updateStatus(`\u2713 Sitemap gefunden (${sitemapResult.urls.length} URLs)`);\n        } else {\n          report.sitemap = { found: false, urls: [], note: 'Nicht gefunden' };\n          console.log(`[AI Readiness ${runId}] \u26A0 Sitemap nicht gefunden`);\n          await updateStatus(`\u26A0 Sitemap nicht gefunden`);\n        }\n      } catch (e: any) {\n        console.error(`[AI Readiness ${runId}] \u274C Error checking sitemap:`, e.message || e);\n        report.sitemap = { found: false, urls: [], note: 'Fehler beim Parsen' };\n        await updateStatus(`\u26A0 Sitemap-Fehler`);\n      }\n      \n      // STEP 3: Scrape homepage\n      console.log(`[AI Readiness ${runId}] ========================================`);\n      console.log(`[AI Readiness ${runId}] STEP 3: Scraping homepage`);\n      console.log(`[AI Readiness ${runId}] ========================================`);\n      await updateStatus('Schritt 3/6: Scrape Homepage...');\n      try {\n        console.log(`[AI Readiness ${runId}] \u2192 Fetching homepage: ${websiteUrl}`);\n        const { responseTime, response, html } = await measureResponseTime(websiteUrl);\n        console.log(`[AI Readiness ${runId}] \u2192 Response Status: ${response.status}`);\n        console.log(`[AI Readiness ${runId}] \u2192 Response Time: ${responseTime}ms`);\n        console.log(`[AI Readiness ${runId}] \u2192 HTML Length: ${html.length} bytes`);\n        if (response.ok && response.status !== 0 && html) {\n          const { title, content } = scrapePage(html, websiteUrl);\n          console.log(`[AI Readiness ${runId}] \u2192 Title extracted: ${title.substring(0, 60)}${title.length > 60 ? '...' : ''}`);\n          console.log(`[AI Readiness ${runId}] \u2192 Content extracted: ${content.length} characters`);\n          report.homepage = {\n            scraped: true,\n            data: { url: websiteUrl, title, content, responseTime, status: response.status, success: true }\n          };\n          console.log(`[AI Readiness ${runId}] \u2713 Homepage gescraped (${responseTime}ms, ${content.length} Zeichen)`);\n          await updateStatus(`\u2713 Homepage gescraped (${responseTime}ms, ${content.length} Zeichen)`);\n        } else {\n          report.homepage = {\n            scraped: false,\n            data: { url: websiteUrl, title: '', content: '', responseTime, status: response.status || 0, success: false }\n          };\n          console.log(`[AI Readiness ${runId}] \u26A0 Homepage-Fehler (Status: ${response.status || 0})`);\n          await updateStatus(`\u26A0 Homepage-Fehler (Status: ${response.status || 0})`);\n        }\n      } catch (e: any) {\n        console.error(`[AI Readiness ${runId}] \u274C Error scraping homepage:`, e.message || e);\n        report.homepage = {\n          scraped: false,\n          data: { url: websiteUrl, title: '', content: '', responseTime: 0, status: 0, success: false }\n        };\n        await updateStatus(`\u26A0 Homepage-Fehler`);\n      }\n      \n      // STEP 4: Scrape all sitemap links\n      console.log(`[AI Readiness ${runId}] ========================================`);\n      console.log(`[AI Readiness ${runId}] STEP 4: Scraping pages`);\n      console.log(`[AI Readiness ${runId}] ========================================`);\n      const urlsToScrape = report.sitemap.found ? report.sitemap.urls.slice(0, 50) : [websiteUrl];\n      console.log(`[AI Readiness ${runId}] \u2192 Total pages to scrape: ${urlsToScrape.length}`);\n      await updateStatus(`Schritt 4/6: Scrape ${urlsToScrape.length} Seiten...`);\n      \n      const startTime = Date.now();\n      let successCount = 0;\n      let failCount = 0;\n      \n      for (let i = 0; i < urlsToScrape.length; i++) {\n        const url = urlsToScrape[i];\n        try {\n          console.log(`[AI Readiness ${runId}] \u2192 [${i + 1}/${urlsToScrape.length}] Scraping: ${url}`);\n          const { responseTime, response, html } = await measureResponseTime(url);\n          if (response.ok && response.status !== 0 && html) {\n            const { title, content } = scrapePage(html, url);\n            report.pages.push({\n              url,\n              title,\n              content,\n              responseTime,\n              status: response.status,\n              success: true\n            });\n            successCount++;\n            console.log(`[AI Readiness ${runId}]   \u2713 Success (${responseTime}ms, ${content.length} chars)`);\n          } else {\n            report.pages.push({\n              url,\n              title: '',\n              content: '',\n              responseTime,\n              status: response.status || 0,\n              success: false\n            });\n            failCount++;\n            console.log(`[AI Readiness ${runId}]   \u2717 Failed (Status: ${response.status || 0})`);\n          }\n          \n          if ((i + 1) % 5 === 0 || i === urlsToScrape.length - 1) {\n            const elapsed = Date.now() - startTime;\n            console.log(`[AI Readiness ${runId}] \u2192 Progress: ${i + 1}/${urlsToScrape.length} (${successCount} success, ${failCount} failed, ${elapsed}ms elapsed)`);\n            await updateStatus(`Schritt 4/6: ${i + 1}/${urlsToScrape.length} Seiten gescraped...`);\n          }\n        } catch (e: any) {\n          console.error(`[AI Readiness ${runId}]   \u274C Error scraping ${url}:`, e.message || e);\n          report.pages.push({\n            url,\n            title: '',\n            content: '',\n            responseTime: 0,\n            status: 0,\n            success: false\n          });\n          failCount++;\n        }\n      }\n      \n      const totalTime = Date.now() - startTime;\n      console.log(`[AI Readiness ${runId}] \u2713 Step 4 complete: ${report.pages.length} pages scraped (${successCount} success, ${failCount} failed, ${totalTime}ms total)`);\n      \n      // Calculate summary\n      const successfulPages = report.pages.filter(p => p.success);\n      const responseTimes = report.pages.filter(p => p.responseTime > 0).map(p => p.responseTime);\n      const avgResponseTime = responseTimes.length > 0 \n        ? Math.round(responseTimes.reduce((a, b) => a + b, 0) / responseTimes.length)\n        : 0;\n      const fastestPage = responseTimes.length > 0 \n        ? report.pages.find(p => p.responseTime === Math.min(...responseTimes))?.url || ''\n        : '';\n      const slowestPage = responseTimes.length > 0\n        ? report.pages.find(p => p.responseTime === Math.max(...responseTimes))?.url || ''\n        : '';\n      \n      report.summary = {\n        totalPages: report.pages.length,\n        successfulPages: successfulPages.length,\n        averageResponseTime: avgResponseTime,\n        fastestPage,\n        slowestPage\n      };\n      \n      // STEP 5: Analyze data\n      console.log(`[AI Readiness ${runId}] ========================================`);\n      console.log(`[AI Readiness ${runId}] STEP 5: Analyzing data`);\n      console.log(`[AI Readiness ${runId}] ========================================`);\n      console.log(`[AI Readiness ${runId}] \u2192 Total pages: ${report.pages.length}`);\n      console.log(`[AI Readiness ${runId}] \u2192 Successful pages: ${successfulPages.length}`);\n      console.log(`[AI Readiness ${runId}] \u2192 Average response time: ${avgResponseTime}ms`);\n      console.log(`[AI Readiness ${runId}] \u2192 Fastest page: ${fastestPage}`);\n      console.log(`[AI Readiness ${runId}] \u2192 Slowest page: ${slowestPage}`);\n      await updateStatus(`Schritt 5/6: Analysiere Daten (${successfulPages.length}/${report.pages.length} erfolgreich, \u00D8 ${avgResponseTime}ms)...`);\n      \n      // STEP 5: Build comprehensive report for GPT\n      console.log(`[AI Readiness ${runId}] \u2192 Building GPT prompt...`);\n      const promptStartTime = Date.now();\n      const prompt = this.buildAIReadinessPromptFromReport(report);\n      const promptTime = Date.now() - promptStartTime;\n      console.log(`[AI Readiness ${runId}] \u2192 GPT prompt built (${prompt.length} characters, ${promptTime}ms)`);\n      \n      // STEP 6: Send to GPT\n      console.log(`[AI Readiness ${runId}] ========================================`);\n      console.log(`[AI Readiness ${runId}] STEP 6: Sending to GPT`);\n      console.log(`[AI Readiness ${runId}] ========================================`);\n      await updateStatus('Schritt 6/6: Generiere AI Readiness Analyse mit GPT...');\n      console.log(`[AI Readiness ${runId}] \u2192 Sending request to OpenAI API...`);\n      const gptStartTime = Date.now();\n      const gptResponse = await this.callGPTForAIReadiness(prompt, env);\n      const gptTime = Date.now() - gptStartTime;\n      console.log(`[AI Readiness ${runId}] \u2192 GPT response received (${gptResponse.length} characters, ${gptTime}ms)`);\n      \n      // Save final results\n      console.log(`[AI Readiness ${runId}] \u2192 Saving results to database...`);\n      await db.db\n        .prepare('UPDATE ai_readiness_runs SET status = ?, recommendations = ?, message = ?, robots_txt = ?, updated_at = ? WHERE id = ?')\n        .bind(\n          'completed',\n          gptResponse,\n          '\u2713 Analyse abgeschlossen',\n          JSON.stringify(report),\n          new Date().toISOString(),\n          runId\n        )\n        .run();\n      console.log(`[AI Readiness ${runId}] ========================================`);\n      console.log(`[AI Readiness ${runId}] \u2713 ANALYSIS COMPLETE`);\n      console.log(`[AI Readiness ${runId}] ========================================`);\n      \n    } catch (error) {\n      console.error(`[AI Readiness ${runId}] ========================================`);\n      console.error(`[AI Readiness ${runId}] \u274C ERROR in processAIReadiness:`, error);\n      console.error(`[AI Readiness ${runId}] ========================================`);\n      await db.db\n        .prepare(`\n          UPDATE ai_readiness_runs \n          SET status = ?, error = ?, updated_at = ?\n          WHERE id = ?\n        `)\n        .bind(\n          'error',\n          error instanceof Error ? error.message : 'Unknown error',\n          new Date().toISOString()\n        )\n        .run();\n    }\n  }\n\n  // Build prompt for AI Readiness analysis from comprehensive report\n  private buildAIReadinessPromptFromReport(report: any): string {\n    let prompt = `# AI READINESS ANALYSE\\n\\n`;\n    prompt += `Analysiere die folgende Website auf AI-Readiness und bewerte, wie gut sie von KI-Systemen gelesen und verstanden werden kann.\\n\\n`;\n    prompt += `## WEBSITE\\n${report.websiteUrl}\\n\\n`;\n    \n    // Robots.txt\n    prompt += `## ROBOTS.TXT\\n`;\n    if (report.robotsTxt.found) {\n      prompt += `Status: \u2713 Gefunden\\n`;\n      prompt += `Hinweis: ${report.robotsTxt.note}\\n`;\n      prompt += `Inhalt:\\n\\`\\`\\`\\n${report.robotsTxt.content}\\n\\`\\`\\`\\n\\n`;\n    } else {\n      prompt += `Status: \u2717 Nicht gefunden\\n`;\n      prompt += `Hinweis: ${report.robotsTxt.note}\\n\\n`;\n    }\n    \n    // Sitemap\n    prompt += `## SITEMAP\\n`;\n    if (report.sitemap.found) {\n      prompt += `Status: \u2713 Gefunden\\n`;\n      prompt += `Anzahl URLs: ${report.sitemap.urls.length}\\n`;\n      prompt += `Hinweis: ${report.sitemap.note}\\n`;\n      prompt += `Erste 20 URLs:\\n${report.sitemap.urls.slice(0, 20).map((url: string, i: number) => `${i + 1}. ${url}`).join('\\n')}\\n\\n`;\n    } else {\n      prompt += `Status: \u2717 Nicht gefunden\\n`;\n      prompt += `Hinweis: ${report.sitemap.note}\\n\\n`;\n    }\n    \n    // Homepage\n    prompt += `## HOMEPAGE\\n`;\n    if (report.homepage.scraped && report.homepage.data) {\n      const hp = report.homepage.data;\n      prompt += `Status: \u2713 Gescraped\\n`;\n      prompt += `Response Time: ${hp.responseTime}ms\\n`;\n      prompt += `HTTP Status: ${hp.status}\\n`;\n      prompt += `Titel: ${hp.title}\\n`;\n      prompt += `Content-L\u00E4nge: ${hp.content.length} Zeichen\\n`;\n      prompt += `Inhalt (Auszug, erste 2000 Zeichen):\\n${hp.content.substring(0, 2000)}${hp.content.length > 2000 ? '...' : ''}\\n\\n`;\n    } else {\n      prompt += `Status: \u2717 Nicht gescraped\\n`;\n      prompt += `Hinweis: Homepage konnte nicht geladen werden\\n\\n`;\n    }\n    \n    // Pages with response times\n    prompt += `## GESCRAEPTE SEITEN (${report.pages.length} Seiten)\\n\\n`;\n    prompt += `### PERFORMANCE-\u00DCBERSICHT\\n`;\n    prompt += `- Gesamt: ${report.summary.totalPages} Seiten\\n`;\n    prompt += `- Erfolgreich: ${report.summary.successfulPages} Seiten\\n`;\n    prompt += `- Durchschnittliche Response Time: ${report.summary.averageResponseTime}ms\\n`;\n    prompt += `- Schnellste Seite: ${report.summary.fastestPage} (${report.pages.find((p: any) => p.url === report.summary.fastestPage)?.responseTime || 0}ms)\\n`;\n    prompt += `- Langsamste Seite: ${report.summary.slowestPage} (${report.pages.find((p: any) => p.url === report.summary.slowestPage)?.responseTime || 0}ms)\\n\\n`;\n    \n    prompt += `### SEITEN-DETAILS\\n`;\n    report.pages.slice(0, 20).forEach((page: any, i: number) => {\n      prompt += `\\n#### Seite ${i + 1}: ${page.title || 'Kein Titel'}\\n`;\n      prompt += `- URL: ${page.url}\\n`;\n      prompt += `- Response Time: ${page.responseTime}ms\\n`;\n      prompt += `- HTTP Status: ${page.status}\\n`;\n      prompt += `- Erfolg: ${page.success ? '\u2713' : '\u2717'}\\n`;\n      if (page.success && page.content) {\n        prompt += `- Content-L\u00E4nge: ${page.content.length} Zeichen\\n`;\n        prompt += `- Inhalt (Auszug, erste 1000 Zeichen):\\n${page.content.substring(0, 1000)}${page.content.length > 1000 ? '...' : ''}\\n`;\n      }\n    });\n    \n    // Task\n    prompt += `\\n\\n## AUFGABE\\n\\n`;\n    prompt += `Bewerte diese Website auf AI-Readiness und gib eine strukturierte Analyse:\\n\\n`;\n    prompt += `1. **GESAMTBEWERTUNG**\\n`;\n    prompt += `   - Wie gut ist die Website f\u00FCr KI-Systeme lesbar? (1-10)\\n`;\n    prompt += `   - Kurze Zusammenfassung der Hauptprobleme und St\u00E4rken\\n\\n`;\n    prompt += `2. **STRUKTUR & ORGANISATION**\\n`;\n    prompt += `   - Bewertung der Sitemap (falls vorhanden)\\n`;\n    prompt += `   - URL-Struktur und -Konsistenz\\n`;\n    prompt += `   - robots.txt Konfiguration\\n\\n`;\n    prompt += `3. **CONTENT-QUALIT\u00C4T**\\n`;\n    prompt += `   - Wie strukturiert und semantisch ist der Content?\\n`;\n    prompt += `   - Gibt es klare \u00DCberschriften, Meta-Informationen?\\n`;\n    prompt += `   - Ist der Content f\u00FCr KI verst\u00E4ndlich?\\n\\n`;\n    prompt += `4. **PERFORMANCE**\\n`;\n    prompt += `   - Bewertung der Response Times\\n`;\n    prompt += `   - Empfehlungen zur Performance-Optimierung\\n\\n`;\n    prompt += `5. **PRIORIT\u00C4TEN**\\n`;\n    prompt += `   - Top 5 sofort umsetzbare Ma\u00DFnahmen\\n`;\n    prompt += `   - Langfristige Verbesserungen\\n\\n`;\n    prompt += `Gib konkrete, umsetzbare Empfehlungen auf Deutsch. Sei spezifisch und beziehe dich auf die tats\u00E4chlich gefundenen Daten.`;\n    \n    return prompt;\n  }\n  \n  // Legacy function for backward compatibility\n  private buildAIReadinessPrompt(\n    websiteUrl: string,\n    robotsTxt: string,\n    sitemapUrls: string[],\n    pageContents: Array<{ url: string; content: string; title: string }>\n  ): string {\n    return this.buildAIReadinessPromptFromReport({\n      websiteUrl,\n      robotsTxt: { found: !!robotsTxt, content: robotsTxt, note: robotsTxt ? 'Gefunden' : 'Nicht gefunden' },\n      sitemap: { found: sitemapUrls.length > 0, urls: sitemapUrls, note: sitemapUrls.length > 0 ? `${sitemapUrls.length} URLs` : 'Nicht gefunden' },\n      homepage: { scraped: true, data: pageContents[0] || null },\n      pages: pageContents.map(p => ({ ...p, responseTime: 0, status: 200, success: true })),\n      summary: { totalPages: pageContents.length, successfulPages: pageContents.length, averageResponseTime: 0, fastestPage: '', slowestPage: '' }\n    });\n  }\n\n  // Call GPT API for AI Readiness recommendations\n  private async callGPTForAIReadiness(prompt: string, env: Env): Promise<string> {\n    const apiKey = env.OPENAI_API_KEY;\n    if (!apiKey) {\n      console.error(\"[GPT] OPENAI_API_KEY not configured\");\n      throw new Error(\"OPENAI_API_KEY not configured\");\n    }\n    \n    try {\n      console.log(\"[GPT] \u2192 Preparing request to OpenAI API...\");\n      console.log(\"[GPT] \u2192 Model: gpt-4o-mini\");\n      console.log(\"[GPT] \u2192 Prompt length: \" + prompt.length + \" characters\");\n      console.log(\"[GPT] \u2192 Max tokens: 3000\");\n      console.log(\"[GPT] \u2192 Timeout: 120 seconds\");\n      \n      const response = await fetch(\"https://api.openai.com/v1/chat/completions\", {\n        method: \"POST\",\n        headers: {\n          \"Authorization\": `Bearer ${apiKey}`,\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          model: \"gpt-4o-mini\",\n          messages: [\n            {\n              role: \"system\",\n              content: \"Du bist ein Experte f\u00FCr AI-Readiness und bewertest, wie gut Websites von KI-Systemen (wie ChatGPT, Claude, etc.) gelesen, verstanden und verarbeitet werden k\u00F6nnen. Du analysierst die technische Struktur, Content-Qualit\u00E4t, Performance und Zug\u00E4nglichkeit und gibst strukturierte, umsetzbare Empfehlungen auf Deutsch.\"\n            },\n            {\n              role: \"user\",\n              content: prompt\n            }\n          ],\n          temperature: 0.7,\n          max_tokens: 3000,\n        }),\n        signal: AbortSignal.timeout(120000) // 2 minutes timeout\n      });\n      \n      console.log(\"[GPT] \u2192 Response status: \" + response.status);\n      \n      if (!response.ok) {\n        const errorText = await response.text();\n        console.error(\"[GPT] \u274C API error: \" + response.status + \" - \" + errorText);\n        throw new Error(`GPT API error: ${response.status} - ${errorText}`);\n      }\n      \n      const data = await response.json() as { choices: Array<{ message: { content: string } }> };\n      const content = data.choices[0]?.message?.content || \"Keine Empfehlungen generiert.\";\n      console.log(\"[GPT] \u2713 Response received: \" + content.length + \" characters\");\n      return content;\n    } catch (error: any) {\n      if (error.name === 'AbortError' || error.name === 'TimeoutError') {\n        console.error(\"[GPT] \u274C Timeout error after 120 seconds\");\n        throw new Error(\"GPT API timeout: Die Anfrage hat zu lange gedauert (\u00FCber 2 Minuten). Bitte versuchen Sie es erneut.\");\n      }\n      console.error(\"[GPT] \u274C Error: \" + (error.message || error));\n      throw error;\n    }\n  }\n}\n\n  \n", "/**\n * Interactive workflow engine for step-by-step analysis\n */\n\nimport type { UserInput, Category, Prompt } from \"./types.js\";\nimport type { Config } from \"./config.js\";\nimport { getConfig } from \"./config.js\";\nimport { SitemapParser } from \"./ingestion/sitemap.js\";\nimport { ContentScraper } from \"./ingestion/index.js\";\nimport { CategoryGenerator } from \"./categorization/index.js\";\nimport { PromptGenerator } from \"./prompt_generation/index.js\";\nimport { LLMExecutor } from \"./llm_execution/index.js\";\nimport { AnalysisEngine } from \"./analysis/index.js\";\nimport { Database } from \"./persistence/index.js\";\nimport type { D1Database } from \"./persistence/index.js\";\n// Note: OpenAI SDK might not be available in Workers, using fetch instead\n\nexport class WorkflowEngine {\n  private config: Config;\n  private contentScraper: ContentScraper;\n  private categoryGenerator: CategoryGenerator;\n  private promptGenerator: PromptGenerator;\n  private llmExecutor: LLMExecutor;\n  private sitemapParser: SitemapParser;\n  constructor(env: Record<string, any>) {\n    this.config = getConfig(env);\n    this.contentScraper = new ContentScraper(this.config.crawling);\n    this.categoryGenerator = new CategoryGenerator();\n    this.promptGenerator = new PromptGenerator();\n    this.llmExecutor = new LLMExecutor(this.config);\n    this.sitemapParser = new SitemapParser();\n  }\n\n  // Step 1: Find and parse sitemap\n  async step1FindSitemap(\n    userInput: UserInput,\n    env: Record<string, any>\n  ): Promise<{ runId: string; urls: string[]; foundSitemap: boolean }> {\n    try {\n      const runId = `run_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n      const db = new Database(env.geo_db as D1Database);\n\n      await db.saveAnalysisRun(runId, userInput, \"running\");\n\n      const result = await this.sitemapParser.findAndParseSitemap(\n        userInput.websiteUrl\n      );\n\n      await db.db\n        .prepare(\n          \"UPDATE analysis_runs SET sitemap_urls = ?, step = ?, updated_at = ? WHERE id = ?\"\n        )\n        .bind(JSON.stringify(result.urls), \"content\", new Date().toISOString(), runId)\n        .run();\n\n      return { runId, urls: result.urls, foundSitemap: result.foundSitemap };\n    } catch (error) {\n      console.error(\"Error in step1FindSitemap:\", error);\n      throw error;\n    }\n  }\n\n  // Step 2: Fetch content from URLs\n  async step2FetchContent(\n    runId: string,\n    urls: string[],\n    language: string,\n    env: Record<string, any>\n  ): Promise<{ pageCount: number; content: string }> {\n    const db = new Database(env.geo_db as D1Database);\n\n    await db.db\n      .prepare(\"UPDATE analysis_runs SET step = ?, updated_at = ? WHERE id = ?\")\n      .bind(\"content\", new Date().toISOString(), runId)\n      .run();\n\n    // Limit to first 50 URLs for performance\n    const urlsToFetch = urls.slice(0, 50);\n    let pageCount = 0;\n    const allContent: string[] = [];\n\n    for (const url of urlsToFetch) {\n      try {\n        const response = await fetch(url, {\n          headers: { \"User-Agent\": this.config.crawling.userAgent },\n          signal: AbortSignal.timeout(this.config.crawling.timeout),\n        });\n\n        if (response.ok) {\n          const html = await response.text();\n          // Extract text content (simplified)\n          const textContent = this.extractTextContent(html);\n          allContent.push(textContent);\n          pageCount++;\n        }\n      } catch (error) {\n        // Skip failed URLs\n        continue;\n      }\n    }\n\n    const combinedContent = allContent.join(\"\\n\\n\");\n\n    await db.db\n      .prepare(\"UPDATE analysis_runs SET step = ?, updated_at = ? WHERE id = ?\")\n      .bind(\"categories\", new Date().toISOString(), runId)\n      .run();\n\n    return { pageCount, content: combinedContent };\n  }\n\n  private extractTextContent(html: string): string {\n    // Remove script and style tags\n    let text = html.replace(/<script[^>]*>[\\s\\S]*?<\\/script>/gi, \"\");\n    text = text.replace(/<style[^>]*>[\\s\\S]*?<\\/style>/gi, \"\");\n    // Remove HTML tags\n    text = text.replace(/<[^>]+>/g, \" \");\n    // Clean up whitespace\n    return text.replace(/\\s+/g, \" \").trim();\n  }\n\n  // Step 3: Generate categories/keywords with GPT\n  async step3GenerateCategories(\n    runId: string,\n    content: string,\n    language: string,\n    env: Record<string, any>\n  ): Promise<Category[]> {\n    const db = new Database(env.geo_db as D1Database);\n\n    // Use GPT to generate categories from content\n    const prompt = `Analyze the following website content and suggest 15-20 thematic categories/keywords that represent the main topics, products, or services. \nReturn only a JSON object with a \"categories\" array of objects: {\"categories\": [{\"name\": \"Category Name\", \"description\": \"Brief description\", \"keywords\": [\"keyword1\", \"keyword2\"]}]}\nContent (first 8000 chars): ${content.substring(0, 8000)}\nLanguage: ${language}\nReturn only valid JSON object with categories array, no other text.`;\n\n    try {\n      // Use OpenAI API via fetch (compatible with Workers) with timeout\n      const controller = new AbortController();\n      const timeoutId = setTimeout(() => controller.abort(), 30000); // 30 second timeout\n      \n      let response: Response;\n      try {\n        response = await fetch(\"https://api.openai.com/v1/chat/completions\", {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n            Authorization: `Bearer ${this.config.openai.apiKey}`,\n          },\n          body: JSON.stringify({\n            model: \"gpt-4o-mini\",\n            messages: [{ role: \"user\", content: prompt }],\n            response_format: { type: \"json_object\" },\n            temperature: 0.7,\n            max_tokens: 2000,\n          }),\n          signal: controller.signal,\n        });\n        clearTimeout(timeoutId);\n      } catch (fetchError: any) {\n        clearTimeout(timeoutId);\n        if (fetchError.name === 'AbortError') {\n          throw new Error(\"OpenAI API request timed out after 30 seconds\");\n        }\n        throw fetchError;\n      }\n\n      if (!response.ok) {\n        const errorText = await response.text();\n        throw new Error(`OpenAI API error: ${response.status} ${response.statusText} - ${errorText}`);\n      }\n\n      const data = await response.json();\n      \n      if (!data.choices || !data.choices[0] || !data.choices[0].message) {\n        throw new Error(\"Invalid response format from OpenAI API\");\n      }\n\n      let gptResponse: any;\n      try {\n        const content = data.choices[0].message.content || \"{}\";\n        gptResponse = JSON.parse(content);\n      } catch (parseError) {\n        console.error(\"Failed to parse GPT response:\", data.choices[0].message.content);\n        throw new Error(\"Failed to parse JSON response from GPT\");\n      }\n\n      const categories: Category[] = [];\n\n      // Parse GPT response - handle both formats\n      let categoryArray = [];\n      if (gptResponse.categories && Array.isArray(gptResponse.categories)) {\n        categoryArray = gptResponse.categories;\n      } else if (Array.isArray(gptResponse)) {\n        categoryArray = gptResponse;\n      }\n\n      for (let i = 0; i < categoryArray.length; i++) {\n        const cat = categoryArray[i];\n        categories.push({\n          id: `cat_${runId}_${i}`,\n          name: cat.name || `Category ${i + 1}`,\n          description: cat.description || \"\",\n          confidence: 0.8,\n          sourcePages: [],\n        });\n      }\n\n      // Also use traditional category generator as fallback\n      // Extract domain from content or use a default\n      let rootDomain = \"\";\n      try {\n        // Try to extract domain from content if it contains URLs\n        const urlMatch = content.match(/https?:\\/\\/([^\\/\\s]+)/i);\n        if (urlMatch) {\n          rootDomain = urlMatch[1];\n        }\n      } catch (e) {\n        // Ignore\n      }\n\n      const traditionalCategories = this.categoryGenerator.generateCategories(\n        {\n          rootDomain: rootDomain,\n          pages: [],\n          normalizedContent: content,\n          language,\n        },\n        0.3,\n        10\n      );\n\n      // Merge and deduplicate\n      const allCategories = [...categories, ...traditionalCategories];\n      const uniqueCategories = Array.from(\n        new Map(allCategories.map((c) => [c.name, c])).values()\n      );\n\n      await db.saveCategories(runId, uniqueCategories);\n\n      return uniqueCategories;\n    } catch (error: any) {\n      console.error(\"GPT category generation error:\", error);\n      console.error(\"Error details:\", error?.message || error, error?.stack);\n      \n      // Fallback to traditional method\n      let rootDomain = \"\";\n      try {\n        const urlMatch = content.match(/https?:\\/\\/([^\\/\\s]+)/i);\n        if (urlMatch) {\n          rootDomain = urlMatch[1];\n        }\n      } catch (e) {\n        // Ignore\n      }\n      \n      const categories = this.categoryGenerator.generateCategories(\n        {\n          rootDomain: rootDomain,\n          pages: [],\n          normalizedContent: content,\n          language,\n        },\n        0.3,\n        15 // Generate more categories as fallback\n      );\n      \n      if (categories.length === 0) {\n        // Ultimate fallback: create some basic categories\n        categories.push(\n          {\n            id: `cat_${runId}_0`,\n            name: \"Products & Services\",\n            description: \"Main products and services offered\",\n            confidence: 0.5,\n            sourcePages: [],\n          },\n          {\n            id: `cat_${runId}_1`,\n            name: \"Features\",\n            description: \"Key features and capabilities\",\n            confidence: 0.5,\n            sourcePages: [],\n          },\n          {\n            id: `cat_${runId}_2`,\n            name: \"Use Cases\",\n            description: \"Use cases and applications\",\n            confidence: 0.5,\n            sourcePages: [],\n          }\n        );\n      }\n      \n      await db.saveCategories(runId, categories);\n      return categories;\n    }\n  }\n\n  // Step 4: Generate prompts (questionsPerCategory per category, no brand name) using GPT\n  async step4GeneratePrompts(\n    runId: string,\n    categories: Category[],\n    userInput: UserInput,\n    content: string,\n    env: Record<string, any>,\n    questionsPerCategory: number = 3,\n    companyId?: string\n  ): Promise<Prompt[]> {\n    const db = new Database(env.geo_db as D1Database);\n\n    // Generate 5 brand-neutral questions per category using GPT\n    const allPrompts: Prompt[] = [];\n\n    for (const category of categories) {\n      try {\n        const categoryPrompts = await this.generateCategoryPromptsWithGPT(\n          category,\n          userInput,\n          content,\n          questionsPerCategory, // Use user-specified count\n          runId\n        );\n        allPrompts.push(...categoryPrompts);\n      } catch (error: any) {\n        console.error(`Error generating prompts for category ${category.name}:`, error);\n        // Fallback to template-based generation for this category\n        const fallbackPrompts = this.promptGenerator.generatePrompts(\n          [category],\n          userInput,\n          questionsPerCategory // Use the same count as requested\n        );\n        allPrompts.push(...fallbackPrompts);\n      }\n    }\n\n    await db.savePrompts(runId, allPrompts);\n\n    // Save prompts to company_prompts if companyId is provided\n    if (companyId) {\n      for (const prompt of allPrompts) {\n        const category = categories.find(c => c.id === prompt.categoryId);\n        await db.saveCompanyPrompt({\n          companyId: companyId,\n          question: prompt.question,\n          categoryId: prompt.categoryId || null,\n          categoryName: category?.name || null,\n          language: prompt.language,\n          country: prompt.country || null,\n          region: prompt.region || null,\n          isActive: true,\n        });\n      }\n      console.log(`Saved ${allPrompts.length} prompts to company_prompts for company ${companyId}`);\n    }\n\n    await db.db\n      .prepare(\n        \"UPDATE analysis_runs SET prompts_generated = ?, step = ?, updated_at = ? WHERE id = ?\"\n      )\n      .bind(\n        allPrompts.length,\n        \"prompts\",\n        new Date().toISOString(),\n        runId\n      )\n      .run();\n\n    return allPrompts;\n  }\n\n  private async generateCategoryPromptsWithGPT(\n    category: Category,\n    userInput: UserInput,\n    content: string,\n    count: number,\n    runId: string\n  ): Promise<Prompt[]> {\n    const regionText = userInput.region || userInput.country;\n    const prompt = `Du bist ein Experte f\u00FCr Kundenerfahrung. Generiere genau ${count} SEHR REALISTISCHE, DIREKTE Fragen in ${userInput.language}, die echte Kunden wirklich in einer Suchmaschine oder ChatGPT eingeben w\u00FCrden.\n\nKRITISCHE ANFORDERUNGEN:\n- Fragen m\u00FCssen brand-neutral sein (KEINE Firmennamen, KEINE Markennamen)\n- Verwende SEHR DIREKTE, SUCHMASCHINEN-\u00C4HNLICHE Formulierungen\n- BEVORZUGE \"Wer ist...\" Fragen statt \"Wie...\" Fragen\n- Integriere IMMER LOKALE/REGIONALE Bez\u00FCge (z.B. \"${regionText}\", \"in Graub\u00FCnden\", \"in Z\u00FCrich\")\n- Fragen sollten kurz, pr\u00E4gnant und sehr spezifisch sein\n- Verwende Formulierungen wie \"Wer ist...\", \"Wer bietet...\", \"Wer verkauft...\", \"Gibt es...\", \"Was kostet...\"\n- Vermeide \"Wie...\" Fragen - verwende stattdessen direkte Suchanfragen\n- Fragen sollten zeigen, dass der Kunde aktiv nach einem Anbieter/L\u00F6sung sucht\n\nBeispiele f\u00FCr PERFEKTE kundenorientierte Fragen (${userInput.language}):\n${userInput.language === 'de' ? `\n- \"Wer ist in ${regionText} f\u00FCr Kassensystem?\"\n- \"Wer bietet Kassensysteme in ${regionText}?\"\n- \"Gibt es Kassensysteme f\u00FCr Restaurants in ${regionText}?\"\n- \"Was kostet ein Kassensystem in ${regionText}?\"\n- \"Wer verkauft Kassensysteme f\u00FCr kleine L\u00E4den in ${regionText}?\"\n- \"Welche Kassensysteme gibt es in ${regionText}?\"\n- \"Wer ist der beste Anbieter f\u00FCr Kassensysteme in ${regionText}?\"\n` : userInput.language === 'en' ? `\n- \"Who is in ${regionText} for POS system?\"\n- \"Who offers POS systems in ${regionText}?\"\n- \"Are there POS systems for restaurants in ${regionText}?\"\n- \"What does a POS system cost in ${regionText}?\"\n- \"Who sells POS systems for small shops in ${regionText}?\"\n- \"What POS systems are available in ${regionText}?\"\n- \"Who is the best provider for POS systems in ${regionText}?\"\n` : `\n- \"Qui est en ${regionText} pour syst\u00E8me de caisse?\"\n- \"Qui offre des syst\u00E8mes de caisse en ${regionText}?\"\n- \"Y a-t-il des syst\u00E8mes de caisse pour restaurants en ${regionText}?\"\n- \"Combien co\u00FBte un syst\u00E8me de caisse en ${regionText}?\"\n- \"Qui vend des syst\u00E8mes de caisse pour petits magasins en ${regionText}?\"\n`}\n\nKontext:\n- Kategorie: ${category.name} - ${category.description}\n- Land: ${userInput.country}\n- Region: ${userInput.region || userInput.country}\n- Sprache: ${userInput.language}\n- Relevanter Inhaltsauszug: ${content.substring(0, 2000)}\n\nWICHTIG: \n- Die Fragen m\u00FCssen so klingen, als ob ein echter Kunde sie direkt in eine Suchmaschine oder ChatGPT eingibt\n- BEVORZUGE \"Wer ist...\" statt \"Wie...\"\n- IMMER lokale/regionale Bez\u00FCge einbauen\n- Sei SEHR DIREKT und PR\u00C4GNANT\n\nGib nur ein JSON-Objekt mit einem \"questions\" Array zur\u00FCck, das genau ${count} Fragen enth\u00E4lt:\n{\"questions\": [\"Frage 1 in ${userInput.language}\", \"Frage 2 in ${userInput.language}\", ...]}\nKein anderer Text, nur g\u00FCltiges JSON.`;\n\n    try {\n      const controller = new AbortController();\n      const timeoutId = setTimeout(() => controller.abort(), 30000); // 30 second timeout\n      \n      let response: Response;\n      try {\n        response = await fetch(\"https://api.openai.com/v1/chat/completions\", {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n            Authorization: `Bearer ${this.config.openai.apiKey}`,\n          },\n          body: JSON.stringify({\n            model: \"gpt-4o-mini\",\n            messages: [{ role: \"user\", content: prompt }],\n            response_format: { type: \"json_object\" },\n            temperature: 0.8,\n            max_tokens: 1000,\n          }),\n          signal: controller.signal,\n        });\n        clearTimeout(timeoutId);\n      } catch (fetchError: any) {\n        clearTimeout(timeoutId);\n        if (fetchError.name === 'AbortError') {\n          throw new Error(\"OpenAI API request timed out after 30 seconds\");\n        }\n        throw fetchError;\n      }\n\n      if (!response.ok) {\n        const errorText = await response.text();\n        throw new Error(`OpenAI API error: ${response.status} ${response.statusText} - ${errorText}`);\n      }\n\n      const data = await response.json();\n      \n      if (!data.choices || !data.choices[0] || !data.choices[0].message) {\n        throw new Error(\"Invalid response format from OpenAI API\");\n      }\n\n      let gptResponse: any;\n      try {\n        const responseContent = data.choices[0].message.content || \"{}\";\n        gptResponse = JSON.parse(responseContent);\n      } catch (parseError) {\n        console.error(\"Failed to parse GPT response:\", data.choices[0].message.content);\n        throw new Error(\"Failed to parse JSON response from GPT\");\n      }\n\n      const questions = gptResponse.questions || [];\n      const prompts: Prompt[] = [];\n\n      for (let i = 0; i < questions.length && i < count; i++) {\n        const question = questions[i];\n        if (question && typeof question === 'string' && question.trim().length > 0) {\n          prompts.push({\n            id: `prompt_${runId}_${category.id}_${i}`,\n            categoryId: category.id,\n            question: question.trim(),\n            language: userInput.language,\n            country: userInput.country,\n            region: userInput.region,\n            intent: \"high\",\n            createdAt: new Date().toISOString(),\n          });\n        }\n      }\n\n      // If we got fewer questions than requested, fill with fallback\n      if (prompts.length < count) {\n        console.warn(`Only got ${prompts.length} questions for category ${category.name}, using fallback for remaining`);\n        const fallbackPrompts = this.promptGenerator.generatePrompts([category], userInput, count - prompts.length);\n        prompts.push(...fallbackPrompts.slice(0, count - prompts.length));\n      }\n\n      return prompts;\n    } catch (error: any) {\n      console.error(`Error generating prompts for category ${category.name}:`, error);\n      console.error(\"Error details:\", error?.message || error, error?.stack);\n      // Fallback to template-based generation\n      const fallbackPrompts = this.promptGenerator.generatePrompts([category], userInput, count);\n      return fallbackPrompts;\n    }\n  }\n\n  // Save selected prompts\n  async saveSelectedPrompts(\n    runId: string,\n    selectedPrompts: Prompt[],\n    env: Record<string, any>\n  ): Promise<Prompt[]> {\n    const db = new Database(env.geo_db as D1Database);\n\n    await db.savePrompts(runId, selectedPrompts);\n\n    await db.db\n      .prepare(\n        \"UPDATE analysis_runs SET prompts_generated = ?, step = ?, updated_at = ? WHERE id = ?\"\n      )\n      .bind(\n        selectedPrompts.length,\n        \"prompts\",\n        new Date().toISOString(),\n        runId\n      )\n      .run();\n\n    return selectedPrompts;\n  }\n\n  // Step 5: Execute prompts with GPT-5 Web Search\n  async step5ExecutePrompts(\n    runId: string,\n    prompts: Prompt[],\n    env: Record<string, any>\n  ): Promise<{ executed: number }> {\n    const db = new Database(env.geo_db as D1Database);\n\n    await db.db\n      .prepare(\"UPDATE analysis_runs SET step = ?, updated_at = ? WHERE id = ?\")\n      .bind(\"execution\", new Date().toISOString(), runId)\n      .run();\n\n    const responses = await this.llmExecutor.executePrompts(prompts);\n    await db.saveLLMResponses(responses);\n\n    await db.db\n      .prepare(\"UPDATE analysis_runs SET step = ?, updated_at = ? WHERE id = ?\")\n      .bind(\"completed\", new Date().toISOString(), runId)\n      .run();\n\n    return { executed: responses.length };\n  }\n\n  // Save user-selected categories\n  async saveSelectedCategories(\n    runId: string,\n    categoryIds: string[],\n    customCategories: Category[],\n    env: Record<string, any>\n  ): Promise<void> {\n    const db = new Database(env.geo_db as D1Database);\n\n    // Save custom categories\n    if (customCategories.length > 0) {\n      await db.saveCategories(runId, customCategories);\n    }\n\n    await db.db\n      .prepare(\n        \"UPDATE analysis_runs SET selected_categories = ?, custom_categories = ?, updated_at = ? WHERE id = ?\"\n      )\n      .bind(\n        JSON.stringify(categoryIds),\n        JSON.stringify(customCategories),\n        new Date().toISOString(),\n        runId\n      )\n      .run();\n  }\n\n  // Save user-edited prompts\n  async saveUserPrompts(\n    runId: string,\n    prompts: Prompt[],\n    env: Record<string, any>\n  ): Promise<void> {\n    const db = new Database(env.geo_db as D1Database);\n\n    await db.db\n      .prepare(\n        \"UPDATE analysis_runs SET selected_prompts = ?, updated_at = ? WHERE id = ?\"\n      )\n      .bind(JSON.stringify(prompts), new Date().toISOString(), runId)\n      .run();\n  }\n}\n\n", "/**\n * Ingestion module entry point\n */\n\nexport { WebsiteCrawler } from \"./crawler.js\";\nexport { ContentScraper } from \"./scraper.js\";\nexport type { CrawlOptions } from \"./crawler.js\";\n\n\n\n\n\n\n\n", "/**\n * Website crawler for discovering and indexing pages\n */\n\nimport type { CrawledPage } from \"../types.js\";\n\nexport interface CrawlOptions {\n  maxPages: number;\n  maxDepth: number;\n  timeout: number;\n  userAgent: string;\n  language?: string;\n}\n\nexport class WebsiteCrawler {\n  private visitedUrls = new Set<string>();\n  private pages: CrawledPage[] = [];\n  private baseUrl?: URL;\n\n  constructor(private options: CrawlOptions) {}\n\n  async crawl(baseUrl: string): Promise<CrawledPage[]> {\n    this.baseUrl = new URL(baseUrl);\n    this.visitedUrls.clear();\n    this.pages = [];\n\n    await this.crawlPage(baseUrl, 0);\n    return this.pages;\n  }\n\n  private async crawlPage(url: string, depth: number): Promise<void> {\n    if (depth > this.options.maxDepth) return;\n    if (this.pages.length >= this.options.maxPages) return;\n\n    const normalizedUrl = this.normalizeUrl(url);\n    if (this.visitedUrls.has(normalizedUrl)) return;\n\n    this.visitedUrls.add(normalizedUrl);\n\n    try {\n      const response = await fetch(url, {\n        headers: {\n          \"User-Agent\": this.options.userAgent,\n        },\n        signal: AbortSignal.timeout(this.options.timeout),\n      });\n\n      if (!response.ok) return;\n\n      const html = await response.text();\n      const page = await this.parsePage(url, html);\n\n      if (page) {\n        this.pages.push(page);\n\n        // Extract links for further crawling\n        if (depth < this.options.maxDepth) {\n          const links = this.extractLinks(html, url);\n          for (const link of links) {\n            if (this.pages.length >= this.options.maxPages) break;\n            await this.crawlPage(link, depth + 1);\n          }\n        }\n      }\n    } catch (error) {\n      // Silently skip failed pages\n      console.error(`Failed to crawl ${url}:`, error);\n    }\n  }\n\n  private normalizeUrl(url: string): string {\n    try {\n      const urlObj = new URL(url);\n      return `${urlObj.protocol}//${urlObj.host}${urlObj.pathname}`.toLowerCase();\n    } catch {\n      return url.toLowerCase();\n    }\n  }\n\n  private extractLinks(html: string, baseUrl: string): string[] {\n    const links: string[] = [];\n    const base = new URL(baseUrl);\n    const linkRegex = /<a[^>]+href=[\"']([^\"']+)[\"']/gi;\n\n    let match;\n    while ((match = linkRegex.exec(html)) !== null) {\n      try {\n        const href = match[1];\n        const absoluteUrl = new URL(href, base).href;\n\n        // Only include same-domain links\n        if (new URL(absoluteUrl).hostname === base.hostname) {\n          links.push(absoluteUrl);\n        }\n      } catch {\n        // Skip invalid URLs\n      }\n    }\n\n    return [...new Set(links)];\n  }\n\n  private async parsePage(url: string, html: string): Promise<CrawledPage | null> {\n    // Use Cheerio-like parsing (simplified for Cloudflare Workers)\n    const titleMatch = html.match(/<title[^>]*>([^<]+)<\\/title>/i);\n    const title = titleMatch ? this.cleanText(titleMatch[1]) : \"\";\n\n    const headings: string[] = [];\n    const headingRegex = /<h([1-6])[^>]*>([^<]+)<\\/h[1-6]>/gi;\n    let headingMatch;\n    while ((headingMatch = headingRegex.exec(html)) !== null) {\n      headings.push(this.cleanText(headingMatch[2]));\n    }\n\n    // Extract main content (simplified - remove scripts, styles, etc.)\n    const bodyMatch = html.match(/<body[^>]*>([\\s\\S]*?)<\\/body>/i);\n    const bodyContent = bodyMatch ? bodyMatch[1] : html;\n    const textContent = this.extractTextContent(bodyContent);\n\n    // Extract topics (simplified keyword extraction)\n    const topics = this.extractTopics(textContent);\n\n    // Extract entities (simplified - look for capitalized phrases)\n    const entities = this.extractEntities(textContent);\n\n    return {\n      url,\n      title,\n      headings,\n      content: textContent,\n      topics,\n      entities,\n      language: this.options.language || \"en\",\n    };\n  }\n\n  private cleanText(text: string): string {\n    return text\n      .replace(/\\s+/g, \" \")\n      .replace(/&nbsp;/g, \" \")\n      .replace(/&amp;/g, \"&\")\n      .replace(/&lt;/g, \"<\")\n      .replace(/&gt;/g, \">\")\n      .replace(/&quot;/g, '\"')\n      .trim();\n  }\n\n  private extractTextContent(html: string): string {\n    // Remove script and style tags\n    let text = html.replace(/<script[^>]*>[\\s\\S]*?<\\/script>/gi, \"\");\n    text = text.replace(/<style[^>]*>[\\s\\S]*?<\\/style>/gi, \"\");\n    // Remove HTML tags\n    text = text.replace(/<[^>]+>/g, \" \");\n    // Clean up whitespace\n    return this.cleanText(text);\n  }\n\n  private extractTopics(text: string): string[] {\n    // Simplified topic extraction - look for repeated important words\n    const words = text\n      .toLowerCase()\n      .split(/\\s+/)\n      .filter((w) => w.length > 4);\n\n    const wordFreq = new Map<string, number>();\n    for (const word of words) {\n      wordFreq.set(word, (wordFreq.get(word) || 0) + 1);\n    }\n\n    return Array.from(wordFreq.entries())\n      .sort((a, b) => b[1] - a[1])\n      .slice(0, 10)\n      .map(([word]) => word);\n  }\n\n  private extractEntities(text: string): string[] {\n    // Simplified entity extraction - look for capitalized phrases\n    const entityRegex = /\\b([A-Z][a-z]+(?:\\s+[A-Z][a-z]+)*)\\b/g;\n    const entities = new Set<string>();\n    let match;\n\n    while ((match = entityRegex.exec(text)) !== null) {\n      const entity = match[1];\n      if (entity.length > 3 && entity.length < 50) {\n        entities.add(entity);\n      }\n    }\n\n    return Array.from(entities).slice(0, 20);\n  }\n}\n\n", "/**\n * Content scraper and normalizer for website content\n */\n\nimport type { WebsiteContent, CrawledPage } from \"../types.js\";\nimport { WebsiteCrawler, type CrawlOptions } from \"./crawler.js\";\n\nexport class ContentScraper {\n  constructor(private config: CrawlOptions) {}\n\n  async scrapeWebsite(\n    websiteUrl: string,\n    language: string\n  ): Promise<WebsiteContent> {\n    const crawler = new WebsiteCrawler({\n      ...this.config,\n      language,\n    });\n\n    const pages = await crawler.crawl(websiteUrl);\n    const normalizedContent = this.normalizeContent(pages, language);\n\n    return {\n      rootDomain: new URL(websiteUrl).hostname,\n      pages,\n      normalizedContent,\n      language,\n    };\n  }\n\n  private normalizeContent(pages: CrawledPage[], language: string): string {\n    // Combine all content with language-aware normalization\n    const allText = pages\n      .map((page) => {\n        const parts = [\n          page.title,\n          ...page.headings,\n          page.content,\n          ...page.topics,\n        ];\n        return parts.join(\" \");\n      })\n      .join(\"\\n\\n\");\n\n    // Language-aware normalization\n    return this.normalizeText(allText, language);\n  }\n\n  private normalizeText(text: string, language: string): string {\n    // Basic normalization - remove extra whitespace, normalize line breaks\n    let normalized = text\n      .replace(/\\s+/g, \" \")\n      .replace(/\\n{3,}/g, \"\\n\\n\")\n      .trim();\n\n    // Language-specific normalization could be added here\n    // For now, we do basic cleanup\n    if (language === \"de\") {\n      // German-specific normalization\n      normalized = normalized.replace(/\u00DF/g, \"ss\");\n    }\n\n    return normalized;\n  }\n}\n\n", "/**\n * Category generation module\n * Derives thematic categories from website content\n */\n\nimport type { WebsiteContent, Category } from \"../types.js\";\n\nexport class CategoryGenerator {\n  private readonly categoryTemplates = [\n    {\n      name: \"Product\",\n      keywords: [\"product\", \"feature\", \"solution\", \"offering\", \"service\"],\n      description: \"Product features and capabilities\",\n    },\n    {\n      name: \"Pricing\",\n      keywords: [\"price\", \"cost\", \"pricing\", \"plan\", \"subscription\", \"fee\"],\n      description: \"Pricing information and plans\",\n    },\n    {\n      name: \"Comparison\",\n      keywords: [\"compare\", \"vs\", \"versus\", \"alternative\", \"competitor\"],\n      description: \"Comparisons with alternatives\",\n    },\n    {\n      name: \"Use Cases\",\n      keywords: [\"use case\", \"example\", \"scenario\", \"application\", \"how to\"],\n      description: \"Use cases and applications\",\n    },\n    {\n      name: \"Industry\",\n      keywords: [\"industry\", \"sector\", \"vertical\", \"market\", \"domain\"],\n      description: \"Industry-specific information\",\n    },\n    {\n      name: \"Problems / Solutions\",\n      keywords: [\"problem\", \"solution\", \"challenge\", \"issue\", \"solve\"],\n      description: \"Problems addressed and solutions provided\",\n    },\n    {\n      name: \"Integration\",\n      keywords: [\"integrate\", \"api\", \"connection\", \"compatible\", \"works with\"],\n      description: \"Integration capabilities\",\n    },\n    {\n      name: \"Support\",\n      keywords: [\"support\", \"help\", \"documentation\", \"guide\", \"tutorial\"],\n      description: \"Support and documentation\",\n    },\n  ];\n\n  generateCategories(\n    content: WebsiteContent,\n    minConfidence: number = 0.5,\n    maxCategories: number = 10\n  ): Category[] {\n    const categories: Category[] = [];\n    const contentText = content.normalizedContent.toLowerCase();\n    const allPages = content.pages.map((p) => p.url);\n\n    for (const template of this.categoryTemplates) {\n      const confidence = this.calculateCategoryConfidence(\n        template,\n        contentText,\n        content.pages\n      );\n\n      if (confidence >= minConfidence) {\n        const sourcePages = this.findRelevantPages(template, content.pages);\n\n        categories.push({\n          id: this.generateCategoryId(template.name),\n          name: template.name,\n          description: template.description,\n          confidence,\n          sourcePages: sourcePages.map((p) => p.url),\n        });\n      }\n    }\n\n    // Sort by confidence and limit\n    return categories\n      .sort((a, b) => b.confidence - a.confidence)\n      .slice(0, maxCategories);\n  }\n\n  private calculateCategoryConfidence(\n    template: { keywords: string[] },\n    contentText: string,\n    pages: WebsiteContent[\"pages\"]\n  ): number {\n    let keywordMatches = 0;\n    let totalKeywords = template.keywords.length;\n\n    for (const keyword of template.keywords) {\n      if (contentText.includes(keyword.toLowerCase())) {\n        keywordMatches++;\n      }\n    }\n\n    // Base confidence from keyword matches\n    let confidence = keywordMatches / totalKeywords;\n\n    // Boost confidence if found in multiple pages\n    const pagesWithKeywords = pages.filter((page) => {\n      const pageText = page.content.toLowerCase();\n      return template.keywords.some((kw) => pageText.includes(kw.toLowerCase()));\n    }).length;\n\n    if (pages.length > 0) {\n      confidence += (pagesWithKeywords / pages.length) * 0.3;\n    }\n\n    return Math.min(confidence, 1.0);\n  }\n\n  private findRelevantPages(\n    template: { keywords: string[] },\n    pages: WebsiteContent[\"pages\"]\n  ): WebsiteContent[\"pages\"] {\n    return pages.filter((page) => {\n      const pageText = (\n        page.title +\n        \" \" +\n        page.headings.join(\" \") +\n        \" \" +\n        page.content\n      ).toLowerCase();\n\n      return template.keywords.some((kw) =>\n        pageText.includes(kw.toLowerCase())\n      );\n    });\n  }\n\n  private generateCategoryId(name: string): string {\n    return `cat_${name.toLowerCase().replace(/\\s+/g, \"_\")}_${Date.now()}`;\n  }\n}\n\n\n\n\n\n\n\n", "/**\n * Prompt generation module\n * Generates high-intent questions for each category\n */\n\nimport type { Category, Prompt, UserInput } from \"../types.js\";\n\nexport class PromptGenerator {\n  generatePrompts(\n    categories: Category[],\n    userInput: UserInput,\n    questionsPerCategory: number = 5\n  ): Prompt[] {\n    const prompts: Prompt[] = [];\n\n    for (const category of categories) {\n      const categoryPrompts = this.generateCategoryPrompts(\n        category,\n        userInput,\n        questionsPerCategory\n      );\n      prompts.push(...categoryPrompts);\n    }\n\n    return prompts;\n  }\n\n  private generateCategoryPrompts(\n    category: Category,\n    userInput: UserInput,\n    count: number\n  ): Prompt[] {\n    const prompts: Prompt[] = [];\n    const templates = this.getPromptTemplates(category.name, userInput.language);\n\n    for (let i = 0; i < count && i < templates.length; i++) {\n      const template = templates[i];\n      const question = this.fillTemplate(template, userInput, category);\n\n      prompts.push({\n        id: this.generatePromptId(category.id, i),\n        categoryId: category.id,\n        question,\n        language: userInput.language,\n        country: userInput.country,\n        region: userInput.region,\n        intent: this.determineIntent(template),\n        createdAt: new Date().toISOString(),\n      });\n    }\n\n    return prompts;\n  }\n\n  private getPromptTemplates(\n    categoryName: string,\n    language: string\n  ): string[] {\n    // Language-specific templates\n    const templates: Record<string, Record<string, string[]>> = {\n      en: {\n        Product: [\n          \"What are the key features of {product} in {country}?\",\n          \"How does {product} work for businesses in {region}?\",\n          \"What makes {product} different from other solutions?\",\n          \"What are the main capabilities of {product}?\",\n          \"How do companies in {country} use {product}?\",\n        ],\n        Pricing: [\n          \"How much does {product} cost in {country}?\",\n          \"What are the pricing plans for {product}?\",\n          \"Is {product} affordable for small businesses in {region}?\",\n          \"What is the pricing structure for {product}?\",\n          \"Are there any discounts available for {product} in {country}?\",\n        ],\n        Comparison: [\n          \"How does {product} compare to alternatives in {country}?\",\n          \"What are the best alternatives to {product}?\",\n          \"Should I choose {product} or {competitor}?\",\n          \"How does {product} stack up against competitors?\",\n          \"What are the pros and cons of {product} vs alternatives?\",\n        ],\n        \"Use Cases\": [\n          \"What are common use cases for {product} in {region}?\",\n          \"How do companies in {country} use {product}?\",\n          \"What problems does {product} solve?\",\n          \"When should I use {product}?\",\n          \"What industries benefit from {product}?\",\n        ],\n        Industry: [\n          \"What companies in {country} use {product}?\",\n          \"Is {product} suitable for {industry} in {region}?\",\n          \"What industries does {product} serve?\",\n          \"How is {product} used in {industry}?\",\n          \"What are the main use cases for {product} in {industry}?\",\n        ],\n        \"Problems / Solutions\": [\n          \"What problems does {product} solve in {country}?\",\n          \"How does {product} address common challenges?\",\n          \"What issues can {product} help with?\",\n          \"What solutions does {product} provide?\",\n          \"How does {product} solve business problems?\",\n        ],\n        Integration: [\n          \"What integrations does {product} support?\",\n          \"How do I integrate {product} with other tools?\",\n          \"Is {product} compatible with {tool}?\",\n          \"What APIs does {product} offer?\",\n          \"How does {product} connect with existing systems?\",\n        ],\n        Support: [\n          \"How do I get started with {product}?\",\n          \"What documentation is available for {product}?\",\n          \"How do I get support for {product} in {country}?\",\n          \"What resources are available for {product} users?\",\n          \"Where can I find help with {product}?\",\n        ],\n      },\n      de: {\n        Product: [\n          \"Was sind die Hauptfunktionen von {product} in {country}?\",\n          \"Wie funktioniert {product} f\u00FCr Unternehmen in {region}?\",\n          \"Was unterscheidet {product} von anderen L\u00F6sungen?\",\n          \"Welche Hauptfunktionen bietet {product}?\",\n          \"Wie nutzen Unternehmen in {country} {product}?\",\n        ],\n        Pricing: [\n          \"Wie viel kostet {product} in {country}?\",\n          \"Welche Preismodelle gibt es f\u00FCr {product}?\",\n          \"Ist {product} f\u00FCr kleine Unternehmen in {region} erschwinglich?\",\n          \"Wie ist die Preisstruktur von {product}?\",\n          \"Gibt es Rabatte f\u00FCr {product} in {country}?\",\n        ],\n        Comparison: [\n          \"Wie schneidet {product} im Vergleich zu Alternativen in {country} ab?\",\n          \"Was sind die besten Alternativen zu {product}?\",\n          \"Sollte ich {product} oder {competitor} w\u00E4hlen?\",\n          \"Wie steht {product} im Vergleich zu Konkurrenten da?\",\n          \"Was sind die Vor- und Nachteile von {product} vs Alternativen?\",\n        ],\n        \"Use Cases\": [\n          \"Was sind h\u00E4ufige Anwendungsf\u00E4lle f\u00FCr {product} in {region}?\",\n          \"Wie nutzen Unternehmen in {country} {product}?\",\n          \"Welche Probleme l\u00F6st {product}?\",\n          \"Wann sollte ich {product} verwenden?\",\n          \"Welche Branchen profitieren von {product}?\",\n        ],\n        Industry: [\n          \"Welche Unternehmen in {country} nutzen {product}?\",\n          \"Ist {product} f\u00FCr {industry} in {region} geeignet?\",\n          \"Welche Branchen bedient {product}?\",\n          \"Wie wird {product} in {industry} eingesetzt?\",\n          \"Was sind die Hauptanwendungsf\u00E4lle f\u00FCr {product} in {industry}?\",\n        ],\n        \"Problems / Solutions\": [\n          \"Welche Probleme l\u00F6st {product} in {country}?\",\n          \"Wie adressiert {product} h\u00E4ufige Herausforderungen?\",\n          \"Bei welchen Problemen kann {product} helfen?\",\n          \"Welche L\u00F6sungen bietet {product}?\",\n          \"Wie l\u00F6st {product} Gesch\u00E4ftsprobleme?\",\n        ],\n        Integration: [\n          \"Welche Integrationen unterst\u00FCtzt {product}?\",\n          \"Wie integriere ich {product} mit anderen Tools?\",\n          \"Ist {product} kompatibel mit {tool}?\",\n          \"Welche APIs bietet {product}?\",\n          \"Wie verbindet sich {product} mit bestehenden Systemen?\",\n        ],\n        Support: [\n          \"Wie beginne ich mit {product}?\",\n          \"Welche Dokumentation ist f\u00FCr {product} verf\u00FCgbar?\",\n          \"Wie erhalte ich Support f\u00FCr {product} in {country}?\",\n          \"Welche Ressourcen stehen {product}-Nutzern zur Verf\u00FCgung?\",\n          \"Wo finde ich Hilfe zu {product}?\",\n        ],\n      },\n      fr: {\n        Product: [\n          \"Quelles sont les principales fonctionnalit\u00E9s de {product} en {country}?\",\n          \"Comment fonctionne {product} pour les entreprises en {region}?\",\n          \"Qu'est-ce qui distingue {product} des autres solutions?\",\n          \"Quelles sont les principales capacit\u00E9s de {product}?\",\n          \"Comment les entreprises en {country} utilisent-elles {product}?\",\n        ],\n        Pricing: [\n          \"Combien co\u00FBte {product} en {country}?\",\n          \"Quels sont les plans tarifaires pour {product}?\",\n          \"{product} est-il abordable pour les petites entreprises en {region}?\",\n          \"Quelle est la structure tarifaire de {product}?\",\n          \"Y a-t-il des remises disponibles pour {product} en {country}?\",\n        ],\n        Comparison: [\n          \"Comment {product} se compare-t-il aux alternatives en {country}?\",\n          \"Quelles sont les meilleures alternatives \u00E0 {product}?\",\n          \"Dois-je choisir {product} ou {competitor}?\",\n          \"Comment {product} se compare-t-il aux concurrents?\",\n          \"Quels sont les avantages et inconv\u00E9nients de {product} vs alternatives?\",\n        ],\n        \"Use Cases\": [\n          \"Quels sont les cas d'usage courants pour {product} en {region}?\",\n          \"Comment les entreprises en {country} utilisent-elles {product}?\",\n          \"Quels probl\u00E8mes {product} r\u00E9sout-il?\",\n          \"Quand devrais-je utiliser {product}?\",\n          \"Quelles industries b\u00E9n\u00E9ficient de {product}?\",\n        ],\n        Industry: [\n          \"Quelles entreprises en {country} utilisent {product}?\",\n          \"{product} est-il adapt\u00E9 \u00E0 {industry} en {region}?\",\n          \"Quelles industries {product} sert-il?\",\n          \"Comment {product} est-il utilis\u00E9 dans {industry}?\",\n          \"Quels sont les principaux cas d'usage pour {product} dans {industry}?\",\n        ],\n        \"Problems / Solutions\": [\n          \"Quels probl\u00E8mes {product} r\u00E9sout-il en {country}?\",\n          \"Comment {product} r\u00E9pond-il aux d\u00E9fis courants?\",\n          \"\u00C0 quels probl\u00E8mes {product} peut-il aider?\",\n          \"Quelles solutions {product} fournit-il?\",\n          \"Comment {product} r\u00E9sout-il les probl\u00E8mes commerciaux?\",\n        ],\n        Integration: [\n          \"Quelles int\u00E9grations {product} prend-il en charge?\",\n          \"Comment int\u00E9grer {product} avec d'autres outils?\",\n          \"{product} est-il compatible avec {tool}?\",\n          \"Quelles API {product} offre-t-il?\",\n          \"Comment {product} se connecte-t-il aux syst\u00E8mes existants?\",\n        ],\n        Support: [\n          \"Comment commencer avec {product}?\",\n          \"Quelle documentation est disponible pour {product}?\",\n          \"Comment obtenir du support pour {product} en {country}?\",\n          \"Quelles ressources sont disponibles pour les utilisateurs de {product}?\",\n          \"O\u00F9 puis-je trouver de l'aide pour {product}?\",\n        ],\n      },\n    };\n\n    const langTemplates = templates[language] || templates.en;\n    return langTemplates[categoryName] || langTemplates.Product || [];\n  }\n\n  private fillTemplate(\n    template: string,\n    userInput: UserInput,\n    category: Category\n  ): string {\n    // Extract domain name as product name\n    const productName = this.extractProductName(userInput.websiteUrl);\n\n    return template\n      .replace(/{product}/g, productName)\n      .replace(/{country}/g, userInput.country)\n      .replace(/{region}/g, userInput.region || userInput.country)\n      .replace(/{industry}/g, \"the industry\")\n      .replace(/{competitor}/g, \"competitors\")\n      .replace(/{tool}/g, \"other tools\");\n  }\n\n  private extractProductName(websiteUrl: string): string {\n    try {\n      const domain = new URL(websiteUrl).hostname;\n      const parts = domain.split(\".\");\n      return parts[0].charAt(0).toUpperCase() + parts[0].slice(1);\n    } catch {\n      return \"the product\";\n    }\n  }\n\n  private determineIntent(template: string): \"high\" | \"medium\" | \"low\" {\n    // High intent: questions with \"how\", \"what\", \"should\", \"best\"\n    if (\n      /how|what|should|best|which|when/i.test(template) &&\n      /cost|price|compare|choose|recommend/i.test(template)\n    ) {\n      return \"high\";\n    }\n    // Medium intent: questions with \"is\", \"are\", \"does\"\n    if (/is|are|does|can/i.test(template)) {\n      return \"medium\";\n    }\n    return \"low\";\n  }\n\n  private generatePromptId(categoryId: string, index: number): string {\n    return `prompt_${categoryId}_${index}_${Date.now()}`;\n  }\n}\n\n\n\n\n\n\n\n", "/**\n * Main GEO engine orchestrator\n */\n\nimport type {\n  UserInput,\n  AnalysisResult,\n  Category,\n  Prompt,\n  LLMResponse,\n  PromptAnalysis,\n  CategoryMetrics,\n  CompetitiveAnalysis,\n  TimeSeriesData,\n} from \"./types.js\";\nimport type { Config } from \"./config.js\";\nimport { getConfig } from \"./config.js\";\nimport { ContentScraper } from \"./ingestion/index.js\";\nimport { CategoryGenerator } from \"./categorization/index.js\";\nimport { PromptGenerator } from \"./prompt_generation/index.js\";\nimport { LLMExecutor } from \"./llm_execution/index.js\";\nimport { AnalysisEngine } from \"./analysis/index.js\";\nimport { Database } from \"./persistence/index.js\";\nimport type { D1Database } from \"./persistence/index.js\";\n\nexport class GEOEngine {\n  private config: Config;\n  private contentScraper: ContentScraper;\n  private categoryGenerator: CategoryGenerator;\n  private promptGenerator: PromptGenerator;\n  private llmExecutor: LLMExecutor;\n  private analysisEngine: AnalysisEngine;\n\n  constructor(env: Record<string, any>) {\n    this.config = getConfig(env);\n    this.contentScraper = new ContentScraper(this.config.crawling);\n    this.categoryGenerator = new CategoryGenerator();\n    this.promptGenerator = new PromptGenerator();\n    this.llmExecutor = new LLMExecutor(this.config);\n  }\n\n  async runAnalysis(\n    userInput: UserInput,\n    env: Record<string, any>\n  ): Promise<string> {\n    const runId = `run_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n    const db = new Database(env.geo_db as D1Database);\n\n    // Save initial run\n    await db.saveAnalysisRun(runId, userInput, \"running\");\n\n    // Run analysis asynchronously\n    this.runAnalysisAsync(runId, userInput, env, db).catch(async (error) => {\n      console.error(\"Analysis error:\", error);\n      await db.updateAnalysisStatus(runId, \"failed\", {\n        step: \"error\",\n        progress: 0,\n        message: error instanceof Error ? error.message : \"Unknown error\",\n      });\n      await db.db\n        .prepare(\"UPDATE analysis_runs SET error_message = ? WHERE id = ?\")\n        .bind(error instanceof Error ? error.message : \"Unknown error\", runId)\n        .run();\n    });\n\n    return runId;\n  }\n\n  private async runAnalysisAsync(\n    runId: string,\n    userInput: UserInput,\n    env: Record<string, any>,\n    db: Database\n  ): Promise<void> {\n    try {\n      // Extract brand name from URL\n      const brandName = this.extractBrandName(userInput.websiteUrl);\n      this.analysisEngine = new AnalysisEngine(\n        brandName,\n        this.config.analysis.brandFuzzyThreshold\n      );\n\n      // Step 1: Website ingestion\n      await db.updateAnalysisStatus(runId, \"running\", {\n        step: \"crawling\",\n        progress: 10,\n        message: \"Crawling website...\",\n      });\n      const websiteContent = await this.contentScraper.scrapeWebsite(\n        userInput.websiteUrl,\n        userInput.language\n      );\n\n      // Step 2: Category generation\n      await db.updateAnalysisStatus(runId, \"running\", {\n        step: \"categorizing\",\n        progress: 30,\n        message: \"Generating categories...\",\n      });\n      const categories = this.categoryGenerator.generateCategories(\n        websiteContent,\n        this.config.categories.minConfidence,\n        this.config.categories.maxCategories\n      );\n      await db.saveCategories(runId, categories);\n\n      // Step 3: Prompt generation\n      await db.updateAnalysisStatus(runId, \"running\", {\n        step: \"generating_prompts\",\n        progress: 40,\n        message: `Generating prompts for ${categories.length} categories...`,\n      });\n      const prompts = this.promptGenerator.generatePrompts(\n        categories,\n        userInput,\n        this.config.prompts.questionsPerCategory\n      );\n      await db.savePrompts(runId, prompts);\n\n      // Step 4: LLM execution\n      await db.updateAnalysisStatus(runId, \"running\", {\n        step: \"llm_execution\",\n        progress: 50,\n        message: `Executing ${prompts.length} prompts with GPT-5...`,\n      });\n      const responses = await this.llmExecutor.executePrompts(prompts);\n      await db.saveLLMResponses(responses);\n\n      // Step 5: Result analysis\n      await db.updateAnalysisStatus(runId, \"running\", {\n        step: \"analyzing\",\n        progress: 80,\n        message: \"Analyzing responses...\",\n      });\n      const analyses = this.analysisEngine.analyzeResponses(prompts, responses);\n      await db.savePromptAnalyses(analyses);\n\n      // Step 6: Category metrics\n      await db.updateAnalysisStatus(runId, \"running\", {\n        step: \"calculating_metrics\",\n        progress: 90,\n        message: \"Calculating metrics...\",\n      });\n      const categoryMetrics: CategoryMetrics[] = [];\n      for (const category of categories) {\n        const metrics = this.analysisEngine.calculateCategoryMetrics(\n          category.id,\n          prompts,\n          analyses\n        );\n        categoryMetrics.push(metrics);\n      }\n      await db.saveCategoryMetrics(runId, categoryMetrics);\n\n      // Step 7: Competitive analysis\n      const competitiveAnalysis =\n        this.analysisEngine.performCompetitiveAnalysis(analyses, prompts);\n      await db.saveCompetitiveAnalysis(runId, competitiveAnalysis);\n\n      // Step 8: Time series data\n      const timeSeriesData: TimeSeriesData = {\n        timestamp: new Date().toISOString(),\n        visibilityScore: this.calculateOverallVisibility(categoryMetrics),\n        citationCount: responses.reduce(\n          (sum, r) => sum + r.citations.length,\n          0\n        ),\n        brandMentionCount: analyses.reduce(\n          (sum, a) => sum + a.brandMentions.exact + a.brandMentions.fuzzy,\n          0\n        ),\n        competitorMentionCount: analyses.reduce(\n          (sum, a) =>\n            sum + a.competitors.reduce((s, c) => s + c.count, 0),\n          0\n        ),\n      };\n      await db.saveTimeSeriesData(runId, timeSeriesData);\n\n      // Mark as completed\n      await db.updateAnalysisStatus(runId, \"completed\", {\n        step: \"completed\",\n        progress: 100,\n        message: \"Analysis completed successfully!\",\n      });\n\n      // Update run timestamp\n      await db.db\n        .prepare(\"UPDATE analysis_runs SET updated_at = ? WHERE id = ?\")\n        .bind(new Date().toISOString(), runId)\n        .run();\n    } catch (error) {\n      console.error(\"Analysis error:\", error);\n      await db.updateAnalysisStatus(runId, \"failed\", {\n        step: \"error\",\n        progress: 0,\n        message: error instanceof Error ? error.message : \"Unknown error\",\n      });\n      await db.db\n        .prepare(\"UPDATE analysis_runs SET error_message = ? WHERE id = ?\")\n        .bind(error instanceof Error ? error.message : \"Unknown error\", runId)\n        .run();\n      throw error;\n    }\n  }\n\n  async getAnalysisResult(\n    runId: string,\n    env: Record<string, any>\n  ): Promise<AnalysisResult | null> {\n    const db = new Database(env.geo_db as D1Database);\n    return await db.getAnalysisRun(runId);\n  }\n\n  private extractBrandName(websiteUrl: string): string {\n    try {\n      const domain = new URL(websiteUrl).hostname;\n      const parts = domain.split(\".\");\n      return parts[0].charAt(0).toUpperCase() + parts[0].slice(1);\n    } catch {\n      return \"the brand\";\n    }\n  }\n\n  private calculateOverallVisibility(\n    categoryMetrics: CategoryMetrics[]\n  ): number {\n    if (categoryMetrics.length === 0) return 0;\n    const sum = categoryMetrics.reduce(\n      (s, m) => s + m.visibilityScore,\n      0\n    );\n    return sum / categoryMetrics.length;\n  }\n}\n\n", "import type { Middleware } from \"./common\";\n\nconst drainBody: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} finally {\n\t\ttry {\n\t\t\tif (request.body !== null && !request.bodyUsed) {\n\t\t\t\tconst reader = request.body.getReader();\n\t\t\t\twhile (!(await reader.read()).done) {}\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.error(\"Failed to drain the unused request body.\", e);\n\t\t}\n\t}\n};\n\nexport default drainBody;\n", "import type { Middleware } from \"./common\";\n\ninterface JsonError {\n\tmessage?: string;\n\tname?: string;\n\tstack?: string;\n\tcause?: JsonError;\n}\n\nfunction reduceError(e: any): JsonError {\n\treturn {\n\t\tname: e?.name,\n\t\tmessage: e?.message ?? String(e),\n\t\tstack: e?.stack,\n\t\tcause: e?.cause === undefined ? undefined : reduceError(e.cause),\n\t};\n}\n\n// See comment in `bundle.ts` for details on why this is needed\nconst jsonError: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} catch (e: any) {\n\t\tconst error = reduceError(e);\n\t\treturn Response.json(error, {\n\t\t\tstatus: 500,\n\t\t\theaders: { \"MF-Experimental-Error-Stack\": \"true\" },\n\t\t});\n\t}\n};\n\nexport default jsonError;\n", "export type Awaitable<T> = T | Promise<T>;\n// TODO: allow dispatching more events?\nexport type Dispatcher = (\n\ttype: \"scheduled\",\n\tinit: { cron?: string }\n) => Awaitable<void>;\n\nexport type IncomingRequest = Request<\n\tunknown,\n\tIncomingRequestCfProperties<unknown>\n>;\n\nexport interface MiddlewareContext {\n\tdispatch: Dispatcher;\n\tnext(request: IncomingRequest, env: any): Awaitable<Response>;\n}\n\nexport type Middleware = (\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tmiddlewareCtx: MiddlewareContext\n) => Awaitable<Response>;\n\nconst __facade_middleware__: Middleware[] = [];\n\n// The register functions allow for the insertion of one or many middleware,\n// We register internal middleware first in the stack, but have no way of controlling\n// the order that addMiddleware is run in service workers so need an internal function.\nexport function __facade_register__(...args: (Middleware | Middleware[])[]) {\n\t__facade_middleware__.push(...args.flat());\n}\nexport function __facade_registerInternal__(\n\t...args: (Middleware | Middleware[])[]\n) {\n\t__facade_middleware__.unshift(...args.flat());\n}\n\nfunction __facade_invokeChain__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tmiddlewareChain: Middleware[]\n): Awaitable<Response> {\n\tconst [head, ...tail] = middlewareChain;\n\tconst middlewareCtx: MiddlewareContext = {\n\t\tdispatch,\n\t\tnext(newRequest, newEnv) {\n\t\t\treturn __facade_invokeChain__(newRequest, newEnv, ctx, dispatch, tail);\n\t\t},\n\t};\n\treturn head(request, env, ctx, middlewareCtx);\n}\n\nexport function __facade_invoke__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tfinalMiddleware: Middleware\n): Awaitable<Response> {\n\treturn __facade_invokeChain__(request, env, ctx, dispatch, [\n\t\t...__facade_middleware__,\n\t\tfinalMiddleware,\n\t]);\n}\n"],
  "mappings": "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AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;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",
  "names": ["urls", "jsonError", "match", "content", "url", "LLMExecutor", "getConfig", "AnalysisEngine", "Database", "jsonError", "startTime", "totalTime", "SitemapParser"]
}
